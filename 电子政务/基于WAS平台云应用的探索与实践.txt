基于WAS平台云应用的探索与实践
“十二五”期间，山东烟草信息化工作将以集成整合、资源共享为主线，以新一代数据中心和应用集成平台为核心，努力打造“国内一流、行业领先”的一体化“数字鲁烟”。山东烟草信息中心积极探索云计算在行业信息化中的应用，将基于WAS的平台云建设与全省应用集成平台建设结合起来，达到了良好的应用效果，并为山东烟草信息化逐步向云计算迁移做出了必要的经验积累和技术储备。1 引言    山东烟草紧紧围绕《贯彻“卷烟上水平”战略规划纲要》的要求，着力转变全系统的集团管控模式、市场监管方式、企业管理模式、现代流通经营方式，这些变化对信息化的系统性、完整性和统一性提出了更高要求，信息化建设要突出统筹规划、系统设计和标准规范，从而全面提升信息部门职能定位，改进信息化工作方法，转变信息化建设模式，持续提升信息化建设、管理和应用水平。    技术支撑方面针对现有信息系统集成、协同、共享、管理困难，基础资源分散，缺乏有效整合和集约共享利用的问题，应用SOA思想，采用“平台+应用”的技术架构模式，按照“大集中、一体化、平台化”的技术路线，以应用集成为突破口，解决以流程为重点的业务协同问题，以基础资源虚拟化为手段，解决以计算存储网络为重点的资源优化利用问题。本文着重对云计算进行研究，并积极探索云计算在烟草信息化应用前景，为“集成整合”开拓出新的实践道路，进一步推动行业信息化发展。2 云计算的应用价值    云计算(Cloud Computing)，是一种基于互联网的计算方式，将软硬件计算资源以服务的方式进行封装，并通过网络提供给使用者按需使用和消费。云计算的核心理念是资源服务化，一切的资源以服务的形式提供;云计算核心的能力是弹性(Elasticity)，使用者对资源的消费是随需而用，云计算的服务提供者对资源的供给也是随需而变:云计算的核心技术是各个层次的资源虚拟化以及智能化、自动化的资源部署和管理能力。    云计算所提供的资源虚拟化、动态调度和运维、管理的自动化和智能化能为企业信息化带来诸多收益。    (1)节省设备购置/维护成本;    (2)提升应用系统适应能力和服务质量水平:    (3)降低系统管理/运维的复杂度和工作量，提升工作效率;    (4)支撑和带动业务模式创新。3 应用场景分析    3.1服务对象分析    从云计算服务对象和权责归属的角度看，云计算可以分为公有云、私有云以及混合云。烟草行业当前所采用的业务模式受到带宽、安全、法规等诸多限制，决定了云资源、云服务无法向社会开放，所以诸如多租户、计费计量等云计算相关能力不能成为行业关注的重点，烟草云计算处于私有云建设阶段。    3.2服务类型分析    从提供服务的类型和层次来看，业界通常将云计算分为:    (1)基础设施云(Infrastructure Cloud)或基础设施即服务(IaaS);    (2)平台云(Platform Cloud)或平台即服务(Paa5);    (3)应用云(Application Cloud)或软件即服务(SaaS)。  图1.云计算的层次    不同层次的云对不同层次的计算资源进行虚拟化，并以相应的形式进行服务化的计算资源供给。IaaS以服务的形式提供物理资源(计算能力、内存、存储、网络等)，PaaS以服务的形式提供软件支撑平台级的功能〔应用服务、数据库等)，而SaaS则以服务的形式提供相应的业务功能(客户关系管理、则务/账务管理等)。IaaS, PaaS, SaaS可以形成递进的支撑关系，但并不一定构成必然的依赖关系。不管从概念定义，还是从技术实现方式上看，PaaS都可以独立实现，没有必要一定以IaaS为前提和基础。  3. 3现状分析    山东烟草在探索云计算应川模式的过程中，不拘泥于常规，没有按部就班的依照基础设施一平合一应用的{须序进行，而是结合山东烟草的具体实际和业界产品和技术现状，有针对性以应用支撑平台做为切入点，尝试构建以应用平台云为核心的山东烟草“一体化”的应用支撑平台。    山东烟草目前的TT环境中，应用平台比较一致，基本采用了IBM Websphere ApplicationServer，这为应用支撑层面通过云计算手段实现“一体化”打下了良好的基础;应用支撑平台(JZE);应用服务器)领域业界己经具备了非常成熟的软件集群技术，结合创新的动态集群技术，更是为实现应用平台“一体化”提供了必要保障。    在数据管理平台(数据库)层面，山东烟草的信息化环境中，有多种数据库产品共存。各数据库产品在集群的技术路线、实现方式和具体功能卜都存在很大的差异:在数据管理领域，集群和虚拟化还没有形成标准和共识。在没有成熟的动态集群技术的支撑下，为了实现数据库层面的动态资源调度，信息化部门需要在部署和运维管理方面完成繁重的工作，并承担巨大的风险。4 应用平台云架构    根据业务关键程度、应用负载量、应用负载分布特性，应用复杂程度等因素，对所有应用系统进行筛选，最终确定了七个应用系统作为项目一期的实施范围。整体架构如下:  图2.山东烟草应用平合云-架构示意图    架构主要分五个层次:    4.1网络负载均衡层    网络负载均衡层，利用F5网洛负载均衡器在IP网络层面实现系统服务地址的统一接入及系统服务异常状况下的地址切换;方案中配置两台F5网络负载均衡器，采用主/备模式，实现F5自身的高可用性。    4. 2应用平台云的管理调度层    应用平台云的管理调度层中部署智能路由组件(On-Demand Router)和平台云的管理控制台。智能路由组件(ODR)是应用平台云核心组件，平台云所承载的所有处理请求，全部由ODR进行分发和过滤。ODR通过解析应用请求的URL，判定请求的归属应用，并基于预定义的策略分发到后端应用服务器资源池中的相应的节点。智能路由组件(ODR)还控制着其后端应用服务器资源池内资源的动态分配。ODR监测每个应用请求的处理响应时间及相关应用服务器所在节点的资源消耗情况，依据资源分配策略动态的调整每个应用系统所实际获得资源数量。管理调度层的另一组成部分是平台云的管理控制台。管理控制台是一个集中式的管控工具，负责对整个应用平台云(包括ODR和资源池)的配置、部署及监控等任务。    4. 3应用服务器资源池    应用服务器资源池是应用平台云的主体组成部分，实际承担着所有应用请求的处理工作。资源池由众多，J2EE应用服务器组成，并扩展了动态集群能力。可以根据ODR的指令，对相关应用程序的集群进行动态的伸缩，以配合应用系统负载的变化，合理的、科学的分配计算资源，达到资源的最优化利用。    应用服务器动态集群能力屏蔽了底层硬件设备和操作系统的差异，将应用平台提供的功能以标准的、服务化的形式提供给土层业务应用系统，实现了应用支撑平台层面的虚拟化。 4. 4数据库资源层    数据库资源层集中了企业环境内人部分的数据库。数据库整合的第一阶段将是实现山东烟草数据库平台的统一化，确立山东烟草数据库平台的标准，逐步将各系统数据库平台依照标准进行规范和迁移，为实现数据库层面的虚拟化打下坚实的基础。第二阶段，待数据库虚拟化方面技术条件成熟后，计划采用数据库动态集群模式，构建数据库服务资源池，实现数据服务层面的平台云(PaaS)。    4.5数据存储资源层    数据存储资源层包括了企业内所有存储设备。数据库层面的整合，包括数据库平台云的构建，对数据存储资源的管理和调度提出了更高的要求。为配合数据库平台云的建设，计划在数据存储层面实现存储云。存储云的核心技术是存储资源的虚拟化。存储虚拟化整合各种异构的存储设备，屏蔽其技术实现差异，并基于存储虚拟化实现数据存储资源的统一管理，对上层平台云提供统一数据存储资源服务。5 实施过程    应用平台云的实施过程参考了业界相关的最佳实践，按照如下步骤进行:  图3.应用平台云实施步骤    在平台云实施之前，山东烟草己经部署实施了企业级的应用集成平台，内容涵盖了数据整合(数据中心，共享文档库)、流程整合(BPM)、界面整合(企业门户)、用户整合(用户身份统一和单点登录)、企业搜索。    在应用平台云的实施过程中，必须考虑与现有集成平台组件的关联和融合。    以应用平台云和企业门户及单点登录的集成为例，说明云计算和现有环境的融合过程。第一个需要解决的问题是F5负载均衡器、平台云智能路由器(ODR)和单点登录认证组件(反向代理WebSEAL)之间的相互定位和关联关系。从系统架构上看，F5, ODR, WebSEAL都属于接入和代理的角色，一个应用请求需要先后经过这二个组件，甚不需要反复多次途经其中某个组件。这二个组件的关系定位，将影响应用请求处理的最终效果产生关键性的影响。    从功能面看，三个组件分别承担着明确的分工职责:F5负责网络层的接入和负载均衡，ODR负责HTTP层应用请求的解析和路由，WebSEAL负责验证请求的身份合法性。因此从逻辑顺序上，一个应用请求应首先由F5接入，再由WebSEAL验证其身份合法性，最后由ODR进行解析，并分发给后端应用系统进行处理。    据此在设计应用请求处理路径时，确定了如下几条原则:    (1)所有采用并行或集群模式的组件和应用，其相关请求必需经过F5进行接入;    (2)所有需要进行单点登录的应用系统，其相关请求必需经过WebSEAL，进行验证;    (3)凡是部署在应用平台云上的应用，其相关请求必需经过ODR，进行解析和路由分发。    根据应用是否集成到门户中(实现单点登录)以及是否运行于应用平台云(WVE)上，可以将应用分为四类:    (1)运行在平台云(WVE)上，同时也集成到门户中(实现单点登录):    (2)运行在平台云(WVE)上，但不集成到门户中(不实现单点登录);    (3)不运行在平台云(WVE)上，但集成到门户中(实现单点登录);    (4)小运行在平台云(WVE)上，也不集成到门户中(不实现单点登录)。    请求转发过程见图4:  图4应用平台云与集成平台核心组件关系及请求处理路径说明需要特别说明一点，企业门户是个特殊的组件。它既作为一个J2EE应用，运行于应用平台云之上，又作为一个集成类组件，负责应用界面的核合;在设计其部署模式时，需要兼顾其不同的角色，既需要对其进行动态集群的扩展，又需要配置其和后端应用系统的集成关联关系。    设计完成的部署方案见图5.  图5.应用平台云逻辑部署图6 实施效果    应用平台云实施后，在以下方面取得了显著的提升:物理服务器CPU平均利用率达到60%以上，内存平均利用率达到80%以上，系统资源利用率提升。应用服务器资源池所依赖的服务器物理设备总体数量，比实施前相关系统使用设备总量降低30%，所需服务器设备数量减少。系统资源配置变史实施周期从实施前3个月，缩短至10个工作日，系统资源配置变更实施周期缩短。系统可用性从实施前的平均99%提升为实施后的99.9%，提高业务连续性和系统可用性。7 总结    集成整合是当前烟草行业信息化建设的重要工作内容之一。行业信息化在经历了应用整合(EAI)、S0A,流程整合(BPI)等一系列有益的实践之后，云计算的出现和发展为集成整合带来了新的启示和思路。    山东烟草应用平台云项目结合山东烟草信息化现状及新时期企业战略发展对信息化提出的新要求，通过引入云计算模式，利用虚拟化、自动化资源配置等先进技术，建立统一的应用服务支撑平台，实现IT资源的充分合理利用及智能化调度管理，达到丁预期的效果，并且为山东烟草建立私有平台云进行了必要的探索和实践，为信息化逐步向云计算迁移做了必要的经验积累和技术储备。