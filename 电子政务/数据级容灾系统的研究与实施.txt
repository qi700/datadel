数据级容灾系统的研究与实施
文章介绍了甘肃省电力公司根据国网要求,结合自身特点设计出涵盖了SG186系统的四大核心应用,一体化平台,综合管理和网络基础服务,以及各应用系统及其子模块的数据级容灾方案。重点阐述了甘肃省电力公司在实施中,针对公司原有SAN网络特点进行资源整合,并采用多种数据复制技术,实现了容灾系统的建设目标。引言    随着国家电网公司信息化SGl86工程的建成，信息系统数据的可靠性和业务的连续性变得愈发重要。为了满足国家电网公司业务及信息化建设的需要，参照国内外容灾中心建设经验，国家电网公司根据集约化发展要求出发。贯彻统一规划、同步建设的原则，按照国网统一要求，将甘肃省电力公司列入数据级容灾建设单位，要求公司完成对数据归集及存储级优化整合。实现数据级容灾。    甘肃省电力公司信息系统数据级容灾实施的目标是完成甘肃省电力公司信息系统从本地生产中心到西安容灾中心的数据级容灾。甘肃省电力公司信息系统数据级容灾实施范围涵盖了SGl86系统的四大核心应用、一体化平台、综合管理和网络基础服务。确保甘肃省电力公司业务系统的数据安全性、业务系统灾难时的可用性。1 实施方案研究及关键技术    甘肃省电力公司容灾系统建设的基础是保证现有的系统安全稳定运行，核心任务是保护数据资源，并为未来将要进行的应用级容灾做好可行性分析以及准备工作。    本次甘肃省电力公司容灾系统建设与以往只对一个或者几个业务系统容灾有所不同，甘肃公司容灾系统建设有更高的目标：容灾包括了大部分业务系统，采用多种技术，建设两地容灾中心(甘肃生产中心、西安异地容灾中心)，实现数据级容灾，并为后续的应用级容灾做好准备。    1.1方案研究    甘肃电力公司对公司信息系统现状进行调研，对容灾所涉及到的系统的软硬件架构、存储现状及网络拓扑进行调查。通过对业务关联分析，对衡量容灾系统性能好坏主要有2个主要指标：RTO(恢复时间目标)和RPO(滞后时间目标)进行更新迭代，确保容灾系统建设不会对业务系统产生影响。    针对甘肃公司信息网络机房多而分散，SAN孤岛多，IP SAN网络等现状提出“先整合再容灾”的方针，先对原有SAN网络进行整合，在确保系统安全可靠运行的前提下，整合现有信息系统软硬件资源，标准化信息系统软硬件设备，明晰信息化基础设施架构，提高软硬件资源部署灵活性，提升服务器负载率，减少信息系统占用机房空间，降低机房能耗，降低软硬件购置费用。方便信息系统运行维护。    1．2关键技术    数据级容灾系统建设中的技术难点是数据的实时传输。甘肃省电力公司容灾系统拟采用数据库复制和存储复制2种数据复制技术。    1.2.1 GoldenGate敷捂库复制    GoldenGate是一款数据传输软件，其特点是占用系统资源少，能够实现实时数据复制，对带宽的要求不高。传输距离长，能够达到1000 km以上，数据备份是双向的。由于这些特性GoldenGate用途更加广泛，可以用于数据备份、数据容灾、数据迁移、数据集中等场合。    1)GoldenGate数据复制方式分为：单向数据复制、双向数据复制、广播复制、多层复制、集中复制方式等。    2)单向数据复制方式的原理是：先读取源端系统的数据库日志，确定需要执行的操作和需传输的数据，然后通过网络将数据传送到目标端。    3)双向数据复制方式是基于单向数据复制方式的，原理是两端同时进行数据复制，两端互为源端和目标端，双向复制之间互不干预。也不会影响两端生产系统的正常运行。其特点为：对网络带宽资源使用率低、系统性能影响低和执行效率高等。能够为企业提供实时切换的异地备份系统，满足现代企业信息化建设中对数据安全、效率的需要。    1.2.2存储虚拟化    存储虚拟(Storage Virtualizatlon)最普遍的理解就是对存储硬件设备的抽象化表现。通过将一个或多个目标服务或功能与其他附加的功能集成，提供全面功能的服务。虚拟化是作用于一个或多个实体上，而这些实体则是为系统提供存储资源或服务的。典型的虚拟化技术包括如下一些情况：系统复杂性屏蔽，新功能的增加或集成，整合、仿真或分解已有的服务功能等。    存储虚拟化技术是一种用于整个信息系统环境、用于简化相对复杂的底层基础架构的技术。存储虚拟化的核心思想是将资源的逻辑映像与物理存储分开，从而为系统和管理员提供一幅简化、无缝的资源虚拟视图。    对于用户角度，虚拟化存储资源就像是一个巨大的“存储池”，用户不会看到具体的介质，也无须关注自己的数据经过哪一条路径，通往哪一个具体的存储设备。2 项目建设    容灾系统建设实施前，首先需要进行可行性研究，根据业务系统的现状，通过对应用系统业务影响分析，收集用户反馈情况，得出容灾系统的关键指标RTo，RPO，根据此指标设计方案，确保各业务系统的容灾建设指标的可靠性和合理性。   2.1 容灾系统SAN整合    甘肃省电力公司原有拓扑结构各业务系统SAN网络呈各自封闭状态，SAN孤岛多，仅营销同城容灾和数据中心与机房设备有连接，其余SAN网络相互之间没有连接。SAN网络拓扑及SAN网络交换机间级联必须重新规划。    根据甘肃省电力公司的现状分析，SAN网络和存储直接按照国家电网的目标架构进行建设。采用导向器级别的SAN交换机为核心设备，高端存储接人核心，业务应用系统的数据库服务器接入边缘交换机，通过将原有的SAN交换机替换为导向器级别交换机，其余各自SAN网络以边缘交换机形式连接至核心SAN网络，从而实现“核心一边缘”式的SAN网络架构。规划后的sAN网络如图1所示。 图1 整台后的SAN网络    2．2 GoldenGatB救据库复制    经过前期的咨询、现状调研分析、目标架构初设等阶段，经过与各业务部门的访谈、系统模块的梳理及各业务部门对RP0和RTo指标的要求，同时结合甘肃省电力公司的现有环境，从方案的可行性、先进性以及经济性的考量，决定对营销系统、生产管理系统生产库，ECC数据库和数据中心数据库采用GoldenGate复制技术进行容灾保护。    为满足Oracle GoldenGate复制要求，生产端数据库需进行归档模式、数据库参数修订、备份策略、复制队列、等改造设计。实施过程中，首先需要配置Golden'Date进程，包括配置GoldenDate管理进程依据表分组信息，配置相应的多个抽取进程，配置与抽取进程相对应的本地队列，配置与本地队列相对应的搬运进程。配置与搬运进程相对应的远端队列，根据需要配置DDL复制。然后进行宕机初始化，锁定除去GoldenDate，停止Oracle内部的所有Job，重启数据库，配置Gold—enDate抽取进程和本地队列。最后启动GoldenDate抽取进程，并验证是否能正常读取日志。    2．3存储复制    容灾系统SAN整合为存储复制做好了准备工作。    根据存储规划。容灾端采购XP24000高端存储用于进行生产端灾各数据的存放，按照生产端的设备分配提出容灾端存储空间需求，将甘肃省原有存储进行虚拟化，采用External Storage技术实现所有存储设备的虚拟化，虚拟化的过程如图2所示。    描述为完成存储优化整合所需的空间规划，包括数据迁移空间需求、数据库复制日志空间需求、存储数据复制日志卷空间需求等内容。如果存在数据迁移，应该提供数据迁移对存储的要求，LUN大小是否有特殊要求：如对单个磁盘大小无要求，则按规划大小(如50 G)的整数倍分配。    甘肃省电力公司数据端到容灾端采用异步数据复制技术，采用复制软件为CA复制软件。CA复制在设计时。已经考虑到了大数据量的初始化复制可能对生产系统IO性能的影响，为了减轻或避免影响。CA设计将生产IO定为最高优先级。而将数据初始化复制定为较低优先级，因此CA的初始化数据复制是在首先尽可能确保生产IO性能的前提下，执行复制的。
图2 存储虚拟化示意3 结语    本文首先介绍容灾系统的概念，详细分析了容灾系统相关技术与设计方案，并介绍了甘肃省电力公司数据级容灾系统项目建设。    甘肃省电力公司容灾系统按照国家电网公司容灾规范建设要求，按时完成了数据级容灾系统项目建设，并通过了国网数据验证。整个容灾系统包括的技术、方案，系统参数等，都按国网要求进行了实际调研和分析，从而保证了容灾系统本身稳定可靠，为甘肃省电力公司信息系统的长期安全、可靠、健康运行提供了技术保障，并为未来的应用级容灾系统建设打下了坚实的基础。