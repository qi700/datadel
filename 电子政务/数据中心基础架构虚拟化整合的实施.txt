数据中心基础架构虚拟化整合的实施
天津机辆轨道交通装备有限责任公司（以下简称天津装备公司或公司）是中国北车股份有限公司的全资子公司，是中国铁路机客货车配件的生产、研发基地。企业始建于1909年，由清政府借款，德国人承建并代管，具有百年历史。中华人民共和国成立后，企业历经六十年的发展和五次较大规模的技术改造和厂区扩建，具备了数控加工、精密锻造、热处理等工艺手段，拥有了工艺制作、现代化检测、计算机应用等科技能力。    一、前言　　天津机辆轨道交通装备有限责任公司（以下简称天津装备公司或公司）是中国北车股份有限公司的全资子公司，是中国铁路机客货车配件的生产、研发基地。企业始建于1909年，由清政府借款，德国人承建并代管，具有百年历史。中华人民共和国成立后，企业历经六十年的发展和五次较大规模的技术改造和厂区扩建，具备了数控加工、精密锻造、热处理等工艺手段，拥有了工艺制作、现代化检测、计算机应用等科技能力。　　公司注册资本为16600万元，占地面积360000平方米，公司职工人数1506人，各类机械动力设备1208台（套），其中数控加工设备110台、检测设备174台。主产品有弹簧、缓冲器、制动机、增压器、调速器。随着公司产品结构调整步伐的不断加快，出口美国、俄罗斯箱体系列及多元产品工程机械涨紧装置系列、无缝钢管行业轧制工具系列、环保食品机械系列产品已稳定规模，石油开采行业智能抽油机系列产品已经量产。　　2000年2月获得质量体系认证；2005年12月获得环境管理体系认证和职业健康安全管理体系认证；2007年5月计量试验中心通过了ISO/IEC17025国家实验室认证。2011年通过了天津市企业技术中心和国家高新技术企业的认定。2012年4月，北车弹簧研发中心在公司设立。2012年11月份通过IRIS体系认证。　　在行业地位不断提升的前提下，信息化建设逐渐成为了公司发展的重中之重，在不断深化建设中，天津装备公司以技术创新为目标，采取行业标准方法方式予以改进提升，不断与时俱进向现代化企业大步迈进。　　二、成果实施背景　　随着公司信息化发展，各种信息化应用服务要求不断增加，硬件服务器需求逐年上升，对系统安全性的要求不断增强，UPS不间断电源，空调等配套附属设施、服务器维护费、软件费、电费、服务人工等附加成本也随着服务器的增加逐年上升。技术维护人员因维护量过大、收入偏低等原因也不断流失，为应用系统的使用留下诸多信息安全隐患。　　此时，如何为企业解决以上问题，节省企业信息化开支，增强企业信息化能力，如何以技术为手段开展管理道路，成为了管理信息部的首要任务。　　作为管理信息化的技术人员，在信息化探索的道路上经过多次大胆的尝试，在技术测试中不断总结经验教训，根据公司不断发展的业务需求与经济效益和管理安全性进行总体全面的考虑，进行了无数次的调研与认证，在2012年公司迎来了“中国北车信息化登高2号工程天津装备公司财务业务一体化ERP项目”的契机，结合公司ERP项目实施的需求，与公司发展对基础架构的虚拟化整合的方案已到了势在必行的阶段。　　三、管理成果的主要内容　　1.项目的规划　　良好的方案设计是项目实施的关键，根据公司实际情况，管理信息部技术人员进行了详尽的规划措施。　　1.1 资金现状与需求调研　　公司对信息化投资在最近两年可谓不遗余力，信息化投资率达到每年新增设备的57%，今年对ERP服务器的投资也是占了较大份额，但每次投资决定都经过漫长的研究与分析，信息化资金来之不易，作为技术人员我们在拿到资金预算后都决心要将不多的预算用在刀刃上，所以根据ERP需求与未来使用要求应为软硬件做到一次投资，五年内服务器及系统应用可无需有再次太大投资。　　1.2 方案选型　　首先Citrix 公司给我公司提供了桌面虚拟化整体解决方案，并提供瘦客户机进行方案测试，在调研过程中发现，由于公司区域比较广，网络线路形式多种多样，有无线、网线、光纤、DSL，且带宽质量无法保证。客户端近几百台，如有问题，维护人员将疲于奔命影响ERP等业务的正常实施。且瘦客户机价格与市场上台式机价格相近，若不用瘦客户机，采用公司原有机器，又因配置参差不齐，需再次进行部分投资而与我公司需求不符。　　HP公司为我公司原服务器供应商，向我公司推荐微软 Windows Server 2008 Hyper-V与VMware ESXserver服务器虚拟化方案。经调研微软 Windows Server 2008 Hyper-V方案中虚拟化功能只在X64位系统的Server 2008标准版、企业版、数据中心版中作为虚拟管理程序提供，且硬件需求至少为64位可激活带VT技术。而对非微软系统的支持较差，而我公司部分杀毒软件网关及行为管理服务器恰恰是Linux底层系统服务的，所以又与公司需求相冲突，与需求不符。　　而VMware ESXserver服务器虚拟化的出现弥补了各个方面的不足，并且经调研VMware在服务器虚拟化上是市场占有率较高，成熟案例较多，易用性也较高，与我公司需求较符合。　　至此选型有了方向，VMware服务器虚拟化在资金允许的情况下为首要选取方案。　　1.3 供应商招标　　根据公司《供应商管理办法》的规定，对ERP需求的服务器配置我们进行了前期调研。IBM、DELL、HP公司在服务器及虚拟化方案软硬件实施上均有较强的实施能力，并都给出了较完善的实施方案方法，能更好的根据公司需求做出符合未来五年规划及系统应用软件的使用，并可标准化。　　后根据公司采购流程进行了招标采购，在同一基础上，三个公司都做出了较完善的准备，通过样机测试，兼容性比拼等方式进行了比较与测试，测试根据分数评判，最终选取IBM公司以成熟的VMware ESXserver作为实施软件，不仅能达到ERP软件要求的最高功能，而且能确保创新项目《数据中心基础架构虚拟化整合平台》，为所有服务器提供稳定与兼容性并存的易用性平台，拔得了招标头筹。　　1.4 规划实施要求　　于是在借助ERP项目开展后硬件资源需求的前提下，根据公司实际在北车集团各兄弟企业，我公司率先创新使用服务器虚拟化平台，大胆提出利用ERP项目新购服务器，建立《数据中心基础架构虚拟化整合平台》，组建服务器虚拟化群集，安装VMware vSphere服务器虚拟化软件，将信息一体化项目的ERP、PLM应用、数据、报表、测试和旧有过保修期的服务器，及隐患严重，但极为重要的14台应用服务器通过虚拟化技术整合到三台新服务器群集中，并最终可利用三台服务器群集，达到可虚拟整合25台服务器使用的目的。　　逐步形成只需一人维护，即可充分发挥服务器所有资源，并保证服务器应用的安全使用，降低能源使用率。使因服务器老旧损毁，丢失数据等原因造成的业务停顿的隐患逐步消失。　　增加管理图像化，维护人员可通过VMware vSphere服务器虚拟化软件产生的图形报表掌握服务器状况，灵活调整服务器配置。　　2.网络拓扑建立　　虚拟化技术的引入，不会对现有的网络架构做本质上的颠覆，原先的架构仍然是延续的，只是在数据中心的基础设施方面，大大减少了需要维护和管理的设备，如服务器、交换机、机架、网线、UPS、空调等等，而且安全性也有增加。　图1 网络拓扑　　3.方案构成　　3.1 硬件实施部分　　使用用于服务器整合的高性能服务器。　　对现有 3 台 IBM x3850x5 进行扩容，根据前期规划的要求，使这3台 server 每台达到虚拟化 10～15 台虚拟机的配置要求，然后安装虚拟化软件，以这 3 台 server 为基础搭建虚拟化架构。　　选择这 3 台 x3850x5 的目的很明确，就是尽量降低购买成本，充分利用现有资源。并且 x3850x5 的扩展性还是比较强的，经过有计划的扩容之后，基本上可以达到虚拟化整合的初期效果。　　这 3 台 x3850x5 服务器的配置如下：　　四个 Intel 6 核 Xeon E7-4807 处理器(1.86GHz，18M 缓存)，配置 4 块内存板，128GB(16x8GB) 1066MHz DDR3 内存，标配 4 个 2.5" SAS 热插拔硬盘托架，标配 M5015 RAID 卡，主机带两个千兆以太网端口，标配 2 个 1975W热插拔电源(带 2 根 PDU 电源线)， 4U 机架式，DVDRW 光驱，2*8GB HBA。　图2 物理主机在虚拟系统内的信息显示　　3.2 软件部分　　主要配置以“12+1”方式体现，其中“12”指的是 12 套 VMware 虚拟架构套件企业增强版（VMware vSphere5 Enterprise Plus）使用授权；“1”指的是 1 套 VMware vCenter Management Server 使用授权。其中VMware VSPHERE 套件按照 CPU 数量计算 license，一个 license 管理 1个 CPU；　　按照 3 台 x3850x54 计算，每台 x3850x5 是 4 颗 CPU，需要采购 12 套VMware VSPHERE 虚拟化套件。另外需要单独采购一套 VMware vCenter 管理软件。根据需要可选购 VMware PSO 部门提供的专业服务通过本服务，可以掌握如何根据实际情况做 vSphere 的高性能设定，掌握 vSphere 的基本技术和最佳实践经验；VMware 提供 2 台 ESX server 服务器样机的设定，可以模拟修改样机的设定，根据实际情况做一定性能的设定。配置一套 vCenter Management Server；可提供 4 天的用户现场 PoC（概念验证）支持，便于在项目正式开始实施前，对虚拟环境进行试用与演练，同过该 PoC，可让以后进行维护支持的工程师掌握更多的操作技能与经验。　　4.实施主要举措　　4.1 具体虚拟化服务分析实施　　分析现有服务器的应用层次，并根据重要性在不影响正常工作业务的情况下做好服务器虚拟化系统的创建、迁移工作，通过VMware vSphere服务器虚拟化软件创建ERP、PLM各个虚拟服务器系统，并将各个旧有保修到期，及有隐患服务器迁移至虚拟化服务器群集之中去，合理配置每台服务器承载虚拟机的数量，使其虚拟机使用率不超过本身最大使用率的70%，这样通过技术手段对物理服务器群集做虚拟化高可用HA配置，达到动态保护，可在运行中承受一台物理机受损而数据系统照常运行不受损失的目的。　　4.2 管理制度建立　　制定了《天津装备公司-数据中心机房管理办法》、《服务器机房登记制度》和《IBM公司服务器季度服务巡检表》、《虚拟服务器操作使用规范》。　　4.3 正版软件安装　　安装 VMware 虚拟架构套件企业增强版（VMware vSphere5 Enterprise Plus），并使用授权注册其中VMware VSPHERE 套件，按照 CPU 数量计算 license，一个 license 管理 1个 CPU；　　安装硬件分区许可，并根据规划，为虚拟空间进行物理分配，为公司存储、虚拟化留出使用空间。　　安装正版操作系统，激活相关系统，将公司所有涉及虚拟化系统的服务全部操作系统正版化。避免版权纠纷。4.4 信息化安全管理　　通过公司原有备份软件Symantec NetBackup Enterprise Server V7.5，对服务器虚拟化软件中的重要虚拟机系统进行每日备份，利用过保的旧有服务器、存储设备进行虚拟机镜像备份文件的存储，并根据指定制度作定时数据验证，与数据灾难应急练习，为信息化系统安全作出全面的保障。
图3 对虚拟主机及物理主机进行策略备份　　4.5 项目实施进度　　4.5.1 1月份具体实施进度　　2013年1月，安装虚拟服务软件、建立操作系统，将ERP、PLM项目所需服务器创建安装至虚拟化群集中，其中ERP项目应用服务器、数据服务器、报表服务器、测试服务器共四台。PLM应用、数据服务器共两台。节省服务器三台。　　4.5.2 2月份具体实施进度　　2013年2月，迁移已有DNC服务器一台、DNS服务器一台、信息平台服务器一台、OA服务器一台。节省服务器共四台。　　4.5.3 3月份具体实施进度　　2013年3月，整理公司已有数据并迁移FTP服务器一台，存储服务器一台。　　4.5.4 4月份具体实施进度　　2013年4月迁移用友服务器、抽油机事业部、国际贸易部、采购部数据共享平台服务器各一台。节省服务器四台台。    4.5.5 计划外进度的实施    利用旧有服务器安装Symantec NetBackup Enterprise Server V7.5存储备份系统，并制定策略，定时对已安装虚拟服务器进行镜像备份，并对可利用旧有服务器搭建了邮箱服务平台。　　节省计划内设备开支。　　对于测试阶段所需模拟机，测试机，可对在虚拟机平台根据需求灵活配置，在需要应用时启动，建立测试环境，用后只需保留还模板镜像，即可停用，下次再用还可再次快速组建，不占资源。图4 可灵活配置的虚拟主机　　4.6 整体五年规划　　确定公司信息化服务器硬件购买与发展方向，做不断扩大虚拟化集群的准备，利用虚拟服务技术做好五年规划。　　四、数据中心基础架构虚拟化整合实施后的成果和展望　　随着虚拟服务数据中心基础架构的形成，在几个月的运行中与预测规划的效果一直，符合公司信息化发展与未来适用的要求，具体成果如下：　　1.成本大幅降低　　降低总体拥有成本（TCO）、提高投资回报率（ROI）通过服务器整合，控制和减少物理服务器的数量，明显提高每个物理服务器及其 CPU 的资源利用率，从而降低硬件成本。　　降低运营和维护成本，包括数据中心空间、机柜、网线，耗电量，冷气空调和人力成本等。　　2.运营效率大幅增加　　加快新服务器和应用的部署，大大降低服务器重建和应用加载时间。主动地提前规划资源增长，这样对客户和应用的需求响应快速，不需要象以前那样，需要长时间的采购流程，然后进行尝试不需要象以前那样，硬件维护需要数天/周的变更管理准备和 1-3 小时维护窗口，现在可以进行快速的硬件维护和升级。　　3.系统安全性大幅度提高　　由于采用了虚拟化技术的高级功能，并配置虚拟化高可用性功能HA，使业务系统脱离了单台物理硬件的束缚，可以实现更高级别的业务连续性要求，提升了系统安全性、可靠性。通过虚拟化技术，降低了物理硬件的故障影响力，减少了硬件的安全隐患。通过虚拟化整合，减少了设备的接入数量，安全防范的范围能够得到更有效地控制。　　4.陈旧硬件和操作系统的投资保护　　虚拟化平台具有更广泛的操作系统（OS）兼容性，不再担心旧系统的无法使用，并且通过自动更新功能实现维护和升级等一系列问题。　　5.为将来的集中网络存储提供可能　　对于由于成本或者其他原因没有接入到存储网络（SAN， iSCSi 和 NAS）的服务器，整合后物理服务器数量减少，可以考虑接入到存储网络，这样充分利用网络存储的优势，将这些分散的数据集中管理备份，为这些服务器和应用的以后的容灾打下基础。同时，通过虚拟机的特有功能和网络存储的有效结合，提高了这些应用的可用性，移动性和灵活性。　　对公司原计划购买的UPS设备，空调降温设备进行暂缓购买，并逐步减少旧有服务器的全功率运行，做冷备份处理，节省大量能源，降低了能耗。图5 天津装备公司虚拟化数据中心图表　　五、总结　　通过在天津机辆轨道交通装备有限责任公司实施数据中心基础架构虚拟化整合后，大量设备整合成动态的虚拟化资源池，从而大大提高资源利用率，降低成本，增强了系统和应用的可用性，提高系统的灵活性和快速响应，实现服务器效率的大幅提升，并使系统管理员可以灵活的运用虚拟化技术，为公司进行服务器测试与调配，避免因人为调动给公司造成安全损失，在整体信息化规划的前提下，天津装备公司逐渐对服务器使用标准化，为未来信息化系统的升级打下了良好基础，可随时迎接新的信息化项目的开展。