PLC构成PROFIBUS网络原理及应用
关键字：现场总线; 可编程逻辑控制器; 开放式系统 引言　　车站联锁系统是铁路信号系统中的一个重要组成部分，它的主要任务是控制车站中的信号机和道岔，并且对信号灯状态进行处理和对进路进行选择等。随着铁路信号系统的信息化发展，微机联锁系统必然取代旧式的电气联锁系统。　　就国内外现状来看，大多采用上、下位机的办法来实现对车站信号的控制;有些微机联锁系统中，下位机主要实现数据的采集、命令发送、数据输出等，而把主要的联锁功能置于上位机，这样一来，上位机负担太重，一旦上位机产生故障，不能保证系统的安全性、可靠性。如果能够将联锁功能块置于下位机，而且下位机安全性、可靠性比较高，那么整个系统的安全性、可靠性就能够得到有效保证。　　在以前的微机联锁系统中，用工业控制机作为下位机，实现联锁功能，但不能保证系统冗余，这样就不能保证整个系统的安全性、可靠性。因此，就要不断更新和研究，寻求更完善的、更可靠的硬件、软件环境，以提高系统性能和安全系数。用西门子PLC完成联锁功能，构成PROFIBUS-DP/MPI分布式网络系统，这样整个联锁系统安全可靠。　　PROFIBUS现场总线技术是随全数字信号系统的发展而产生的，是由德国组织开发的工业现场总线协议标准——PROFIBUS现场总线标准（DIN19254）。　　PROFIBUS是近年来国际上最为流行的现场总线，也是目前数据传输率最快的一种现场总线（传输率可达12M波特），因此在很多领域内广泛应用。它是不依赖于生产厂家的、开放式的现场总线，各种各样的自动化设备均可通过同样的接口交换信息。　　PROFIBUS-DP（DistributedI/OS-分布系统）是一种经过优化的模块，有比较高的数据传输率，适用于系统和外部设备之间的通信，远程I/O系统尤为适合。它允许高速度周期性的小批量数据通信，适用于对时间要求比较高的自动化场合。　　笔者将以S7-400HPLC为例，结合其在铁路信号中的应用，探讨实现PROFIBUS-DP/MPI网络系统原理和方法。PROFIBUS-DP/MPI网的性质和特点　　PROFIBUS-DP适用于现场层的高速数据传送。主站周期地读取从站的输入信息并周期地向从站发送输出信息。除周期性用户数据传输外，PROFIBUS-DP还提供智能化现场设备所需的非周期性通信以进行组态、诊断和报警处理等。DP网的协议结构　　PROFIBUS定义了各种数据设备连接的串行现场总线的技术和功能特性，这些数据设备可以从底层（如传感器、执行器层）到中间层（如车间层）广泛分布。　　PROFIBUS连接的系统由主站和从站组成。主站一般要复杂些;从站为简单的外围设备，典型的从站为传感器、执行器及变送器，它们没有总线控制权，仅对接收到的信息给予回答，或者主站发出请求时回送给主站相应信息。因此，从站只需要协议的一小部分，实现起来非常方便。　　PROFIBUS协议结构是根据ISO7498国际标准，以开放式系统互联网络（Open System Interconnection，OSI）作为参考模型，该模型共有7层，PROFIBUS-DP定义了其中的第一、二层和用户接口。第3到7层未加描述。　　图1为ISO/OSI参考模型与PROFIBUS体系结构比较。用户接口规定了用户及系统以及不同设备可调用的应用功能，并详细说明了各种不同 PROFIBUS-DP设备的设备行为。物理层采用EIARS-485双绞线或光纤，连接器采用RS-485标准的9针D型插座。数据链路层提供了介质存取控制功能、数据的完整性检查以及传输执行的协议，在PROFIBUS中称第2层为现场总线数据链路（FDL）（包括介质访问存取控制（MAC）子层、现场总线链路控制（FLC）子层、现场总线管理（FMA1/2）子层），采用混合介质存取协议，对应于DIN（E）19245，支持单主或多主系统，主或从设备，最大站数为126。它包括主站之间的数据传输的令牌环方式和从站之间的主-从方式。PROFIBUS第7层包括底层接口（LLI）、现场总线信息规范（FMS）和现场总线管理（FMA7）。
图1　ISO/OSI参考模型与PROFIBUS体系结构比较　　图2为PROFIBUS-DP数据传输示意图，即主站发送请求，访问DP从站，其中包括帧格式;从站收到请求信息后，立即响应主站，并回送响应帧。
图2　PROFIBUS-DP用户数据传输DP网的性质及特点　　PROFIBUS—DP采用主从方式和低层的令牌环传递相结合的形式进行通道分配，整个网络可以将总线系统分割成线段，分步建立，段间用中继器连接，每个段可以有32个网络站，整个网络可以达到126个网站。由于最大传输速率可达12Mbps，以及其第2层采用SRD（发送并要求回送）功能，使得输入、输出数据可以在一个周期内完成，所以传输速度提高了，可尽可能地减少总线周期。而在单主站系统中只有一个主站，这种组态提供了最短的总线周期。 PROFIBUS-DP开放性好，开展性强，灵活性高。
用S7-400HPLC构成DP网，由于SIMATICS7V5.2提供有效的系统主持，可实现软件参数化I/O、多功能自诊断，功能模块更易于连接。在 S7-400H系统中，CPU之间的同步，由同步模块通过同步光纤连接，在软件和硬件方面都可以实现CPU同步。采用STEP7编程软件进行现场集中控制编程，诊断测试就象采用集中处理单元的集中编程接口时一样。在编程过程中，不需考虑硬件配置，由编程软件实现网络系统组态。MPI网的性质和特点　　CPU中用于连接象编程器这样的设备的接口叫多点接口（MPI），这是因为通过这个接口，两个或两个以上的设备可以从两个或两个以上的节点与CPU通讯。也就是说，带有MPI的CPU已经具有连网能力。MPI网络的结构与 PROFIBUS-DP网络是相同的，就是说，两种网络遵循的规则和使用部件是相同的。S7-400HPLC实现的DP/MPI网络系统　　下面是一个按照上述原理用S7-400HPLC构成的多主站DP/MPI网络的实例。　　系统结构　　整个网络系统为一个车站信号的控制，如图3所示。该网络为由两台S7-414HPLC和ET200M组成的分布式结构。PLC通过CP5611卡与上位机通信。其中一台PLC为主站，另一台为热备。　　ET200M选用西门子IM153-2。IM153-2的作用是连接I/O模板，提供PROFIBUS-DP连接;输入模块选用SM321DI32× DC24V，共需要18个模块，主模块9个，备用9个。输出模块用SM322DO32×24V，共用8个，主模块4个，备用4个。输入、输出模块都是通过 DP连接。3台上位机，都是通过CP5611与PLC的CPU相连。两个CPU之间通过同步光纤连接。　　用户界面　　每台PLC都通过CPU模块上的MPI集中编程接口和配置有MPI接口的PC机相连。我们采用西门子的CP5611与PLC的CPU相连。PC机中配置SIMATICSTEP7V5.2编程软件。　　由于是冗余系统，还需要安装西门子的冗余软件，才能做到PLC的两个CPU之间同步。3台上位机中，其中两台是操作员用的监控机，另一台为维修机。在整个系统中，上位机之间可以互相通讯，也可以与PLC之间通讯。每台PC机都要安装CP5611驱动软件，才能完成功能。　　程序结构　　系统组态及参数设置　　由SIMATICSTEP7V5.2编程软件，进入硬件组态状态，对各台PLC进行网络参数设置。首先，建立Pro2ject，如取名为C：\ swjtu，在该文件下选择网络Subnet为PROFIBUS，站名为SIMATIC414HStation，然后进行硬件组态。其次是建立各站在网络的地址。最后组态3个PG/PC站，在选项窗口中选中CP5611，并分配地址，主编程站地址为0，其余两个只要地址不相同即可。　　程序结构　　西门子SIMATICS7-400HPLC的编程器STEP7可运行在PC机的Windows环境下，界面友好，提供了梯形图、语句表和块图3种形式的编程、调试、诊断等功能。本实例采用模块化程序结构，程序由几大功能块组成，每个功能块完成一系列的控制逻辑，放置在组织块OB1中的指令决定控制程序的各功能块的执行。本例中功能块FC1是微机联锁命令处理程序，FC2是进路处理程序，FC3，FC4是微机联锁状态处理程序，FC5是常量定义，FC6是信号输出处理，FC7是道岔输出处理，FC8是信号采集。程序结构框图如图4所示。功能块为多层次调用，FC1在调用其他功能块，比如FC1调用FC9， FC9调用FC10，FC10调用FC11、FC12、FC13、FC14等。在STEP7中，允许功能块调用最多为16层。　　图3为应用于唐山钢铁集团公司焦化厂火车站的微机联锁系统的PROFIBUS-DP/MPI网络原理框图。3台监控机为监控层，PLC为联锁层，I/O为控制层。车站联锁系统主要由联锁以及信号、道岔、区段和进路的动作建立。本例中，以车站微机联锁的控制过程说明PROFIBUS-DP网络的实践应用。
图3　网络系统结构图　　进路控制过程包括进路建立、进路解锁。进路建立包括进路选择、道岔控制、进路锁闭、信号控制，进路解锁就是对已建立的进路、道岔进行的进路锁闭，进路解锁包括取消进路、人工解锁、正常解锁、中途折返解锁、故障解锁。
图4　程序结构框图　　在组织块OB1中，先调用FC1对联锁命令进行处理，其中包括进路处理、道岔处理、信号处理，调用FC2对进路进行处理，调用功能块FC1、FC2对联锁状态进行处理，再调用功能块FC6、FC7、FC8对数据进行输入输出处理。以功能块FC1命令处理程序为例，说明其功能调用过程。功能块FC1先调用 FC10进行进路选择，然后调用FC11、FC12、FC13等，对其他命令进行处理。结论　　从实际应用来看，整个网络运行良好，网络结构简单，技术性能稳定。实践证明，PROFIBUS-DP网构成的灵活实用分布式网络在铁路系统有良好的应用前景。