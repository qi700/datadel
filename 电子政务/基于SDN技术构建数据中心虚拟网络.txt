基于SDN技术构建数据中心虚拟网络
网络与计算系统的发展彼此影响并相互联系，促使计算虚拟化为如何更宽泛地考虑IT基础架构提供了一个样板。本文财网络虚拟化的必要性、传统网络技术的局限性以及软件定义网络技术特点做了分析，提出了基于SDN技术构建数据中心虚拟网络．阐述了方案的应用前景。1 引言    随着云计算的兴起。利用虚拟化和面向服务技术，数据中心突破了原有的场地出租、线路带宽共享、主机托管维护、应用托管等服务，更注重数据的存储和计算能力的虚拟化、设备维护管理的综合化。云计算技术能将网络上分布的计算、存储、服务构建、网络软件等各种网络资源和互联网基础设施统筹起来，基于资源虚拟化的方式．为用户提供通过互联网访问定制IT资源共享池能力(IT资源包括网络、服务器、存储、应用、服务)，实现资源按需提供服务，并通过规模运营降低能耗。在这种计算模式下，计算开始向网络的中心迁移，传统的计算、存储一体的个人计算机转变成计算、存储功能分离的集群系统。    网络的发展与计算系统的发展彼此影响并相互联系，计算系统主要在网络结构、网络功能和网络体系3个方面影响着网络的发展。适应计算系统虚拟化进程的网络体系结构的新设计和新想法被不断提出．网络虚拟化是一个重要的方向，在方案选优的过程中有很多因素都将影响其发展．这其中有2个关键问题必须回答：为什么网络虚拟化是必须的：为什么传统网络方法不能很好地支持虚拟化。2 网络虚拟化的重要性    通过把操作系统与底层硬件相耦合．为计算虚拟化提供了极其灵活的虚拟机运作模式，让IT把一系列服务器看成是通用资源池，计算虚拟化已经改变了IT业界关于成本、效率、新应用和服务的推出速度等方面的预期设想。与此同时，计算虚拟化为如何更宽泛地考虑IT基础架构提供了一个样板。也就是说，所有的数据中心基础架构。包括基础网络在内．应该提供一个与计算虚拟化类似的属性。计算系统经历了从大型机封闭系统到客户端——服务器水平扩展的演化过程．如果能够达到数据中心基础架构完全虚拟化的目标，将开创一个与之媲美的新计算时代。一旦基础架构完全虚拟化，应用软件不再受限于物理设备，任何应用软件将可以运行在任何物理设备上，通过自动化部署统一管理和集中控制以节约运维成本，通过硬件独立于软件和系统集成以节约资本，通过基础设施类似集中式托管的外包模式来提升市场效率。    网络虚拟化可以在逻辑上把一个物理的网络划分成多个逻辑网络．同时提供了一种强有力的方式使得多个网络体系结构同时运行(可以是不同的网络体系结构)在一共享的物理设施上。最常见的虚拟化技术有VLAN、VPN等。    网络虚拟化建议把Intemet服务提供商(Intemetservice pmvider，ISP)的角色解耦为：基础设施提供商(infrastmcture pmvider，InP)管理基础物理设施；服务提供商(service pmvider，SP)，在多个基础设施之上创建虚拟网络并提供端到端的服务。服务提供商可以动态地构建多种异构的虚拟网络．多个虚拟网络之间隔离并且共存。所以，网络研究者可以在其中的虚拟网络上进行任意的编程．并且不会影响其他的虚拟网络。    目前．实现多个网络体系结构的共存仍然需要考虑多方面的因素。如系统的稳定性、安全性、资源管理(资源计算、资源隔离)等。同时，应注意以下几个主要问题：支持多种体系结构并存：支持非IP体系结构；异质体系结构间的数据通信、交互；构建全球范围的虚拟网络。3 传统网络技术在网络虚拟化领域的局限性    由于数据中心在传统物理网络与操作系统之间的紧耦合关系，构建多租户云数据中心时，受限于多种网络技术之间复杂的相互影响和作用。使用传统网络设计达到完全虚拟化的数据中心是非常困难的，经常有一些网络限制能采用局部方案处理．但同时会在架构的其他地方产生不利影响。如在某些场景下，移动性管理可以通过在虚拟机VM上运行路由器来处理，但这会减少单个虚拟机的吞吐量，在很多场景下这是不切实际的。在使用传统方法构建虚拟化数据中心基础网络时，公认的障碍及实施难点主要包括以下5个方面。    (1)不支持地址空间虚拟化    一般情况下，虚拟机使用与物理网络相同的地址空间。如虚拟机VM的第一跳网关被配置为网络上的一个物理路由器，这种配置有2个问题。    第一，同一L2网络中，负荷分担的虚拟机VM被限制在该物理子网中，限制了移动性和VM部署点。在很多大型虚拟数据中心，由于无法在数据中心内部或者数据中心之间任意部署虚拟机VM．因此很难接纳日益增长的多租户。无论是难以支持同一租户所有的VM在相同IP子网中以及对同一租户扩展性的限制．还是所有虚拟机VM必须在同一子网空间内移动的限制．都会引起计算资源的中断运行和碎片化。第二，由于共享同一路由转发表(L2，L3)，支持重叠IP地址是困难的。在多租户环境下，特别是协同集群中的主控方．理想上应支持客户希望的任何IP地址。这允许虚拟化数据中心中更简化的迁移路径，虚拟机无需支持重编码IP地址。而虚拟路由和转发表VRF的限制、管理NAT配置的需要，使虚拟机支持重叠IP地址在一定场景下难以实现。    (2)数据中心处理规模    虚拟化对传统网络的处理规模提出了更高要求，这方面的权威例子是VLAN。传统VLAN被限制在4 096个独立段内。很多大型云计算中心的客户远远超过4 096个，要求采用多个、支持自有VLAN空间的非叠加网络来隔离用户。除VIAN限制以外，传统网络技术还有其他限制不能满足现代数据中心的规模性需求。如典型多租户虚拟数据中心每个hypervisor集群有20～80个虚拟机VM。高级别的集中托管要求物理网络(非虚拟化的)管理众多主机的地址和策略，被管理的主机数量超出传统的数据中心。因此。大型数据中心中MAC和ACL表耗尽是现实问题。即使中等规模的虚拟数据中心也需要价格更贵的高端交换机以容纳更大的L2表。 (3)整合网络层业务    负载均衡、防火墙、WAN侧优化是网络层的主要业务，虚拟数据中心中，此类业务也是主要的网络负载。在虚拟数据中心集成这些虚拟业务时，有2个问题需要处理。    第一，确保流量路由到合适的业务。虚拟化数据中心运营商通过虚拟机迁移来有效地使用服务器。由于虚拟机移动。负载均衡器需要追踪它们的位置并将请求发送到它们新的正确位置。通常用VLAN来处理，但会引起上述讨论的弊端出现，要求虚拟机VM和中间节点之间的邻接L2提供这种业务。    第二。虚拟网络需要匹配网络带宽与业务容量。由虚拟应用负责负载均衡时，如果虚拟网络流量路由到某个瓶颈点。可能出现带宽需求超过了该处容量的情况，在这种情况下就要求网络层业务本身必须虚拟化。实现网络与虚拟机间的快速协同。但现有网络无法支持虚拟私有云的客户订制化网络配置实时生效，不能实现多层网络间的协同，难以按需调整带宽。    (4)服务开通依赖硬件    随着计算虚拟化的发展。任何虚拟机VM可以运行在标准服务器上．也可以完全自动地实现服务开通和虚拟机管理。然而。为虚拟机VM创造一个独立网络(及它们关联的网络策略)需要通过设备商定义API配置硬件来手动实现闭。这种方式面临几个问题：数据中心运营主体与特定硬件供应商绑定，如果是手动配置，容易出错；另外，如果部署某种网络策略，不引起混乱而实现升级或者替换网络设备是很困难的。    (5)网络业务的提供能力与硬件设计周期相关联    增加新业务的能力受限于新硬件的提供时间和IT业界部署周期。硬件特性部署周期一般又受限于ASIC的设计时间，从18个月到4年不等。由于部署周期过长。大型虚拟数据中心运营实体不依赖物理硬件来开通虚拟网络业务或者提供虚拟网络服务。为了能够快速地通过软件开发来提供新业务，多数大型数据中心会在网络边缘提供基于软件的服务。4 SDN技术构建数据中心虚拟网络    如图1晰示，软件定义网络(SDN)，采用OpenFlow协议构成一个控制／转发分离的网络，开发者，用户可以很容易地在控制器上编程控制网络的转发行为，而转发面是一个完全按照nowtable流表规则进行转发的简单硬件设备，SDN控制转发分离的可编程网络架构如图1所示。SDN具有如下特点：转发面和控制面分开承载。数据转发和控制信息可共用物理网。但逻辑上可以使用不用的路由协议分开承载；集中控制，集中控制是简化网络管理的关键，是实现网络操作系统(NOS)、网络可编程的基础：控制和转发的开放接口Opennowr是网络迈向开放的“桥头堡”：网络虚拟化，网络资源可逻辑分割，使物理网络可切分成多个逻辑网络。    像云计算一样，网络将向虚拟化方向演进，使工作负荷与物理网络解耦合。这样才能使计算虚拟化的潜力得以完全发挥。但传统的网络方法不能很好地胜任该项任务。采用云计算的思想设计数据中心虚拟化系统的整体架构，整合计算、网络、存储，通过SDN技术将数据中心的网络资源池化．形成统一的资源调度组，如图2所示。  图1 SDN：控制转发分离的可编程网络架构  图2 SDN技术构建虚拟化数据中心 软件定义网络提供了网络虚拟化架构。克服了传统网络的缺点，提供虚拟主机的优势，如可隔离、移动性、扩展性、无限制的动态业务开通能力，与硬件设备解耦合等。将SDN技术应用到数据中心网络中，使网络资源能够与计算资源和存储资源一起进行统一调度，并提供开放接口给上层应用．进一步提供新业务开发能力．它为数据中心整体解决方案带来了以下优势。    (1)业务即软件，实现完全虚拟化地址    控制面、转发面分别演进，转发面不感知任何业务逻辑，只是机械地按照流表中的指令集进行转发，从而实现数通设备转发面与控制面的解耦，使数据中心网络摆脱网络硬件的束缚．只关注对网络的功能需求，彻底解放了软件的创造力，使业务开展借助快速创新按软件发布周期迅速跟随市场演进。无需手动配置或者重新布线基础设施．业务实施可以动态添加、扩展和配置。    允许虚拟网络之间的重叠地址，无需重编IP地址即可桥接或者迁移物理网络到虚拟网络，允许多重IP地址机制(如IPv6)运行在IPv4网络上。通过虚拟服务器、虚拟存储、SDN间的联动机制，将虚拟机关联的网络特性同时迁移，保证虚拟机迁移完成时，网络同步可用，整个过程也是自动化执行的。    (2)集中控制面，易管理    与数据中心分散地管理数十台乃至数百台交换机相比，一个集中的管理点无疑大大降低了管理的复杂度。    Opennow的集中控制能力使得全局、动态转发策略非常容易维护，实现一次配置、处处生效。如基于MAC的VLAN，只要在控制器中配置后，无论该主机接入哪个交换机，对应的VLAN均会生效。    新的转发规则、拓扑算法无需改动交换机硬件，只要在控制器中实现一个软件模块或编写一段脚本即可。控制器本身基于商用服务器、操作系统，安装、开发、部署网络应用模块非常容易。    可以对数据中心计算调度系统提供接口。实现计算和网络的联动调度。如在虚拟机VM集中管理器创建VM时，可以通知0pennow控制器创建网络VLAN资源以及负载均衡策略。    (3)多租户数据中心    在公有云中．数据中心提供给租户虚拟专有云服务。客户可以在此虚拟专有云中按照自己的策略分配私有的IP地址，制定私有ACL规则和负载均衡策略。租户在数据中心的安全隔离分为3类：逻辑隔离，发生在租户内部的不同密级部门，对不同业务划分不同权限；强逻辑隔离，发生在租户之间，没有业务交集，完全隔离；物理隔离，发生在涉密租户与其他租户之间，物理上完全隔离。    由于SDN具有可编程能力，SDN NOS可以加载应用模块，识别不同租户的网络流量，通过流表的控制．使数据流只能在同一租户的虚拟机间转发。通过网络设备虚拟化，实现独立的安全策略管理；独立的硬件资源享用；独立的日志报表呈现；安全特性的独享。突破VIAN 4096的限制，支持大量相互隔离的租户网络。租户通过自服务门户分配虚拟数据中心，资源按需分配。5 结束语    OpenFlow起初是应校园网的研究性需求诞生，其规范对于交换设备特性的支持相对比较完善。数据中心是相对封闭的小环境，SDN的集中控制模式可以完全控制整个数据中心，其带来的新特性不必过多考虑与互通设备的兼容性，可以最大化地发挥软件定义网络的优势。从运营管理角度来说，SDN的集中管控架构恰好与IaaS的需求是一致的。通过SDN控制器与虚拟机管理器的联动，不仅可以降低管理的复杂度，也使得IaaS的运营、业务开通更高效、快捷。    虚拟化时代的数据中心网络，引入SDN技术赋予了数据中心网络更灵活的能力，以降低网络开发维护成本．有利于推动设备侧／网络层新协议、新功能、新业务在网络上快速实现和部署，有利于加强互联网灵活应变的能力和不断革新的能力，从而推动互联网为人类提供更好的服务并创造更大的辉煌。