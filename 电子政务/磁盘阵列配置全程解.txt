磁盘阵列配置全程解
有关磁盘阵列配置的网友远不止上面这一位，针对这种情况，笔者就以一款服务器的磁盘阵列配置实例向大家介绍磁盘阵列的具体配置方法。当然，不同的阵列控制器的具体配置方法可能不完全一样，但基本步骤绝大部分是相同的，完全可以参考。
说到磁盘阵列（RAID，Redundant Array of Independent Disks），现在几乎成了网管员所必须掌握的一门技术之一，特别是中小型企业，因为磁盘阵列应用非常广泛，它是当前数据备份的主要方案之一。然而，许多网管员只是在各种媒体上看到相关的理论知识介绍，却并没有看到一些实际的磁盘阵列配置方法，所以仍只是一知半解，到自己真正配置时，却无从下手。本文要以一个具体的磁盘阵列配置方法为例向大家介绍磁盘阵列的一些基本配置方法，给出一些关键界面，使各位对磁盘阵列的配置有一个理性认识。当然为了使各位对磁盘阵列有一个较全面的介绍，还是先来简要回顾一下有关磁盘阵列的理论知识，这样可以为实际的配置找到理论依据。
一、磁盘阵列实现方式
磁盘阵列有两种方式可以实现，那就是“软件阵列”与“硬件阵列”。
软件阵列是指通过网络操作系统自身提供的磁盘管理功能将连接的普通SCSI卡上的多块硬盘配置成逻辑盘，组成阵列。如微软的Windows NT/2000 Server/Server 2003和NetVoll的NetWare两种操作系统都可以提供软件阵列功能，其中Windows NT/2000 Server/Server 2003可以提供RAID 0、RAID 1、RAID 5；NetWare操作系统可以实现RAID 1功能。软件阵列可以提供数据冗余功能，但是磁盘子系统的性能会有所降低，有的降代还比较大，达30%左右。
硬件阵列是使用专门的磁盘阵列卡来实现的，这就是本文要介绍的对象。现在的非入门级服务器几乎都提供磁盘阵列卡，不管是集成在主板上或非集成的都能轻松实现阵列功能。硬件阵列能够提供在线扩容、动态修改阵列级别、自动数据恢复、驱动器漫游、超高速缓冲等功能。它能提供性能、数据保护、可靠性、可用性和可管理性的解决方案。磁盘阵列卡拥有一个专门的处理器，如Intel的I960芯片，HPT370A/372 、Silicon Image SIL3112A等，还拥有专门的存贮器，用于高速缓冲数据。这样一来，服务器对磁盘的操作就直接通过磁盘阵列卡来进行处理，因此不需要大量的CPU及系统内存资源，不会降低磁盘子系统的性能。阵列卡专用的处理单元来进行操作，它的性能要远远高于常规非阵列硬盘，并且更安全更稳定。
二、几种磁盘阵列技术
RAID技术是一种工业标准，各厂商对RAID级别的定义也不尽相同。目前对RAID级别的定义可以获得业界广泛认同的有4种，RAID 0、RAID 1、RAID 0＋1和RAID 5。
RAID 0是无数据冗余的存储空间条带化，具有成本低、读写性能极高、存储空间利用率高等特点，适用于音、视频信号存储、临时文件的转储等对速度要求极其严格的特殊应用。但由于没有数据冗余，其安全性大大降低，构成阵列的任何一块硬盘的损坏都将带来灾难性的数据损失。这种方式其实没有冗余功能，没有安全保护，只是提高了磁盘读写性能和整个服务器的磁盘容量。一般只适用磁盘数较少、磁盘容易比较紧缺的应用环境中，如果在RAID 0中配置4块以上的硬盘，对于一般应用来说是不明智的。
RAID 1是两块硬盘数据完全镜像，安全性好，技术简单，管理方便，读写性能均好。因为它是一一对应的，所以它无法单块硬盘扩展，要扩展，必须同时对镜像的双方进行同容量的扩展。因为这种冗余方式为了安全起见，实际上只利用了一半的磁盘容量，数据空间浪费大。
RAID 0＋1综合了RAID 0和RAID 1的特点，独立磁盘配置成RAID 0，两套完整的RAID 0互相镜像。它的读写性能出色，安全性高，但构建阵列的成本投入大，数据空间利用率低。
RAID 5是目前应用最广泛的RAID技术。各块独立硬盘进行条带化分割，相同的条带区进行奇偶校验（异或运算），校验数据平均分布在每块硬盘上。以n块硬盘构建的RAID 5阵列可以有n－1块硬盘的容量，存储空间利用率非常高。任何一块硬盘上的数据丢失，均可以通过校验数据推算出来。它和RAID 3最大的区别在于校验数据是否平均分布到各块硬盘上。RAID 5具有数据安全、读写速度快，空间利用率高等优点，应用非常广泛，但不足之处是如果1块硬盘出现故障以后，整个系统的性能将大大降低。
RAID 1、RAID 0＋1、RAID 5阵列配合热插拔（也称热可替换）技术，可以实现数据的在线恢复，即当RAID阵列中的任何一块硬盘损坏时，不需要用户关机或停止应用服务，就可以更换故障硬盘，修复系统，恢复数据，对实现高可用系统具有重要的意义。
三、磁盘阵列配置实例
当硬盘连接到阵列卡（RAID）上时，操作系统将不能直接看到物理的硬盘，因此需要创建成一个一个的被设置为RAID0、1或者5等的逻辑磁盘（也叫容器），这样系统才能够正确识别它。当然，逻辑磁盘（Logic Drive）、容器（Container）或虚拟磁盘（Virtual Drive）均表示一个意思，只是不同阵列卡产商的不同叫法。可参见以下配置的服务器有Dell Power Edge 7x0系列和Dell PowerEdge 1650服务器。
磁盘阵列的配置通常是利用磁盘阵列卡的BIOS工具进行的，也有使用第三方提供的配置工具软件去实现对阵列卡的管理，如Dell Array Manager。本文要介绍的是在DELL服务器中如何利用阵列卡的BIOS工具进行磁盘阵列配置的方法。
如果在您的DELL服务器中采用的是Adaptec磁盘阵列控制器（PERC2、PERC2/SI、PERC3/SI和PERC3/DI），在系统开机自检时将看到以下信息:
Dell PowerEdge Expandable RAID Controller 3/Di, BIOS V2.7-x [Build xxxx]（c） 1998-2002 Adaptec, Inc. All Rights Reserved. 　　<<< Press CTRL+A for Configuration Utility! >>>
如果您的DELL服务器配置的是一块AMI/LSI磁盘阵列控制器（PERC2/SC、PERC2/DC、PERC3/SC、PERC3/DC、PERC4/DI和PERC4/DC），则在系统开机自检的时候将看到以下信息:
Dell PowerEdge Expandable RAID Controller BIOS X.XX Jun 26.2001 Copyright （C） AMERICAN MEGATRENDS INC.　　Press CTRL＋M to Run Configuration Utility or Press 　CTRL＋H　for WebBios或者　　PowerEdge Expandable RAID Controller BIOS X.XX Feb 03,2003 Copyright （C） LSI Logic Corp.　　Press CTRL＋M to Run Configuration Utility or Press CTRL＋H　for WebBios
下面对以上两种情况分别予以介绍。
1. 在Adaptec磁盘阵列控制器上创建Raid（容器）
在这种阵列卡上创建容器的步骤如下（注意：请预先备份您服务器上的数据，配置磁盘阵列的过程将会删除服务器硬盘上的所有数据!）：
第1步，首先当系统在自检的过程中出现如（图1）提示时，同时按下“Ctrl+A”组合键。进入如（图2）所示的磁盘阵列卡的配置程序界面。
图1 点击看大图
图2 点击看大图    第2步，然后选择“Container configuration utility”，进入如（图3）所示配置界面。
图3 点击看大图    第3步，选择“Initialize Drivers“选项去对新的或是需要重新创建容器的硬盘进行初始化（注意: 初始话硬盘将删去当前硬盘上的所有数据），按回车后进入如（图4）所示界面。在这个界面中出现了RAID卡的通道和连接到该通道上的硬盘，使用“Insert”键选中需要被初始化的硬盘（具体的使用方法参见界面底部的提示，下同）。
图4 点击看大图    第4步，全部选择完成所需加入阵列的磁盘后，按加车键，系统键弹出如（图5）所示警告提示框。提示框中提示进行初始化操作将全部删除所选硬盘中的数据，并中断所有正在使用这些硬盘的用户。
1. 在Adaptec磁盘阵列控制器上创建Raid（容器）
在这种阵列卡上创建容器的步骤如下（注意：请预先备份您服务器上的数据，配置磁盘阵列的过程将会删除服务器硬盘上的所有数据!）：
第1步，首先当系统在自检的过程中出现如（图1）提示时，同时按下“Ctrl+A”组合键。进入如（图2）所示的磁盘阵列卡的配置程序界面。
图1 点击看大图
图2 点击看大图    第2步，然后选择“Container configuration utility”，进入如（图3）所示配置界面。
图3 点击看大图    第3步，选择“Initialize Drivers“选项去对新的或是需要重新创建容器的硬盘进行初始化（注意: 初始话硬盘将删去当前硬盘上的所有数据），按回车后进入如（图4）所示界面。在这个界面中出现了RAID卡的通道和连接到该通道上的硬盘，使用“Insert”键选中需要被初始化的硬盘（具体的使用方法参见界面底部的提示，下同）。
图4 点击看大图    第4步，全部选择完成所需加入阵列的磁盘后，按加车键，系统键弹出如（图5）所示警告提示框。提示框中提示进行初始化操作将全部删除所选硬盘中的数据，并中断所有正在使用这些硬盘的用户。
第5步，按“Y”键确认即可，进入如（图6）所示配置主菜单（Main Menu）界面。硬盘初始化后就可以根据您的需要，创建相应阵列级别（RAID1,RAID0等）的容器了。这里我们以RAID5为例进行说明。在主菜单界面中选择“Create container”选项。
图6 点击看大图    第6步，按回车键后进入如（图7）所示配置界面，用“insert”键选中需要用于创建Container（容器）的硬盘到右边的列表中去。然后按回车键。在弹出来的如（图8）所示配置界面中用回车选择RAID级别，输入Container的卷标和大小。其它均保持默认不变。然后在“Done”按钮上单击确认即可。
图7 点击看大图
图8 点击看大图    第7步，这是系统会出现如（图9）所示提示，提示告诉用户当所创建的容器没有被成功完成“Scrub（清除）”之前，这个容器是没有冗余功能的。
图9 点击看大图    第8步，单击回车后返回到如（图6）所示主菜单配置界面，选中“Manage containers”选项，单击回车后即弹出当前的容器配置状态，如（图10）所示。选中相应的容器，检查这个容器的“Container Status”选项中的“Scrub”进程百分比。当它变为“Ok”后，这个新创建的Container便具有了冗余功能。
图10 点击看大图    第9步，容不得器创建好后，使用“ESC”键退出磁盘阵列配置界面，并重新启动计算机即可。
2. 在AIM/LSI磁盘阵列控制器上创建Logical Drive（逻辑磁盘）
注意：请预先备份您服务器上的数据，配置磁盘阵列的过程将会删除您的硬盘上的所有数据!整个磁盘阵列配置过程与上面介绍的在Adaptec磁盘阵列控制器上创建容器的方法类似。具体如下：
第1步，在开机自检过程中，出现如（图11）所示提示时，按下“Control+M”组合键，进入如（图12）所示的RAID的配置界面。
图11 点击看大图
图12 点击看大图    第2步，按任意键继续，继续进入如（图13）所示管理主菜单（Management Menu）配置界面。选中“Configure”选项，然后按回车键，即弹出下级子菜单，如（图14）所示。
图13 点击看大图
图14 点击看大图    第3步，如果需要重新配置一个RAID，请选中“New Configuration”；如果已经存在一个可以使用的逻辑磁盘，请选中“View/Add Configuration”，并按回车键。在此，我们以新建磁盘阵列为例进行介绍。选择“New Configuration”选项。按回车键后，弹出一个小对话框，如（图15）所示。
第4步，选择“YES”项 ，并按回车键，进入如（图16）所示配置界面。使用空格键选中准备要创建逻辑磁盘的硬盘，当该逻辑磁盘里最后的一个硬盘被选中后，按回车键。
图16 点击看大图
第5步，如果您的服务器中的阵列卡类型是PERC4 DI/DC，此时在回车后，将显示如（图17）所示配置界面，否则请直接赶往第7步。
图17 点击看大图
第6步，按空格键选择阵列跨接信息，例如Span-1（跨接-1），出现在阵列框内。 可以创建多个阵列，然后选择将其跨接。
第7步，按“F10”键配置逻辑磁盘。选择合适的RAID类型，其余接受默认值。选中“Accept”，并按回车键确认，即弹出如（图18）所示的最终配置信息提示框。
图18 点击看大图    第8步，刚创建的逻辑磁盘需要经过初始化才能使用。按ESC 键返回到如（图13）所示的主菜单，选中“Initialize”选项，并按回车键，进入如（图19）所示初始化逻辑磁盘界面。
图19 点击看大图    第9步，选中需要初始化的逻辑磁盘，按空格，弹出一个询问对话框，如（图20）所示。选中“YES”，并按回车键，弹出初始化进程（注意，初始化磁盘化损坏磁盘中的原有数据，需事先作好备份）。
图20 点击看大图    第10步，初始化完成后，按任意键继续，并重启系统，RAID配置完成。
以上就是DELL服务器通常所采用的两种RAID阵列卡的磁盘阵列配置方法，其它阵列卡的配置方法差不多，大多数是通过阵列卡的BIOS工具进行的。有的服务器厂商，如IBM和HP还专门开发的RAID配置软件，当然不需要另外买了，这个工具软件会随服务器自带的，配置方法也类似，参照以上方法即可。