CommVault谈数据保护技术之离场备份
进入21世纪，数据已被公认为企业最重要的资产之一。美国德克萨斯州大学的一份调查报告显示，数据丢失引起的后果非常严重：一旦丢失数据，只有6%的公司可以生存下来，43%的公司会彻底关门，51%的公司会在两
年之内消失。
保护数据的手段很多，目前被广泛应用的有容灾、快照、镜象、备份以及CDP等。当数据丢失时，可以尝试采用各种方式进行恢复，但一旦所有其他的手段全部失败，就只能从备份的数据中进行恢复，所以说，数据备份是数据保护的最后一道防线！而且，备份也是解决下列问题的唯一方法：由于逻辑错误（人为出错、软件失效和病毒攻击）引起的数据丢失或数据丢失很久后才被发现。
以下是各种数据保护手段在对错误进行恢复时的性能比较。如图所示，备份是功能齐全，且相对于CDP来说，技术已经成熟，并且性价比更高的一种数据保护手段。
提到数据备份，就不能不说说数据备份的离场保护。因为熟悉存储或数据保护的人都知道，如果只是把数据从存储设备、在线设备中备份到离线设备上并不完全安全，因为存储设备、磁带库在同一个机房，万一出现断电或火灾等事故，除了磁盘会被损坏，磁带也会一起被烧毁。所以完整的数据保护策略是进行离场保护。
2005年4月，国务院信息化办公室出台了一个名为《重要信息系统灾难恢复指南》的文件，引入了灾难分级机制，将灾难恢复划成了六个等级，从最低级开始至最高等级，每一级均有最基本的一条，即对重要的数据作备份，而且用于备份的存储介质应做离场保护。
何谓“离场保护”？传统的备份仅仅将数据从主存储设备里拷贝到磁带里，而且往往主存储设备和带库在一个计算中心，这样一旦该计算中心遭遇灾难，所有的设备连同数据就一起毁灭了。正因为如此，同时也为了防止磁带失效，备份时必须有两个以上的拷贝。既然有两个拷贝，其中一个就应当被存放在异地，既能预防磁带本身出问题，又可以抵御火灾等灾难带来的影响。这就是所谓的“离场保护”。在欧美国家，大约有95%以上的企业或机构采纳了备份这一数据保护手段，并且都会有一个副本放在异地保存。这与他们对数据重要性的认识密不可分，另外也因为当地有着相当严谨的法规要求。
然后，尽管在国外数据备份的离场保护已经被普及，在国内，采用离场保护的企业少之又少，只有大约10%，其中大多数还是跨国企业。这与离场保护的实施难度有关。
传统的离场保护，首先要求在异地有一个可以合适的存放磁带的场所。根据《中华人民共和国磁性载体档案管理与保护规范》，对磁性载体（包括计算机磁带，软磁盘，录象带，录音带等）的存储温湿度变化要求：应在15-29℃，相对湿度40%-60%范围内选定一组值，一旦选定，在24小时内，温度变化不得超过±3℃，相对湿度变化不得超过±5%，最佳环境温度为18℃，相对湿度为10%。另外，在带库的防磁方面，也有严格要求：
a.磁性载体档案与磁场源(永久磁铁、马达、变压器等)之间的距离不得少于76mm
b.可使用软磁物质(软铁、铁淦氧、镍铁合金等)构成容器、箱柜，对磁场进行屏蔽；
c.磁性载体档案如装入有磁屏蔽的容器中，应距容器内壁至少26mm；
d.使用无屏蔽的容器运输时，磁性载体档案距容器外壁至少76mm
e.不得将任何磁性材料及其制品(包括磁化杯、保健磁铁、磁铁图钉等)带入库房；
f.在存有重要档案的库区，应设置测磁设备，以查出隐蔽的磁场。
除了仓库的环境要求较高以外，磁带在当地和异地的存放，还必须有专门的人员进行操作和维护。因为磁带也要根据数据备份策略进行“流转”。比如说，数据的保留周期是六个月，数据放进磁带六个月以后，这些数据就失效了。需要有专门的人员和计算机系统配合，将这些磁带从仓库中取出重新利用。基于环境和人力的限制，而且目前国内在数据保护方面的法规要求不是十分严格，所以中国的很多企业对离场保护的利用率很低；而在美国，有一家“铁山”（ Iron Mountain）公司，为全球超过90，000家客户专门提供异地存放和管理磁带的服务。假如客户向他们购买了这种服务，到了规定的时间，铁山公司会上门去取磁带，存放到他们的仓库；客户需要磁带进行恢复数据时，“铁山”公司又将指定的磁带送货上门。
好在随着技术的发展，网络的普及，以及网络带宽的延升，现在出现了一种新的离场保护方式――电子化的离场保护，即e-Vaulting：使用一种复制的技术，通过LAN/WAN网络，直接从主计算中心里面，将磁带拷贝到异地的计算中心。因此进行e-Vaulting的要求很简单，只要该企业有两个或两个以上的计算中心，并且各地均有一个相应的磁带库或者存储设备就能够实现数据的电子化离场保护。当然，一些人还是愿意选择仓库，毕竟从平均成本来说，磁带库可能成本更高，但是磁带库的温湿度等环境都已事先设定好，并且所有的操作都是自动的，而仓库却必须有专门的人员进行维护。另外，很多企业或者政府，尤其是社保、财务、电力等机构，均拥有多级计算中心，原本在各计算中心都已经有多个带库，拥有进行e-Vaulting的条件。
e-Vaulting相对于传统的数据备份离场保护，有了很大的改进。比如，当天晚上12点将所有数据完成备份，当备份结束后，就可以通过数据拷贝技术，重新读取磁带里的数据，然后复制到另外一个数据中心里的另一个磁带库，完全没有必要再建一个专门的仓库来存放磁带。
当数据出现问题时，原来主计算中心的磁带无法恢复的情况下，e-Vaulting可以直接从另一个数据中心里的磁带恢复数据。要实现离场化保护有很多方式，可以是一对一的，在北京有很多客户，尤其是银行的客户，本身在银行就有两个中心，完全可以e-Vaulting将第一个中心的数据备份完成后，在相对空闲时，复制到另外一个数据中心，反之亦然。
也可以是多对一的，许多中国企业，比如电力公司、社保局，在每个地市有很多数据做备份，如果每个地市分别做离场保护是十分困难的，成本也高
，如果把每个地市每天晚上备份的数据复制到省中心，将会容易得多。
反过来1对N也是一种较为普遍的离场化保护方式，对于非常重要的数据中心来说，备份完成后可以在上海放一份，同时在广州也放一份。也可以做“级连”，先放一份到上海，再从上海放一份到广州，然后从广州放一份到海南。
CommVault公司的前身为AT&T贝尔实验室数据事业部，从1988年至1996年为AT&T内部UNIX系统开发并管理数据备份软件ABARS；1996年从AT&T独立，销售备份产品Vault98 (ABARS)；两年后，CommVault放弃Vault98, 重新开发新的数据备份系统，并在设计新产品架构时就开发了用于e-Vaulting的核心技术Aux-Copy（辅助拷贝手段）。
CommVault在进行离场保护时，拥有其竞争对手所不具备的独特优势：合成全备份和辅助拷贝。
合成全备份(Synthetic Full)
合成全备份功能可以通过把上一个全备份和与之相关的增量备份合并起来生成一个新的“全备份”，合成全备份的优势在于生成全备份时不要再去接触原来的数据，合成的过程是在备份介质管理服务器上完成的，这就消除了对应用服务器CPU 的影响，同时可以创建一个新的全备份来做数据保护、设置新的站点和系统测试等用途。合成全备份对数据的离场保护或远程备份也很有优势，只需在第一次把全备份数据送到异地，以后每次只需将增量数据送到异地，当需要全备份副本时，可以在异地“合成”一份，这样可节省宝贵的网络带宽资源。
为了扩大ILM 的效率，合成全备份能从不同的介质上完成。例如，前一周的全备份在磁带上，而每天的增量备份在磁盘上，这样做是为了快速备份和快速恢复。合成全备份能用在磁带上的全备份和在磁盘上的增量备份来合成一个新的全备份，用来做异地保存或灾难恢复。这种灵活性使IT 技术人员能利用所有层次的存储提供最大的性能和效率。
辅助拷贝(Auxiliary Copy)
Galaxy的辅助拷贝功能可以在不同的介质和介质服务器之间创建或迁移备份数据的副本，这种“分级存储”是完全基于策略的，在系统的后台自动进行，不需要用户干预。数据副本的创建是基于策略设定的，而数据的保留和裁减是基于保留策略。辅助拷贝具有以下特点：
 备份数据的复制能在不同介质之间完成，如磁盘到磁带，磁带到磁带等，还能跨越SAN网，这种复制不是简单数据转移，在复制数据的同时还要更新数据的索引，确保数据的查找和恢复。
 复制的过程由备份介质服务器来完成，这样就能达到不影响生产服务器的目的。
 辅助拷贝能在备份介质服务器之间进行，如此一来，就可以通过TCP/IP来实现异地数据的复制。
 辅助拷贝支持“断点续传”功能，提高了利用广域网进行异地复制的效率和可靠性。
 当使用的存储方式过时了需要更新时，可用辅助拷贝把备份数据迁移到新的存储设备上。
五年前，只有极少数企业认识到数据备份的重要性，如今已有70%-80%的中国企业采用了数据备份这一数据保护手段；今天应用离场保护的中国企业只有大约10%，但是已经有越来越多的客户有了这一需求。CommVault将致力于使更多的企业应对备份的挑战，解除数据保护的后顾之忧。