国家自主密码算法的RFID证件应用安全解决方案
计算机技术和识别技术的快速进步，使得相关身份识别、认证技术得到了迅猛发展，而且在很多领域都有了应用，彰显出了它巨大的商业价值和社会价值。RFID 技术具有穿透性无屏障阅读、数据容量大、快速扫描、抗污染、数据可读写、可重复使用、安全、耐用、体积小、形状多、能实现高度自动化、信息化等许多优点，使其在身份识别、认证领域的应用得到了快速的发展。电子护照、电子身份证等用于门禁、通关和身份识别功能的证件是国内目前RFIDD应用的最大领域，也是比较成功的RFID应用领域。各类门禁、通关、交通等的证件都可以使用RFID技术实现有效的身份认证和防伪，并实现管理、定位等方便易行的功能。
RFID技术尽管相比其它技术有着高技术带来的安全性．但也存在着一些安全漏洞，我们将以大型活动的电子证件应用系统为例，来介绍系统的功能、特点、安全隐患及其安全解决方案。
一 、电子标签证件应用系统的功能、特点及安全隐患
大型活动的电子证件应用系统将所有工作人员、活动参与人员、记者、其他新闻媒体工作人员、各类官员等所持的电子证件均列人其系统管理范围，应具有门禁控制、人员定位、区域控制、提供各种增值服务等功能。
二、基于国家密码算法的证件应用解决方案
为了保证电子证件应用系统的安全，我们通过对系统安全隐患的分析总结，归纳出电子证件应用系统的安全需求包括数据完整性、合法性验证，数据访问权限控制，标签通信信道安全等几方面。我们通过加密技术实现标签与读写器和后台系统之间的双向身份认证，防止非法访问和非法跟踪；通过具有相当强度的加密算法和密钥实现标签通信信道加密，防止窃听；通过采用适用的密码体系和加密手段，防止物理攻击、数据演绎。
(一)电子证件的生命周期
1．芯片封装。由厂商将空白电子标签芯片封装成证件，等待初始化处理。
2．证件个人化。由证件管理系统将证件芯片按系统要求进行处理并发放给持证人，包含初始化和个人化两个阶段。在初始化阶段，对证件内芯片进行格式化；证件密钥下载，密钥值由根密钥通过标签UID、应用类型分散生成；初始化成功的证件UID号码被登录人数据库内。在证件个人化(签发证件) 阶段，采集并向证件内加密写人持证人的个人信息；采集并向证件内加密写人持证人的出人区域、时间段等权限信息；采集并向证件内加密写人持证人的生物特征信息；加密密钥值由根密钥通过个人化终端号、标签UID、应用类型分散生成；向数据库内登录持证人与证件对应关系信息；个人化成功的证件即可按有效期通行门禁。
3　应用。持证人使用电子证件，包含门禁人场和出场两个应用。
(1)门禁人场。未有人场记录或已出场的证件进人人场门禁机读写识别区域内；通过系统确认证件UID不在系统黑名单内；确认证件的有效期、出人区域、出人场状态；确认证件持有人的生物识别信息；通过系统对允许通行的证件加密写入人场日期、人场时间、人场门禁机号码、人场状态、入场次数，加密密钥值由根密钥通过门禁机号码、标签UID、应用类型分散生成；证件人场和黑名单、有效期、出人区域、出人场状态、生物识别异常信息被登录人向数据库内。
(2)门禁出场。已人场的证件进人出场门禁机读写识别区域内；通过系统确认证件UID不在系统黑名单内；确认证件的有效期、出人场状态；通过系统对允许通行的证件加密写入出场日期、出场时间、出场门禁机号码、出场状态、出场次数，加密密钥值由根密钥通过门禁机号码、标签UID、应用类型分散生成；证件出场和黑名单、有效期、出人场状态异常信息被登录人数据库内；出场成功的证件可以在当日再次进人本场馆或其他场馆。
4．应用管理。系统可以根据证件持有者权限的变化调整证件标签的应用权限：当系统或持证者发现证件异常时，也可以调整门票的功能，包含权限管理、锁定、注销和挂失四种应用。
(二)电子证件个人化管理系统(CPS)
CPS(电子证件个人化管理系统)是电子证件管理系统中的证件个人化平台，它根据发证数据文件和预定义的发证模板和各项应用模板，通过数据和密钥等信息指令流，将个人化信息写人证件电子标签，完成整个发证流程。对访问权限较高的证件则可加人采集持证人照片信息及生物特征信息(如指纹、掌纹、虹膜等)。在证件个人化过程中，标签芯片初始化、芯片个人化、应用装载等操作时，涉及安全控制手段，保证安全发放电子标签证件。
1．标签应用管理系统(AMS)
(1)电子证件应用管理包括以下安全功能
建立电子证件应用：认证证件标签主控密钥、基本信息保护密钥、权限信息保护密钥和生物识别信息保护密钥；持证人个人信息，权限信息，有效期和生物识别信息，经证件标签传输密钥加密写入证件标签芯片，激活门禁应用。
应用权限变更：当持证人权限或通行有效期发生变更时，管理终端认证权限信息保护密钥，采集持证人新的权限信息和有效期信息，经证件标签传输密钥加密写入证件标签芯片。
证件应用管理：当系统发现异常证件时，可以根据情况不同。对证件电子标签的门禁应用进行锁定电子证件应用、注销电子证件全部应用或废止电子证件等处理。
独立控制区域权限变更：当持证人需通行具有独立权限控制区域时，由独立区域权限管理终端认证独立权限保护密钥，将持证人通行此区域的权限和有效期经此区域的独立权限传输密钥加密下载到证件标签芯片。
(2)电子标签证件应数据管理
门禁入场：读取证件UID；使用SM1算法计算并认证门禁应用权限密钥；读取门禁应用信息，门禁应用信息包括证件号码、持证人权限、有效期、当日出入场状态(出场、入场+ 出入场日期+出入场时间+出入场次数+出入场门禁机号) 和校验码等；使用SM2算法解密证件门禁应用信息；核对证件是否处于黑名单、出入场状态、有效期和权限；对状态正常的证件，通过密钥应用接口使用SM2算法加密和计算门禁应用信息校验码；加密写入当日入场标志(入场+入场日期+入场时间+入场次数+入场门禁机号)和新的门禁应用校验码，使证件处于“已入场状态”。
门禁出场：读取证件UID；使用SM1算法计算并认证门禁应用权限密钥；读取门禁应用信息，门禁应用信息包括证件号码、持证人权限、有效期、当日出入场状态和校验码等；使用SM2算法解密证件门禁应用信息；核对证件是否处于黑名单；核对证件出入场状态、有效期和权限，对状态正常的证件，使用SM2算法加密门禁应用信息校验码，写入当日出场标志(出场+出场日期+出场时间+出场次数+出场门禁机号)和新的门禁应用校验码，证件处于“已出场状态”。数据交换：门禁系统通过数据传输接口向CMS传递由SM1算法加密的证件信息，供CMS管理和统计分析；并从CMS读取挂失和异常证件黑名单。
2．密钥管理系统(KMS)
为了防范可能的来自系统内部的安全风险，必须建立完整可靠的密钥管理系统来保护和规范密钥的存储和使用。密钥管理系统原则上采用加密机等硬件设备产生各级根密钥，并通过采用国家指定的加密算法按应用环节的需要将所需密钥下载或分散至安全存储模块中(安全模块)。在各个应用环节，安全存储模块完成密钥分散、密钥认证、传输数据的MAC计算以及应用数据的加密等功能。同时，各个应用的安全存储模块所装载的密钥根据应用需要而有所不同，保证各个应用的安全独立性。密钥管理系统分为密钥管理和密钥应用接口两个子系统。密钥管理子系统是独立运行的安全环节，负责电子证件安全管理系统所需全部密钥的产生、管理和派发。密钥应用子系统运行在所有需要操作电子证件的场合，负责电子证件的权限认证和数据加解密。
3．证件标签管理系统(CMS)
CMS(证件电子标签管理系统)，是基于电子标签的证件管理系统中的重要组成部分，CMS将贯穿每一张电子标签证件的整个生命周期，负责跟踪每一张证件的每一项操作，每一个状态及其状态的变化。通过CMS实施将保证：通过有效的安全控制和先进的技术手段保障证件电子标签的正常发行，同时对证件管理中心的业务处理能力提供支撑；通过证件的使用为其它外部系统的信息应用发展提供数据基础，提高证件信息查询和应用的效率。
在电子标签证件应用系统中，CMS有着重要地位，与CPS、KMS、AMS和业务管理系统均存在联系，证件电子标签的初始化、个人化、每个状态的改变和每次操作等情况，均通过相应的系统传至CMS，以实现CMS对每张证件的跟踪审计管理。
三、总结
我们在标签芯片采用RFIDSF算法替代MIFARE算法的基础上，研究了基于三种国家密码算法(RFIDSF、SM1和sM2)的电子标签安全应用技术，并实现了该安全技术在电子证件应用系统中的安全应用。其中，RFIDSF算法用于电子标签与读写器之间的认证与通讯安全；SM1算法用于标签、读写器、系统的密钥产生、分发、保存、使用以及数据加密；SM2 算法用于对标签信息的数据内容的签名，从而达到了电子证件应用系统的安全要求。