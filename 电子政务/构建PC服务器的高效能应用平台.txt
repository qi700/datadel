构建PC服务器的高效能应用平台
随着供电企业信息化水平的提升，PC服务器的数量和应用业务量也越束越大。如何挖掘PC服务器的性能、共享不同服务器平台的资源。已被各级管理者高度关注。针对上述热点问题，采用服务器虚拟架构技术和虚拟存储技术，科学合理地构建了PC服务器应用平台。实践证明，该应用平台具有可靠性高、性能优、稳定性佳、可扩展性强且容错能力强等优点，值得推广应用。
l、PC服务器应用平台存在的主要问题
PC服务器以其性价比高的优势承担了供电企业大部分应用业务(如Web，MIS等)的运行任务。随着PC服务器性能的逐步提高，已在企业信息化建设中逐渐成为主流运行平台，但是目前PC服务器运行平台主要存在以下问题：
(1)单点故障的运行风险大。
(2)硬件资源利用率低，不能有效地发挥其优越的性能。且难以在不同服务器平台之间共享资源。造成资源较大浪费。
(3)可扩展性较差。
(4)重建系统复杂且恢复运行时间较长。
(5)磁盘阵列或网络存储在访问性能、数据管理能力、数据传输性能、扩展能力和数据安全性等多个方面存在瓶颈问题。
2、构建PC服务器高效能应用平台的核心技术
2.1虚拟架构技术
虚拟架构技术简单地说就是在1个物理服务器上运行多个虚拟机，这些虚拟机共享底层硬件。从应用的角度来看，每台虚拟机即是1台PC服务器，拥有自己的操作系统、内存、网络、存储器及CPU等“硬件资源”，可以独立完成预先定义的工作任务，且彼此互不干扰。
虚拟架构有两种方式，一种是寄居式架构。是指在物理PC服务器运行平台的操作系统之上安装和运行虚拟机。该架构主要用于开发、测试等环境；第二种是裸设备式架构。是指在硬件平台上直接运行，且所有虚拟机平行运行、统一管理。该架构主要用于提供应用服务器平台。如Web服务等，因此裸设备式架构较寄居式架构更适合建立高性能PC服务器应用平台。裸设备式虚拟架构的结构如图l所示。
采用虚拟架构技术可以提高PC服务器的资源利用率，降低信息化建设成本.同时还提供了灵活的应用平台建设和管理机制.为实现高效能应用平台奠定良好的基础。
2.2虚拟存储技术
虚拟存储技术就是把多个存储介质(如硬盘、RAID)通过一定的手段进行集中管理，所有的存储模块在1个存储池(Storage P001)中统一管理，因而从主机和工作站的角度看到的不是多个存储介质，而是1个超大容量的存储介质。
虚拟存储技术是将虚拟存储控制设备、存储软件管理系统、交换设备以及存储介质等有序集成为统_整体的存储技术。按拓扑结构分主要有两种方式：对称式虚拟存储和非对称式虚拟存储。两者的唯一区别就是非对称式虚拟存储的控制设备独立于传输路径以外。由于非对称式虚拟存储不能有效使用高速存储控制的高速缓存。将会影响到整个虚拟存储的性能，因此不考虑使用非对称式虚拟存储结构来实现PC服务器高可用性平台。
对称式虚拟存储提供了高性能的数据传输和磁盘高速访问，同时具有良好的扩展性和兼容性，因此采用对称式虚拟存储技术是PC服务器实现高可用性应用平台的重要的基础结构。对称式虚拟存储的结构如图2所示。
3、高效能PC服务应用平台架构设计
高效能PC服务器应用平台由多台物理PC服务器(可以根据面向用户数、企业规模、PC服务器性能等综合指标来确定物理PC服务器数量)组成的1个冗余虚拟架构和1组高性能、可靠性好、可扩展性佳的存储体搭建而成。通过虚拟架构技术对物理PC服务器进行虚拟化配置和规划，并通过高速存储控制设备对存储池中的数据进行有序、安全、高速存取控制。
VMware是虚拟服务器技术的典型代表.不仅具有完美的PC服务器虚拟化功能，如使用其自带的P2V Assistant工具可轻松地将物理服务器及应用通过快照技术迅速迁移到虚拟机上.同时还提供了强大的功能模块。以帮助用户建立和管理虚拟机运行环境。因此本次构建高可用性PC服务器应用平台选用VMware虚拟服务器并设计成裸设备虚拟结构，详细结构如图3所示。
4、高效能应用平台的实现方法
本文从VMware虚拟架构层和光纤SAN应用系统层人手，介绍高效能应用平台的具体实现。
4.1 VMware虚拟架构层
4.1.1物理PC服务器群集
在VMware虚拟架构硬件基础上，首先使PC服务器之间实现群集关系，在物理上实现多机冗余以保障PC服务器平台的硬件容错能力。降低单点故障的风险，同时为负载均衡实现高性能应用提供了有力的硬件支持。使用VMware技术可以实现异地容灾，但需要考虑的是必须解决链路通道的带宽问题。
4.1.2虚拟机的群集和负载均衡
将物理PC服务器虚拟成若干虚拟机，并使各物理Pc服务器上的虚拟机之间建立群集，这将提供两方面的好处：其一是使虚拟机在物理上得到冗余：其二是在有任务负载时，VMware可通过分布式资源调度程序(DRS)在物理PC服务器之间均衡负载。
具体实现方法是采用VMw鲫e服务器中的VMotion技术.该技术可迅速地将某一虚拟机切换到另一虚拟环境上继续运行.即解决冗余又可实现负载均衡。理论上，VMotion技术可实现零中断迁移.因此该功能在集群环境下的PC服务器对计划内PC服务器的维护和非计划性故障处理中均具有重要的意义。
4.1.3统一管理的实现
在VirtualCenter虚拟中心可以方便地管理VMware服务器及其所有虚拟机的运行.并且提供强大的访问控制。以确保虚拟环境中各独立应用及数据的绝对安全.从而极大提高了管理员的工作效率和PC服务器应用平台的可用性。
4.1.4双冗余光纤接口
使用双冗余光纤接口，不仅解决数据传输的瓶颈。而且可使虚拟PC服务器实现高性能的容错。提高可用性。
4.2光纤SAN应用系统层
光纤SAN应用系统是高可用性PC服务器应用平台设计的关键内容之一.其性能的优劣直接关系到高可用性PC服务器应用平台的性能指标，因此光纤SAN应用系统结构的设计与实现非常重要。
4.2.1 SAN光纤交换机层
使用SAN光纤交换机冗余结构。一方面解决数据传输的瓶颈。另一方面保证光纤链路有较高的连通性，并提供较好的容错能力，降低单点故障的风险。同时SAN光纤交换机为高可用性PC服务器应用平台和其它高级应用(如虚拟磁带库、异地备份等)提供了强大的扩展能力。
4.2.2高速存储控制设备层
高速存储控制设备是虚拟存储管理的核心设备.其作用体现在以下方面：
(1)使用双冗余结构降低高速存储控制设备的单点故障风险。提高并行数据处理能力以解决数据传输瓶颈。
(2)通过高速存储控制设备内嵌的管理软件，对存储池中的物理介质进行有效管理。根据虚拟机实际需要，规划或调整逻辑存储单元(简称LUN)，并将LUN映射到虚拟机。即当虚拟主机向磁盘写数据时。实际上是将数据写入高速存储控制设备指定的LUN中。
(3)高速存储控制管理软件具有强大的安全控制能力.确保划分的LUN不被未授权的虚拟机使用，同时也提高了系统的安全性和可靠性。
4.2.3高速缓存层
数据存入高速存储控制设备时。先写入高速缓存。再由高速缓存将数据写入到指定LUN对应的物理存储介质上。显然高速缓存能够显著提高虚拟存储的数据处理能力。为确保整个应用平台的效能和经济性。在划分高速缓存层时应综合考虑应用系统性质、数据交换频率、通信数据容量以及分配的内存空间等因素。
4.2.4存储池层
存储池层将存储介质有机地组织在一起，从而实现海量存储体。存储池使用RAID技术后不仅具有较好的I/O吞吐性能.且具有一定的容错能力(RAID0除外)。目前很多PC服务器采用性价比高、安全性好的RAID5技术.将多个存储介质组合在一起。RAID5技术支持当有1块磁盘数据损坏后可利用剩下的数据和相应的奇偶校验信息快速恢复损坏存储介质的数据。从而达到冗余保护目的。现在的RAID7(全称为Optimized　Asynchrony for High I/0 Rates as well as High Data　Transfer Rates。最优化的异步高I/O速率和高数据传输率)自带微操作系统和管理工具.大大改善了I/O性能。和其他RAID技术相比.RAID7表现出优越的数据存储能力，但价格也非常昂贵，企业可根据需要定制适合自身的RAID技术.但要注意选购的高速存储控制设备是否支持设计采用的RAID技术。
4.2.5 Hotspare池
Hotspare池给存储池提供了热备用的存储介质，当存储池中有存储介质故障时。Hotspare池就会为其分配1块存储介质，该存储介质会在通过存储管理系统重建数据后立即投入应用且不中断应用业务。显然存储介质Hotspare池为存储池增加了一道坚强的容错保障，极大提高了存储池介质的安全性。
4.2.6保护装置
保护装置主要实现冗余电池供电保护。一方面是在突然断电情况下保证缓存区中的数据能够回写到存储介质中而不发生数据丢失：另一方面，可防止存储介质在失电后因磁头划伤盘片而导致数据丢失。该功能模块进一步保障了PC服务器应用平台的高可靠性。
4.2.7存储池扩展口
存储池扩展为提供更大容量的存储池提供扩展接口.用户可根据需要追加存储介质以适应信息化发展和规划的需求.当然关键是其扩展规模应满足高速存储控制设备相关的技术参数要求。虚拟存储不仅可用于确保虚拟机LUN的配置和扩展应用，还可用来实现虚拟磁带库。
要保障虚拟存储中的数据，除采用上述技术外，还需要磁带备份和异地存储技术备份。以进一步确保虚拟存储数据的安全性。该系统架构提供了接口，既可以通过SAN网络完成数据备份。也支持iSCSI存储技术实现网络异地备份。
5、结语
基于PC服务器、利用VMware虚拟架构和SAN虚拟化存储技术构建的高效能应用平台，较好地解决了PC服务器的可靠性和安全性问题.提高PC服务器的处理能力和性能.极大降低了企业信息化建设和运行维护成本.近两年来已在国内外各类企业中迅速普及与应用。随着PC服务器性能的不断提升，虚拟化技术日臻成熟。必将掀起新一轮信息技术革命的高潮。