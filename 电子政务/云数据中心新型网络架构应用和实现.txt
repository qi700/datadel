云数据中心新型网络架构应用和实现
本文简要介绍了云数据中心系统层次架构，分析了传统数据中心网络结构，根据云数据中心网络的应用需求，提出了云数据中心的新型网络架构模型。前言    随着信息化的进一步发展，社会对于信息网络的依赖性日益增强。国内互联网用户及应用继续保持着高速发展，据统计2011年底我国互联网网民数量达到5.13亿，手机上网用户达3.56亿。预计2013年全球互联网数据中心的年市场空间将达到476亿美元，其中中国占总市场份额接近8%，并以40%的年均增长率高速增长。根据互联网数据中心的预测，未来4年全球云计算服务市场的平均年增长率可达到26%。而在国内，根据诺达咨询预测中国数据中心市场复合增长率达30%以上；根据计世资讯预测，数据中心第三方服务市场规模2015年将达到394.3亿元。电信业务也将实现“云化”发展。随着移动互联网应用、三网融合、电子商务和行业信息化的不断应用，中国网民和手机用户数不断攀升。而作为信息化应用和互联网内容承载的数据中心，将发挥越来越重要的作用。    就数据中心自身而言，第一代数据中心以托管、租用等硬件服务为主，提供机房场地、服务器、宽带网络等基础资源业务，属于传统的数据中心运营范畴；第二代数据中心向增值服务转型，在基础资源之上提供各类安全、数据管理等外围的增值服务，目前大多数数据中心运营商均处于该阶段；第三代数据中心即云计算数据中心，提供整合式按需服务，以客户为中心、以服务为导向，聚合内容资源的价值链运营，在高性能基础架构上提供各类随需要应变的整合服务。而对应的数据中心业务也从传统的内容资源业务、自有及合作业务向行业用户应用类业务和产业拓展类业务发展。    数据中心的发展正经历着从卖资源向卖服务转变，随之而来的数据中心的架构也必然进行转变，即从传统的网络型数据中心向云服务+网络型的云数据中心转变。而在云数据中心模式中，数据中心中的应用、数据和IT资源以服务的方式通过网络提供给用户，大量的计算资源可以组成IT资源池，用于动态创建高度虚拟化的资源，提供给用户最优化的服务。    总之，数据中心业务的核心价值是帮助内容经营者，把客户需要的内容高质量地分发到客户那里，而不是机房本身。真正竞争核心是网络和服务的组合体。1 云数据中心系统层次架构    云计算应用（服务）总体上可以分为软件即服务（SaaS）、平台即服务（PaaS）、基础设施即服务（IaaS）3个层次，并延伸出云计算的多种服务模式（见图1）。另外配合管理功能，确保整个云数据中心能够安全、稳定地运行，并且能够被有效管理。  图1 云数据中心系统层次架构    a）云应用软件服务层。SaaS提供给用户的是在云计算基础设施上的应用程序。应用软件服务是日常用户最熟悉、最直接面对的层面。在云计算中该应用程序服务层驻留着适合的应用程序，整合自有业务和SP/CP客户的互联网应用，为用户提供随时、随地、随需的一致性服务。例如为个人、家庭提供及时通信、在线娱乐、邮件等服务功能；为政企提供整体信息化解决方案。实现OA、CRM、企业门户、邮箱、企业短信等丰富的应用功能等。    b）云平台服务层。PaaS提供的是将开发工具部署到云计算的基础设施中，对各种基础业务能力进行封装，结合开发、测试与部署工具，实现应用开发的一站式服务，为开发者之类的客户提供开发平台、开发工具、测试环境，以及通信、手机支付、身份认证等手段。    c）基础结构服务层。IaaS资源池独立部署，为各业务系统提供统一资源池部署环境。IaaS主要包括数据中心中的网络设备、服务器、存储磁盘等。向用户提供虚拟资源出租，包括虚拟主机、虚拟存储等服务。    根据当前数据中心管理模式及运营模式，需要构建合适的基于云计算的云数据中心架构（见图2）。该架构包括4层结构；底层为数据中心机房；第二层为云平台，包括云管理平台、虚拟化以及计算、网络、存储等设备；第三层为数据中心应用平台，包括虚拟桌面平台、统一门户、API管理平台等；最上层是数据中心业务层，包括基础业务、云业务、增值业务。  图2 基于云计算的云数据中心架构    云计算的架构模式通过采用硬件设备虚拟化、软件版本标准化、系统管理自动化和服务流程一体化等手段，将数据中心的服务器、存储、网络等资源形成一个巨大的资源池，管理者通过云计算管理平台可动态监控、调度和部署其中各种资源，并通过网络提供给用户，提高了数据中心资源的使用率和响应时间，降低了管理的复杂度，提升了运营维护的效率。同时改进了数据中心的扩展灵活性，当数据中心用户需要扩大资源时，新的资源随时能够加入到原有的云计算资源中，而不必重新部署。最终实现把传统的数据中心建设成为一个以服务为中心的新一代云数据中心运营平台。    云计算系统通过大规模、低成本运算单元与IP网络连接，能够实现数据中心向不同的用户提供差异化的服务，提供大规模、平滑扩展、资源共享、动态分配、跨地域等业务，以即插即用的方式，方便、快速地增加和减少资源。从而能够实现数据中心的低成本、高性能、通用性、灵活性。2 传统数据中心网络结构分析    传统数据中心的网络结构按照设备作用的不同，分为核心、汇聚和接入层。中小型数据中心一般将核心和汇聚层合二为一，大型数据中心通常单独设置运维管理层。    核心层也称为互联网接入层，主要承担流量的转发，一般采用路由器配置BGP协议与骨干网/城域网互联。    汇聚层作为数据中心内部交换核心提供增值业务，一般采用IGP协议与核心层互联。增值业务设备包括防火墙、负载均衡交换机、VPN终结器等。    接入层一般采用二/三层交换机，可采用二层或三层协议与汇聚层互联。接入层交换机通过连接客户服务器的网卡下挂运营商或客户的管理服务器。    另外按照传送数据业务性质和面向用户的不同，网络系统可以划分为内部核心网、远程业务专网、公众服务网等区域。从网络服务的数据应用业务的独立性、各业务的互访关系及业务的安全隔离需求综合考虑，网络系统在逻辑上可以划分为存储区、应用业务区、前置区、系统管理区、托管区、外联网络接入区、内部网络接入区等区域。    随着业务承载要求越来越高，云计算业务模式的引入，原三层架构的数据中心存在以下一些难以解决的问题。    a）网络层次多。核心＋汇聚＋接入的三层网络结构模式导致数据流量的处理环节相对较多，延迟增大，服务器间实时交互数据和分布式流量传输的高可靠性得不到保障。    b）二层网络不稳定。二层网络采用STP协议，网络不稳定、收敛速度慢且链路利用率低。    c）管理维护复杂。传统构架网络设备数量多，进行业务扩容、迁移或增加新的服务功能越来越困难，每一次变更都将牵涉相互关联的、不同时期按不同需求建设的多种物理设施，涉及多个不同领域、不同服务方向，工作繁琐、维护困难，而且容易出现漏洞和差错。    d）建设和运营成本高。传统的数据中心弹性差，往往是一机一应用，不能实现资源的充分利用。设备平均利用率只有25%，导致建设成本高，能效比差，PUE通常高于2，电力成本巨大。另外，一次建成后改造困难，不能提供模块化的扩容能力，难以满足业务的快速发展需求。3 云数据中心新型业务需求    据行业经验，云计算需要满足以下新的业务要求。    a）云计算数据业务需求类型存在不确定因素。    b）在业务初期和开展过程中存在不断更新的临时性需求。    c）新型云计算业务快速增长，通常具有快速上线的需求。    d）作为云计算业务主要客户的中小企业对于成本控制需求比较重视。    e）运营要求较高，需要定期地进行内部虚拟结算。    另外，结合现网业务的开展，互联网企业（特别是视频、游戏类）和IT软件企业已经成为云数据中心的最主要客户。    云数据中心除了满足现有传统数据中心的业务（例如普通客户站点间的流量互访如CDN、P2P、FTP、内容备份和同步等，重要客户站点间的内容备份、远程容灾，或需要安全控制或质量保证的流量），还要向新的业务进行发展，例如服务器异地集群、虚拟机在线迁移、客户异地整合和迁移等，如表1所示。    综上所述，云数据中心业务的发展对传统数据中心的网络架构提出了新的要求。    a）网络可用性。构建弹性架构，提供高可用性、容错性和冗余性。    b）系统安全性。实现不同云数据中心跨分区的数据安全隔离，增加安全和访问控制，保证数据中心和灾备中心的数据安全。    c）服务可靠性。提供跨主机层、网络层和存储层的一致性，实现高QoS的品质。    d）可管理性。简化日常运维，实现对全网云计算资源的统一配置、管理、调度、监控和对业务进行统一运营管理。  表1 云数据中心对网络的承载新需求4 云数据中心新型网络架构    传统数据中心网络通常依靠不断添加设备来提升网络性能，增加了数据中心的成本和复杂性。数据中心由业务驱动而线性地增加设备会造成系统越来越庞大，运维管理越来越复杂，资源难以实现整合和调配，导致资源利用率和系统应变能力迅速降低。    采用云计算技术后，云数据中心内部设备架构相对于传统数据中心发生了一些变化。    a）服务器的虚拟化实现。云数据中心虚拟化的实现对服务器硬件的使用能力有了极大的提高。据统计采用服务器虚拟化后，服务器的CPU/内存利用率从通常的30％提升到70％～80％。云数据中心网络中的流量相比传统数据中心接入的1个端口的带宽流量也急剧扩大（例如原本1台服务器1个操作系统中的1个应用只需要10M流量带宽，现在10个虚拟机运行10个虚拟化系统的应用，带宽需求可能需要达到100M）。这就要求不同的虚拟化机在二层范围内进行扩展和迁移，而虚拟机的HA特性和集群服务器的采用也要求实现比较简单的二层网络的连接，从而更好地实现应用服务器和数据库的扩展。    b）虚拟交换机的运用。云数据中心在采用虚拟交换机后，传统的物理接入交换机会变成汇聚层，而接入层的功能交给虚拟交换机实现。所有的二层策略与安全策略都在虚拟交换机的端口上部署，虚拟交换机和物理交换机之间通过Trunk进行连接。因此在实践中，建议每个PC服务器通过配置4块GE卡来做2个虚拟交换机，1个虚拟交换机运行相关的云计算管理等操作，还有1个虚拟交换机运行应用生产系统。每个虚拟交换机通过2块网卡和物理交换机Trunk连接，实现冗余链路和负载分担，如图3所示。    综上所述，在外部网络层面，结合云数据中心网络应用需求的分析，在数据中心采用云计算模式之后，传统的网络结构造成网络延时问题成为一大瓶颈，这就使得低延迟的服务器间通信和更高的双向带宽需要变得更加迫切。在大规模采用服务器和存储虚拟化的新一代云数据中心中，数据流量将主要集中在本地服务器和存储设备之间。这就需要网络架构向扁平化、高性能、大容量、高可靠性、横向流量增加、大二层网络的方向发展。最终的目标是在任意2点之间尽量减少网络架构的数目。通过路由器和万兆级别交换机设备实现扁平化网络和简化现有数据中心网络，一方面可以实现用户和带宽的快速增长，另一方面也可以快速开展业务，减少资源投入。  图3 云数据中心内部设备架构示意图    因此在网络层次上，云数据中心的网络结构根据性能测试结构和实际业务需求实现架构上的优化。网络结构会变得比传统数据中心网络更加简单，越来越扁平化，由三层变为两层，如图4所示。    a）三层互联。在网络层次上去掉核心层，由汇聚层交换机直连骨干网/城域网。数据中心面向广域网的出口，不同云数据中心（主中心、灾备中心）的前端网络通过IP网络实现互联，客户端通过前端网络访问各数据中心。当主数据中心发生灾难时，前端网络将实现快速收敛，客户端通过访问灾备中心以保障业务连续性。数据中心运营商整合区域范围内各数据中心节点，消除差异化，有利于价格管控和网络管理。在业务部署上，在出口处统一部署流量监控、防DDoS攻击、安全防护等业务。通过统一考虑带宽扩容数量和业务部署，降低整体投资。  图4 云数据中心新型网络架构    b）二层互联。二层互联也称为数据中心服务器网络互联，在不同的数据中心服务器网络接入层构建一个跨云数据中心的大二层网络，以满足服务器集群或虚拟机动态迁移等场景对二层网络接入的需求。在技术实现上，比较常用的包括裸光纤、IP over DWDM和VPLS等。不同的数据中心间可方便实现跨数据中心的业务，既充分实现客户的容灾、备份、云计算等业务，又降低了对骨干网的流量需求。    另外，随着服务器虚拟化技术的日渐普及，要求网络架构必须能够灵活地实现虚拟机迁移、数据同步、灾备，构建大二层网络。在实践中比较有代表性的是以下2种技术。    （1）横向虚拟化技术。云数据中心内部服务器集群流量较多，多用户之间的突发访问流量需要集群计算或并行计算。因此横向虚拟化技术将同一层次的多台设备虚拟成1台，虚拟化的设备逻辑上是1台，作为1个网元设备进行管理配置，保证突发流量不丢包，物理/虚拟服务器在1个大二层域下，即插即用，并可支持大容量MAC地址，消除二层网络环路问题，避免部署复杂的STP，提高链路利用率；实现跨机箱的负载均衡，有利于交换平台扩展。管理界面采用单台设备管理方式，减轻管理维护工作量，提高二层链路利用率。    （2）纵向虚拟化技术。将不同层次的多台设备虚拟成1台，将下游交换机虚拟成上游交换机的端口，有利于交换平台的扩展。数据中心网络核心区域内配置矩阵强大的交换机设备，各个分区内通过接入板卡较大化地扩展端口，对于设备交换容量、端口密度不断增大的数据中心可以选择支持集群技术的设备，减少逻辑节点。纵向虚拟化结合传输技术的运用实现跨数据中心的互联，实现网络最大化的简化配置，数据中心内任意2点直接1跳即达。   c）SAN互联。SAN互联也称为后端存储网络互联，借助传输技术（DWDM、SDH等）实现主中心和灾备中心间磁盘阵列的数据复制。特别适合云数据中心的灾备建设需求。    d）网络优化分析。通过比较分析，可以看到云数据中心的新型网络架构更加适合云数据业务的开展。云数据中心的以太网络逐步扩大，更多地考虑局域网甚至广域网的二层互联，实现网络容灾。转发效率越来越高，对网络核心交换机的性能至少是100G平台。    e）多中心的应用。通过以上三层、二层网络和SAN互联，今后云数据中心也将实现多中心的运用。    通过整合各数据中心节点，实现主中心和灾备中心。减少故障点、转发瓶颈和迟延，消除差异化，有利于价格管控和网络管理，各数据中心间可方便实现跨数据中心的业务，既满足客户的容灾、备份、云计算等业务需求，又降低了对骨干网的流量需求。    另外，在业务部署上，便于在出口处统一部署流量监控、防DDoS攻击、安全防护等业务；而通过统一考虑带宽扩容数量和业务部署，则能够有效地降低数据中心的整体投资，实现成本控制。最终实现云数据中心分布式运行环境、多种类型的数据存储和动态资源伸缩的应用运行环境目标。5 结束语    互联网和3G/4G的发展对新一代数据中心提出了新的要求和挑战，庞大的用户数对数据中心的存储量和访问量都提出了巨大的需求，需要数据中心提供商拿出更大、更优的存储和服务器资源以满足用户需求。云数据中心使得不同设备、不同软件以及不同网络实现兼容，让用户无论拥有何种终端都能访问到“云端”的资源。云计算的商业模式给用户提供的是一种IT服务，其内容也是随时间变化的。因此，云数据中心的架构也会随着需求的进步不断调整和优化。    通过云数据中心的网络架构优化可以提升数据中心网络的运行效率，降低维护管理的复杂度，提高数据中心资源的调度效率和利用率；结合云计算自身优势，快速实现自动化的资源部署和软件安装，及时调配相应的资源支持业务的发展，并且可以安全、可靠地实现云数据中心的容灾备份，保证业务的及时上线，快速响应市场需求。