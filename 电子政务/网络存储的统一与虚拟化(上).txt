网络存储的统一与虚拟化(上)
存储资源共享是网络存储的最基本的任务，为了给用户提供有效的存储资源共享，网络存储的统一化和虚拟化采取了不同的方法：统一化的侧重点在于存储技术、存储资源的整合和存储管理的研究，虚拟化侧重于如何为用户提供更方便的应用环境。统一虚拟存储体系结构则结合了两者的优点，代表着网络存储的将来。本文对网络存储的统一化和虚拟化的现状和存在问题进行了探讨，分析了阻碍统一虚拟存储体系结构实现的不利因素，针对这些存在的问题，本文给出了一个基于自主式存储中介的网络存储系统，该系统结合了网络存储的统一化和存储虚拟化技术，可以看作统一的虚拟存储网络的一个实现。    据有关机构预测，至少在5 年内，存储市场都会以10%~20%的年增长率递增，其中网络存储部更将以每年增长62%的速度高速发展。对网络存储产品的旺盛需求，极大地推进了网络存储技术的发展，网络存储的统一化和虚拟化是其中的两个热点。    目前，存储网络的统一主要是指NAS 和SAN 的融合。NAS 和SAN 是网络存储的两种不同的体系结构。在实际应用中，它们各有特点，也有各自的局限性。NAS 和SAN 的融合，可以较好地解决NAS 和SAN 之间的存储共享问题，有效地利用各自的特点，提高可扩展性、灵活性以及效率。    存储虚拟化是指将具体的存储设备或存储系统同服务器操作系统分隔开来，为存储用户提供统一的虚拟存储池。存储虚拟化是具体存储设备或存储系统的抽象，展示给用户一个逻辑视图，同时将应用程序和用户所需要的数据存储操作和具体的存储控制分离。存储虚拟化能够极大地方便用户对存储资源的使用，减小存储系统管理开销，优化存储系统性能，提高存储资源利用效率。当前，基于网络的存储虚拟化的主流是SAN 的虚拟化。    随着网络和计算机技术的发展，新的网络存储技术和标准，不断发展地出现，怎样有效地整合不同存储网络将是极具挑战性的工作。存储网格和基于对象的存储在这方面做了有益的探索，为统一虚拟存储结构的发展做了启发和技术准备。本文探讨了网络存储的统一和虚拟化技术的现状和存在的问题，指出了统一化和虚拟化共同的终极发展目标是统一虚拟存储网络，通过统一虚拟存储体系结构将所有的存储资源统一起来，提供统一的资源共享服务。1 NAS 和SAN 的融合    1.1 NAS 和SAN 的特点    SAN（Storage Area Network：存储区域网）是一种利用Fibre Channel等互联协议连接起来的可以在服务器和存储系统之间直接传送数据的存储网络系统，存储设备和应用服务器之间采用的是block I / O 的方式进行数据交换。SAN 具有高性能、高可用性、较高的灵活性、扩展方便、易于集中管理和可靠性高等优点，也存在设备造价高、需要专业维护人员、设备的互操作性较差等缺陷。    NAS（Network Attached Storage：附网存储）是可以直接联到网络上向用户提供文件级服务的存储设备，具有可即插即用、总拥有成本（TCO）低的优点，但亦存在I /O 速度不高、数据备份需要占用网络带宽等缺点。    显然，NAS 和SAN 是两种截然不同的技术，尤其是两者构建技术不同，对企业来说，需要同时构建和管理两种不同的存储结构，增加了实现和管理成本，同时也不能很好地做到存储资源的整合。另一方面，NAS 和SAN 又是相互补充的，两种结构可以因满足不同的需求而同时存在。    1.2 NAS 和SAN的融合方案    鉴于NAS 和SAN 的各自优点和缺点，要求NAS 和SAN进行融合的呼声很高，也出现了一些相关产品，对已经产生的众多产品的方案进行分析，我们发现这些方案基本上可以分为两类：基于NAS 和基于SAN 的融合方案。    1.2.1 基于NAS 的融合方案    该方案是将操作系统（文件系统）和存储子系统相互独立，其文件系统功能部分单独构成一个NAS head，用以保存元数据，同时完成文件系统的功能；其存储子系统采用外置式的SAN 结构。    该方案采用的是以NAS 的方式和网络相连，因此可以实现异构的文件访问和共享；客户则是通过IP 网络访问，可以充分利用现有的网络环境；存储子系统部分采用SAN 结构，具有SAN 高可扩展性、高可用性，以及存储资源的集中和统一管理等优点。    该方案的问题在于NAS head：控制信息和数据信息都必须通过NAS head，使得NAS head 成为一个潜在的性能瓶颈并容易导致系统单点失效，为此需要采取冗余等措施加以解决。    1. 2. 2 基于SAN 的融合方案    该方案的一个特点就是把文件系统功能部分从应用服务器中剥离出来，集中到元数据服务器上，从而实现了命令通道与数据通道的分离，或者说是元数据与数据的分离存储；而应用服务器上都安装有一个专用的过滤程序，来处理元数据。    在应用服务器看来，访问方式采用的是文件I /O方式，整个存储系统相当于一个NAS 文件服务器，因此具有NAS 的优点；文件系统和存储子系统之间采用SAN 的结构，因而该方案也具有SAN 的优点。    整个系统只有一个元数据服务器，不过它只是处理元数据及控制信息，因此元数据服务器并不会是性能瓶颈。    1. 2. 3 统一存储网    统一存储网（USN：Unified StorageNetwork）则是由学术界提出的一个NAS 和SAN 融合方案，该方案综合了上述两方案的优缺点。    USN 采用TCP/ IP 作为存储网络的构建技术，通过IP 互联设备将应用服务器、存储设备等互连成一个基于IP 的SAN，从体系结构的角度来说，具备了传统SAN 高性能、易扩展等特点；同时，通过高速附网通道将存储子系统直接联入LAN，从而形成了一个广义的NAS。    和上述NAS / SAN 融合方案相比，USN 具有如下特点：    1、支持块设备和文件设备的同时接入，并进行统一管理，形成为单一的命名空间。    2、存储网络中，文件设备的引入，USN 可以同时提供块I /O服务和文件I / O 服务。    3、引入附网直连通道（NAC），不需要由应用服务器进一步处理的数据可经NAC 直接返回，避免了应用服务器的存储转发，实现客户与存储设备之间的数据传送。
图1 基于TCP/ IP 的统一存储网络系统（USN）    NAS 和SAN 的融合方案很多，但是都不能同时完全发挥二者的优点，影响的因素很多，其中缺乏NAS 和SAN 进行综合管理的软件管理策略是一个重要原因，NAS 和SAN 的融合，毕竟不是简单地将它们进行连接或重构。另一方面，新的存储技术和体系结构的不断出现：IP 存储、Infiniband、DAFS等，不但影响NAS 和SAN 本身的发展，也将会促生新的融合方案。另外，Ethernet 的发展经历了10mbps 到100mbps 再到1000mbps 的过程，现在，10gbps 的Ethernet 也即将问世，Ethernet的发展对NAS 和SAN 的融合也必将带来很大的影响。2 基于存储网络的虚拟化    存储虚拟化就是在存储系统中增加一个虚拟化层，通过虚拟化层，把存储系统中各种分散的、异构的存储设备映射成一个虚拟存储池。虚拟化层屏蔽了所有存储设备的物理特性，存储系统中所有存储设备对用户透明，用户则通过虚拟化层提供的接口，对虚拟存储池进行I / O访问。    基于存储网络的虚拟化的目标是，把分散在网络中的存储设备统一起来，使用户感觉和操作起来，像一个普通的存储设备，用户并不需要知道设备的供应商，也不需要知道设备的具体位置。    网络级的存储虚拟化主流是基于SAN 的虚拟化。基于SAN 的存储虚拟化，大多采用一个专用的元数据服务器，作为虚拟化层，这台专用的服务器称为元数据服务器或者元数据控制器。根据该服务器是否在数据传送的路径上，基于SAN的存储虚拟化的实现方式分为对称结构（Symmetric）和非对称结构（Asymmetric）两种实现模型。    2.1 对称方式的SAN存储虚拟化结构    对称结构也称为带内（in-band）模型，实现途径是在数据通路中插入虚拟存储层-元数据服务器，并由虚拟化管理软件对存储设备和服务器主机进行配置和管理，存储数据和控制信息使用同一条通路。    这种结构实现简单，而且将虚拟化层完全实现在专用虚拟平台上-元数据服务器，对应用服务器和存储设备的影响达到最小，因此对异构环境具有很强的适应性。    对称结构的不足主要在于，数据传输和元数据访问都必须经过元数据服务器，元数据服务器很可能成为系统瓶颈，制约SAN 的整体性能，并影响SAN 的可扩展性。此外，这种结构的虚拟存储系统容易出现服务器到存储设备的单点故障，因此对称虚拟存储结构在实际使用中往往要做冗余配置。  图2 对称方式的SAN 存储虚拟化结构