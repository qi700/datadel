计算机辅助工艺设计(CAPP)系统数据备份模式的研究
航天器工艺数据是航天器总装过程中的重要数据，计算机辅助工艺设计(CAPP)系统是用于工艺数据编写的信息化系统。为了对航天器工艺数据进行可靠的备份，文章研究了适用于CAPP系统的数据备份模式。根据航天器工艺数据特点、CAPP的系统特点和应用情况，使用改进的父子循环策略对航天器工艺数据进行周期性的完全备份，制定了介质覆盖保护周期的计算公式，备份系统的架构采用LAN-Based方式，同时设定了合理的备份时间调度。依照此方案实施的备份作业取得了良好的运行效果。0 引言    用来编制航天器工艺文件的计算机辅助工艺设计(CAPP)等工艺编制系统对于航天器的生产制造具有重要的作用，需要针对其特点采取合理的备份模式进行数据备份，保证数据安全。    北京卫星环境工程研究所拥有国内最大、功能最完善、技术最先进的AIT中心，建立了比较完善的生产管理系统，包括CAPP、MES和AVIDM。其中，CAPP用于航天器总装工艺设计，已经在几十个在研型号上成功开展，促进了工艺文件编制的规范性，提高了编制效率。同时，在CAPP中编制的工艺文件作为MES和AVIDM的输入数据，其数据的完整性和可靠性是确保MES和AVIDM正常运行，保证航天器的总装与试验稳定进行的前提条件。因此，必须对CAPP系统数据进行完整的数据备份，以避免因数据缺失或损坏对生产造成不利影响。    本文针对航天器工艺数据的特点，以CAPP系统为备份对象，结合其程序架构以及实际运用中的特点和规律，为CAPP系统设计合理的备份模式，确保其数据的安全，并为相同类型工艺编制系统备份模式的制定提供了理论和实践的参考。1 CAPP系统备份需求分析    1.1 航天器工艺数据特点    航天器工艺数据用于指导航天器的总装操作，相对于其他类型的系统数据，具有可靠性要求高、数据间歇性更新、数据总量变化相对较小等特点。    1)航天器工艺数据记录航天器总装操作的步骤、零件规格、注意事项等，任何数据的错误或者丢失都可能给整个型号任务的完成带来极为不利的影响，因此，航天器工艺数据在可靠性方面具有极高的要求，必须对其实施可靠的备份。    2)CAPP等工艺编制系统是航天器装配的重要工具，工艺人员在工作时间的使用频率较高，使用人数较多，因此，工作时间数据更新的操作频率相对较高，也相应提高了服务器的访问频率；且此类系统通常采用独立的服务器，若在工作时间段内进行异地备份会占用有限的网络带宽与硬件资源，难以同时满足备份和正常应用的需要，易对用户的正常使用造成不利影响。    3)以CAPP系统为例，图1为CAPP数据日增长量的抽样结果，与高数据量并发的商用信息化系统不同，CAPP系统以文本数据为主，不存储视频、音频等多媒体大容量数据，整体数据量处在较小的量级，且变化比较平缓，增长速度有限；同时新增工艺数据较少，有大量删除操作时还可能出现负增长，整体数据量将长期保持在较小的量级。因此，对数据的整体备份不会占用过多的时间和硬盘空间。     图1 CAPP数据日增量    1.2 CAPP系统的备份要求    CAPP属于面向生产的信息化系统，使用频率高，数据丢失带来的风险大，对数据的可靠性要求较高，通常要保持较高的数据备份频率。同时，为了能够有选择地恢复某个时间点的数据，需要保留一定时段的历史数据。    CAPP系统用来进行工艺文件的编制，在与MES和AVIDM系统集成后增加了文件签署和将文件导入MES的功能，其工艺文件数据对航天器的生产制造具有重要意义。    此外，CAPP系统采用C/S架构，由客户端、签署服务器、数据库服务器3部分组成，客户端以及签署服务器不存储任何与业务相关的数据，它们发生故障不会导致数据丢失；所有工艺文件数据均存储在数据库服务器中，其故障可能会产生数据丢失或出错等严重后果，需要对其中数据进行完整可靠的备份。2 CAPP系统的数据备份策略    2.1 备份方法    在CAPP系统的备份设计中，需要选择合理的备份方法，以充分利用存储空间，简化备份过程，缩短备份和恢复数据的操作时间。常见的备份方法包括完全备份、增量备份和差异备份等。    完全备份方法只需要最后一次备份的介质，就可以恢复丢失的数据，备份与恢复的过程相对简单，但需要占用较大的磁盘空间和较长的备份时间，适用于整体数据量不大的情况。增量备份只备份前一次备份后发生改变和新增的数据，节省了备份数据所占用的磁盘空间，且备份作业所需时间要短于完全备份，但恢复过程较为复杂，且局部数据的损坏可能导致整个恢复作业的失败。差异备份介于完全备份与增量备份之间，占用的存储空间比完全备份少，比增量备份多；数据恢复的快捷性与安全性不如完全备份高，而又优于增量备份。3种备份方法及其数据恢复的原理如图2所示。     图2 3种备份方法原理    综上所述，虽然增量备份与差异备份更加节省磁盘空间与备份时间，但是在备份数据量有限，完全备份产生的开销能够被接受的情况下，应优先选择可靠性与简易性较高的完全备份作为备份方法。    由于业务特点的限制，单份工艺文件的数据量对于存储空间的占用比较有限，且新工艺文件的创建频率较低，因此，CAPP系统数据库的数据量将长期稳定在较小量级，且试验证明其完全备份时间也不超过1h，处于可接受范围内。同时，在采用适当的介质循环策略后，完全备份所占用的磁盘空间也在当前磁盘容量的可接受范围内。因此，针对北京卫星环境工程研究所的现有条件，确定对CAPP系统采取完全备份方式进行备份。    2.2 介质循环策略    在信息化系统的备份作业中，数据通常被存储到磁带等介质上，若不采用介质循环策略，每次备份都使用一块新的存储介质区域，将造成存储介质的无限增长。而采取合理的介质循环策略，可以在使用量保证数据可靠性的前提下高效地利用存储介质，避免存储空间的浪费。介质循环策略是指通过重复使用介质的方式备份数据，不同的介质循环策略所需的介质数目，以及介质再次被使用之前保存数据的时间段不同。传统的介质循环策略包括子循环策略、父子循环策略及祖父循环策略等。    子循环策略是指在一个介质上重复进行完全备份，如设定备份周期为1d，则使用一个介质每天进行一次完全备份，每次备份覆盖上一次的备份。    父子循环策略使用完全备份与差异备份或增量备份的组合。其备份介质分为A、B两组，B组介质定期循环进行完全备份，A组介质在B组介质两次完全备份的间隔期间进行差异备份或增量备份。    祖父循环策略也使用完全备份与差异备份或增量备份的组合。其备份介质分为A、B、C共3组，C组以To为备份周期进行完全备份，B组介质在C组介质两次完全备份的间隔期间以T1（T1＜T0）为备份周期进行完全备份，A组介质则在B组介质两次完全备份的间隔期间进行差异备份或增量备份。    以上3种介质循环策略各有优缺点，子循环策略规则简单，管理方便，但只能恢复到上一次备份的状态。父子循环策略保存数据的时间比子循环策略的长。祖父循环策略通过增加有限的介质获得比父子循环策略更长的备份数据回溯时间。    在实际业务中，CAPP系统发生故障时要选择性地恢复之前某一时刻的数据，因此子循环策略反复覆盖上一次备份数据的方式不适用于CAPP系统的数据备份。而父子循环策略和祖父循环策略所使用的完全备份与差异备份（或增量备份）相结合的方法，虽然在很大程度上节省了备份所使用的介质空间，但是其数据恢复上的复杂性不利于信息化管理工作的实施，且存在因局部数据备份的失败或错误导致整个数据无法恢复的可能性。因此，以上3种传统的介质循环策略均不适用于CAPP系统的备份。    CAPP系统使用针对其应用特点改进的父子循环策略进行备份。传统的父子循环策略在两次完全备份之间进行若干次增量备份或差异备份，一旦用于某次增量备份的介质发生损坏，将导致之后的所有增量备份数据均无法恢复。因此需要对传统的父子循环策略进行改进，用完全备份代替增量备份或差异备份，在一个周期内每次都用新的介质进行完全备份；在下一个周期中对上一个周期使用的介质进行覆盖。改进后的父子循环策略既避免了传统父子循环策略在管理和安全上的问题，又保留了其保存数据时间较长、介质利用率高的优点。改进后的父子循环策略将磁盘空间划分为小块模拟存储介质，如图3所示，设介质的循环周期为5d，则循环1的Sd时间内，每天分别使用不同的存储介质进行完全备份；在循环2中，每天备份时依次覆盖循环1中对应的存储介质，进行完全备份；以此类推，在循环3中覆盖循环2中使用的存储介质区块。     图3 改进的父子循环策略 2.3 覆盖保护周期    覆盖保护周期是指介质不可被覆盖的时间长度。覆盖保护周期从上次写入介质的时间（即上次附加或覆盖作业结束的时间）开始计算。覆盖保护周期结束之后，介质变为可回收介质，可以进行覆盖。覆盖保护周期每增加一个单位，需要对应增加一个存储介质，用磁盘模拟存储介质时则增加一块磁盘空间。因此，在设定覆盖保护周期时要综合考虑工艺文件编制所花费的时间与现有资源的限制。工艺文件从被创建到完成签署的时间段内存在被修改的可能，而完成的工艺文件经过签署被导入MES系统后，仅做查看用，不再进行修改。因此尚未经过签署的工艺文件是CAPP系统数据库的变量，发生错误或丢失时，通常要求能够恢复到之前某一时刻的状态。    设覆盖保护周期为T，可用磁盘空间总容量为S，每次备份的介质占用磁盘的预估空间上限为ds，则可用磁盘所包含介质个数为     设两次备份开始时间的间隔为Tm，由于覆盖保护周期是从介质最后一次备份结束的时间算起，所以设进行一次备份预估的时间上限为TB，则最大覆盖保护周期为     设编制每份工艺文件花费的时间为ti，则编制工艺文件的平均时间为     由于为每一份工艺文件单独设定覆盖保护周期将大大增加备份运维的成本，所以采用如下的折中策略，设某一时刻工艺文件的备份数据最大留存时间为t+△t，其中△t代表备份数据最大留存时间与编制工艺文件平均时间t的允许偏差，可为正值或负值。则覆盖保护周期为 3 备份作业部署及运行    3.1 备份系统架构    信息化备份系统的架构有多种形式，其中LAN-Based、LAN-Free以及Server-Free较为常见。如图4所示，在LAN-Based备份系统架构中，数据通过网络传输，备份服务器负责整个系统的备份操作，备份介质连接在某台服务器上，备份服务器把备份对象数据传输到备份介质中实现备份。其优点在于节省投资，备份介质共享，备份集中管理；缺点在于对网络的传输压力大。     图4 LAN-Based备份架构    如图5所示，在LAN-Free备份系统架构中，备份对象服务器和备份介质位于共同的SAN中，各自作为独立的光纤点，数据流不再经过网络，而是直接从备份对象的磁盘阵列通过光纤传输到备份介质上。Server-Free备份系统架构则在LAN-Free架构的基础上增加了“第三方代理”的设置，与LAN-Based架构相比，它的备份速度更快，网络传输压力减小，但投资增大。     图5 LAN-Free备份架构    LAN-Based的备份架构可充分利用现有网络资源，与LAN-Free和Server-Free备份架构相比，可以节省光纤等方面的投入，只需添加一台备份服务器和备份存储介质即可。鉴于CAPP系统的数据量有限，通过合理地设定备份时间可以解决网络带宽被占用所带来的问题，所以，CAPP系统的备份架构采用LAN-Based形式。    3.2 备份实现    在备份的实现上，将CAPP数据库所在服务器作为备份对象，采用LAN-Based备份系统架构，设置1台CAPP数据库服务器之外的备份服务器，对备份作业进行管理和监控，同时将备份服务器本身的磁盘空间作为备份介质，按照第2节所述的方式设定介质循环策略与覆盖保护周期，对CAPP系统的数据信息进行周期性的异地备份。    为避免备份时占用较大的网络带宽，影响用户的正常使用，根据CAPP系统用于工艺设计人员进行工艺文件设计，白天工作时间数据库访问最为频繁的特点，将CAPP系统的备份作业设定在夜晚服务器访问量较少的时间段进行。    在备份的具体实现上，采用Symantec Backup Exec作为备份管理软件，安装该软件的备份服务器通过与安装在CAPP数据库服务器上的Agent进行通信来获取CAPP的工艺文件数据，并将数据完全备份在备份服务器的磁盘空间上。经一段时间的试运行，备份作业运行正常，备份介质能够按照计划进行写入与覆盖，且能够通过使用备份介质将CAPP数据库信息完全恢复到另一台服务器上，验证了此备份模式的可行性。4 结束语    本文分析了适合用于编制航天器工艺文件用CAPP系统的备份模式，根据航天器工艺数据的特点以及CAPP系统的特点和应用情况，对备份方法、介质循环策略和覆盖保护周期等进行了设定和分析，确定对CAPP数据库中的航天器工艺数据采用改进的父子循环策略进行完全备份，根据建立的公式设定覆盖保护周期。最后，对CAPP备份作业的具体部署进行了分析和设计，采取LAN-based备份系统架构搭建备份平台，实现数据的异地周期性备份，保障数据安全。    本文针对航天器工艺数据特点为CAPP系统制定的备份架构和备份策略，可推广到同类型工艺信息化系统的备份模式制定和实施。对于其他类型的信息化系统，如何针对不同系统的特点，随需应变地设置备份模式，科学地实施对多个应用系统的备份，将是未来研究的重点。