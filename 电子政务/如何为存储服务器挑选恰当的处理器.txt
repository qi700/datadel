如何为存储服务器挑选恰当的处理器
进入到2013年后经济趋于稳定，于是许多企业的IT部门在考虑升级各自的计算和存储系统。与任何IT采购决策一样，硬件功能和可用技术方面需要考虑一些利弊，并作出一些选择。而说到采购存储服务器，第一步就是你要明白在处理器方面有什么样的选择。　　当贵企业的IT团队考虑升级计算和企业存储系统时，务必确保你明白在高性能服务器处理器选项方面所面临的选择和利弊。我们给出的一些建议似乎不合常理，但不必大惊小怪。　　进入到2013年后经济趋于稳定，于是许多企业的IT部门在考虑升级各自的计算和存储系统。与任何IT采购决策一样，硬件功能和可用技术方面需要考虑一些利弊，并作出一些选择。而说到采购存储服务器，第一步就是你要明白在处理器方面有什么样的选择。　　英特尔与AMD　　服务器处理器方面的两大选择仍然是英特尔与AMD，至少今年是这样。ARM也许能解决有些问题的一些计算任务，但是在2013年，ARM不会有足够的输入/输出带宽以及万兆以太网端口和存储，让其成为一种切实可行的替代选择。这种情况在2014年可能会发生变化，但现在作一番预测为时过早，因为拥有足够性能的PCIe总线方面的变化和发展错综复杂。　　最新的AMD处理器有16个核心，但前提是你在运行整数操作。说到浮点操作，你只有8个核心。再加上这一点：最新的英特尔服务器处理器数据和写入来自内存的数据其速度远超过AMD处理器，这意味着AMD处理器应该用于处理计算密度很低，又不需要高内存带宽的操作——你可能会想到虚拟机之类的应用环境，但是本文后面会详细介绍为何将AMD用于虚拟机不是个好主意。　　处理器插座之间的通信　　英特尔有巨大优势的另一个方面在于处理器插座之间的通信。目前这一批英特尔服务器处理器通过快速通道互连技术(QPI)，支持处理器插座之间每秒25.6吉比特(25.6 Gbps)的输入/输出带宽。　　这种性能结合每个插座的内存带宽性能，超过了AMD处理器目前的性能。在多插座计算机上，这对所有插座的性能带来了巨大影响，因为进程可能提出请求，想了解哪部分内存分配给了另一个插座。　　PCIe总线推动英特尔前进　　PCIe起到了实际检验的作用，它表明了最新的英特尔处理器为何比AMD处理器远胜一筹。最新服务器处理器上的英特尔技术运行PCIe 3，每个处理器上有40条通道。　　这意味着，PCIe总线和处理器能够达到40Gbps的输入/输出带宽。这远高于AMD处理器上的可用带宽。所以，如果你需要进行频繁的网络输入/输出或磁盘输入/输出操作，PCIe 3是更适合的选择，因为它的带宽比PCI 2.0高得多，这种总线的性能将翻番，而且英特尔处理器支持数量更多的PCIe通道。　　今年是英特尔之年，但仍存在问题　　新英特尔处理器存在一个问题，这个问题在四插座配置下显得尤为突出。如前所述，PCIe总线位于处理器插座上，所以如果是四个插座，你就有四条PCIe总线，每条总线有40条通道，因而总共有160条通道的1Gbps PCIe带宽。这是很大的输入/输出带宽，但是如果深入研究一下，会发现这个问题：　　1. 插座与插座之间的QPI连接是一条双通道的12.8Gbps通道，总性能为25.6Gbps　　2. 一个插座的PCIe express带宽是40 x每条通道1Gbps;也就是说，对插座而言PCIe带宽达到40 Gbps。　　当PCIe带宽超过25.6Gbps，请求访问PCIe总线的进程又不在请求访问的总线所在插座上，很快就会出现问题。尝试的一些变通办法会锁定需要读取或写入的PCIe总线所在插座上的进程。但这种办法并不适合所有应用。比如说，数据进出多个位置(比如条带化文件系统)的那些应用就会受到影响，因为你无法拆解请求，把每个请求转移到每条PCIe总线。　　对于在四插座系统上运行的通用应用程序而言，实际性能可能估计是插座之间的QPI带宽的90%(即23Gbps)，除非数据通过PCIe总线所在插座传送出去。如果分配均匀，每第四条输入/输出的运行速度将是40Gbps，所以平均性能将是(3x23Gbps +40Gbps)/4;也就是说，对四插座系统而言，每个插座的平均性能大约是27.25Gbps。　　当然，这个平均值基于对PCIe总线的进程和输入/输出进行平均分配。拥有PCIe处理器亲和性(processor affinity)的进程将大大提高平均值，但是常常很难设计架构，并满足把每个任务都放在PCIe总线上，并确保进程在该总线所在处理器上运行的要求。这种限制在四插座系统上的可能性大于在双插座系统上的可能性。　　我估计双插座系统的性能是(23Gbps +40Gbps);也就是说，平均插座性能是31.5Gbps。在双插座系统上，设计系统的架构要容易得多，那样你就能把合适的输入/输出放在合适的处理器上，获得近乎最高的性能。　　处理器方面的结论不合常理　　新的英特尔系统其输入/输出带宽要比之前的系统高得多;而且拥有比AMD更多的可用的功能特性。如果你需要让大量的数据进出系统，ARM 目前还不具备竞争力。　　采用最新英特尔系列的四插座系统其平均性能约为27.25Gbps，除非在系统架构设计方面进行了相当大的工作，以便与处理器和PCIe总线连接起来。当然，系统的每秒输入输出操作(IOPS)性能会比较高，因为IOPS不受QPI带宽限制的影响。　　双插座系统更容易获得更高的性能，平均系统性能超过4.25Gbps。所以，我的结论是，如果你使用双插座系统来满足很高的输入/输出带宽需求，那么情况比使用四插座系统来得好。当然，这显然不合常理，但是考虑到目前的英特尔架构，这又是最明智的策略。　　你极有可能会在2013年看到Ivy Bridge服务器处理器，QPI带宽会大幅提升，到时采用Ivy Bridge处理器的四插座系统可能比较明智。想一探究竟，还得等Ivy Bridge服务器处理器发布之后。