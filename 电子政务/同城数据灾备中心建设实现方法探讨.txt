同城数据灾备中心建设实现方法探讨
本文结合国土资源部数据中心现状，分析研究了实现同城灾备的技术方案，即同步传输方案和异步传输方案，以及这些技术方案的技术实现层面：存储层、主机层和数据库层。在此基础上，本文进一步分析了两种方案的技术框架、设备组成和技术特点，并对两种方案在数据安全保障、对生产系统影响、传输距离和带宽要求和应用场景等方面进行了对比，为今后同城灾备中心建设提供了思路。 1 引言
在“十一五”期间，随着国土资源行业内诸多调查评价工程的开展和信息化建设的推进，国土资源部数据中心积累了大量的数字化成果，这批成果越来越多地应用于国土资源部各类业务系统中，成为国土资源管理和国家宏观决策的重要信息参考来源。
另一方面，随着存储与应用服务等计算机硬件设备的增加，来自硬件设备本身、机房环境、人为操作和外界不可预知的风险及不确定性也随之增加，造成数据丢失或业务的突然中断，给国土资源管理带来重大不便。因此，保障国土资源数据安全和业务系统稳定运行是今后数据中心首先要考虑的问题。
2 现状与需求
2．1现状
目前，在国土资源部数据中心已经建立了基于SAN架构的内网核心存储备份系统，管理着支撑电子政务平台和综合监管平台等重要业务系统的数据源，该架构下的存储备份体系框架图如下所示：
数据中心的存储设备由两台磁盘阵列组成，分别是HDS 9980V和HDS USPV，通过两台Brocade 24000光纤交换机与生产主机、存储备份服务器和磁带库连接组成存储局域网(SAN)，存储备份软件采用Bakbonenetvauh实现众多应用系统数据的定期备份。目前的存储备份体系解决了在数据中心内部出现单点故障的情况下数据的安全问题。
图1 国土资源部数据中心内网存储备份体系示意图
2．2 需求
为了解决在部数据中心发生整体灾难的情况下数据安全问题，需要在同城某地机房选择建立一个数据备份中心，把部数据中心重要业务系统的数据备份到灾备中心，在生产中心发生灾难的情况下，实现数据的可恢复和可使用，在有限的投资和管理成本下，实现最小程度的数据丢失。
3 实现方案
在同城实现数据灾备有两种方式可供选择，一是数据同步传输备份方式，二是数据异步传输备份方式。数据同步传输备份方式，就是通过容灾软件将本地生产数据通过某种机制复制到异地，在异地建立起一套与本地数据实时同步的异地数据。数据异步传输备份方式则不要求备份数据与生产数据实时同步。
在实现方法上，目前可以操作的层面有三种，一是存储硬件本身，就是通过盘阵自带的软件模块实现两端的数据传输，如EMC的SRDF、HDS的UR和TrueCopy、IBM的PPRC等；二是应用主机层面，通过应用主机进行两端的数据传输，如IBM的XRC软件、Bak—Bone的NetVauh Replicator和Veritas的VVR软件等；三是数据库层面，通过数据库的相关模块实现两端的数据传输，如：Oracle的Data Guard和SQL Server的Mirror等。这三种层面的数据传输都可以实现同步和异步的方式。
基于存储硬件本身的同城灾备需要两端的磁盘阵列为相同类型，而且在两端部署统一版本的数据传输软件；基于主机的数据传输则需要在两端各部署一台主机，在主机上安装数据传输软件，而不要求两端的磁盘阵列为相同类型；而基于数据库的数据传输则要求数据库类型一致，对主机和磁盘的依赖较小。
4 方案对比
实现同城异地的数据灾备，根据数据传输的方式，分为同步传输方案和异步传输方案两种，两种方案对传输链路、配置硬件和数据安全保障方面都有一定的区别。    4．1同步传输方案
同步传输方案由于两端对数据传输
的实时性要求比较高，一般采用光纤链路实现生产中心和灾备中心的数据传输。同步传输方案的示意图如下(图2)：
图2 基于光纤链路的同步传输方案示意图
在同步传输方案中，除了租用光纤链路之外，还需要在生产中心和灾备中心部署以下软硬件设备：
磁盘阵列：如果采用基于磁盘阵列的容灾软件，则需要在灾备中心部署与生产中心同类型的磁盘阵列，两端分别部署容灾软件；如果是采用基于主机和数据库的容灾软件，则不需要部署相同类型的磁盘阵列。管理、测试与验证服务器：部署在灾备中心，用来管理、测试与验证备份数据，不一定与生产中心完全相同，但是需安装相同的应用系统、数据库系统、中间件等。
密集波分复用器(DWDM)：需要在生产中心和灾备中心各部署一个，实现备份数据的多波段传输。
4．2异步传输方案
异步传输方案可以采用与同步传输方案相同的架构(如图2所示)，只是容灾软件设置的数据传输方式不同。
另外，异步传输方案由于对传输速度的要求不像同步传输那样苛刻，可以采用以太网络传输，因而不受距离的限制。采用以太网络传输的异步备份方案如图3所示：
硬件配置方面，由于采用了以太网链路传输，需要在生产中心和备份中心两端各部署一台FC和IP转换的路由器，而不是密集波分复用器(DWDM）。其他硬件设备可参照同步传输方案配置。
图3 基于以太网的异步传输方案示意图  4．3方案对比
采取同步或异步的备份方式，需要根据业务系统应用特点、需要备份的数据量和投资成本来综合考虑。除了本身传输方式的区别以外，采取同步或异步的数据备份方案，还存在以下几个方面的区别。
数据安全保障方面。同步传输备份方案在最大程度上保障两端的数据一致，在一定的距离内做到了数据的零丢失；异步传输备份方案由于存在一定的时间差，会有一定程度的数据丢失，数据丢失量是依据传输策略制定可控的RPO(数据恢复点，例如2小时、4小时、12小时等)，RPO值设置越小，数据丢失越少。
对生产系统的影响。同步传输备份方案会占用生成系统的I／O，降低生产系统的性能，异步传输备份方案对生产系统不会产生过多影响。
传输距离与带宽要求。同步传输方式要求带宽比较高，一般采用光纤链路，距离(链路距离)不超过100公里，最好在60公里以内；异步传输方式对带宽和距离的要求低很多，可以采用以太网络，因此不受距离限制。
适用场景。同步传输方式适用于业务系统数据变化和更新频率高，数据比较重要，不允许有任何数据丢失的业务系统，同时，投资的企业和部门又有意愿和财力进行设备投资和改善生产系统的运行性能。异步传输方式适用于业务系统数据变化和更新频率不高，能够容忍一定程度的数据丢失的业务系统，同时，投资企业和部门又不愿花费过多财力进行设备投资和生产系统的更新升级。
5 讨论和建议
在部数据中心虽然运行了许多的业务系统，但是大部分业务系统不像银行、保险等金融业务那样实时强，数据不必做到零丢失，同时，考虑到远程灾备的目标是应对小概率事件，那么，灾备的投入产出比就非常重要，因此尽可能少的减少投资成本和运维成本是建设灾备中心需要考虑的一条重要原则。
另一方面，数据灾备是应用灾备和系统灾备的基础，因此如果考虑今后应用灾备和系统灾备建设，首先要考虑灾备中心对数据的实时忙E要求，所以，灾备中心建设要立足于今后和实际需求，合理地确定技术方案。