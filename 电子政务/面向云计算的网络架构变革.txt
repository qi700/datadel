面向云计算的网络架构变革
云计算的关键技术在于将资源进行池化，通过虚拟化技术将计算、存储、网络形成资源池，就象水电一样按需使用。但即使发电站功率再强劲，没有电网的通畅传送，用户也无法享受到便利。在云计算业务环境中，对网络产生了更加复杂的需求，需要网络产品和解决方案针对这些需求实现网络的整体的变革。前言    云计算的关键技术在于将资源进行池化，通过虚拟化技术将计算、存储、网络形成资源池，就象水电一样按需使用。但即使发电站功率再强劲，没有电网的通畅传送，用户也无法享受到便利。在云计算业务环境中，对网络产生了更加复杂的需求，需要网络产品和解决方案针对这些需求实现网络的整体的变革。云计算数据中心网络的发展方向    云计算将主导应用的未来这一点已经成为业界的共识。在网络架构方面、在网络流量模型方面、在网络安全方面，云计算网络都和以前的传统数据中心网络有很大的改变。为适应云计算业务的发展，网络需要在性能、架构融合、安全融合等方面做出改变，最终能形成全网智能的带宽调动、安全调动，让网络随时就绪。一 端到端万兆网络构筑高速大道    虚拟化给网络带来了性能挑战，但提升网络的整体性能需要有的放矢。首先需要明确网络的瓶颈究竟在哪里。根据目前大量的案例和实践总结分析，数据中心网络主要面临两个瓶颈：一是数据中心的核心交换设备，它作为数据中心所有业务系统之间，以及业务系统和用户之间的交换枢纽，将会是所有流量汇集的地方，所以网络核心的性能压力最大，是可能的瓶颈所在。另一个就是安全设备，安全设备的性能往往落后于网络设备一个级数，而其在企业数据中心的部署又是必不可少的防护措施，所以如何突破安全的性能瓶颈至关重要。    网络技术和数据中心的发展，同样推动了数据中心级交换机的出现，目前数据中心级的核心交换机基于CLOS的多级交换架构，使其具备了10T以上的交换容量，能够支持高密度的万兆端口和未来的100GE标准，具有更好的扩展性，能够很好的缓解数据中心网络核心的交换压力，解决核心网络性能瓶颈。另一方面，虽然部门高端安全设备已经搭建在10G平台之上，但依然不能满足对其在性能上的高要求，所以目前最好的解决方法就是将万兆的安全设备与网络设备结合部署，通过在网络设备中部署支持安全模块实现性能累加，该方式在当前的数据中心建设中已经逐渐成为了主流方案，不但可以解决安全设备带来的性能瓶颈，而且可以解决安全系统部署在可靠性上和空间上遇到的种种难题。二 网络虚拟化技术为虚拟机迁移铺平道路    当虚拟机在物理服务器之间进行迁移，为了避免虚拟机迁移后路由的震荡和修改网络规划，迁移只能在二层域进行，因此数据中心需要具备一个性能更高、二层域更大的网络环境为迁移提供保障。在传统的数据中心网络中，都是通过STP+VRRP的方式进行网络拓扑设计，但由于STP+VRRP的设计和维护都比较复杂，这种设计在很大程度上阻碍了其二层域的扩大，随着服务器的数量和网络设备的增多，这种网络设计方式将会变得无法实施。同时，虚拟机的迁移对网络的可用性要求也非常高，在STP+VRRP的组网中，如果链路出现故障，其收敛时间都在秒级，增加了应用系统迁移的限制。 图1：传统组网图 图2：虚拟化网络组网图    以上问题可以通过网络虚拟化技术来解决，在数据中心的应用中，网络虚拟化主要是通过将多台物理设备虚拟成一台逻辑设备的方式，来减少设备节点，并通过跨设备链路聚合技术取代传统部署方式中的STP+VRRP协议，使网络拓扑变得简洁，具备更强的扩展性，以满足虚拟机迁移所需要构建的二层网络环境，同时，其毫秒级的故障收敛时间，为虚拟机迁移提供了更加宽松的实现环境。三 分布式缓存应对虚拟环境下的突发流量冲击    绝大多数应用系统的流量模型都有一定周期性（即流量波峰的出现时间），就像乘坐电梯一样，通常都是上下班时间客流最多，其他时间电梯基本处于空闲状态。但突发流量已经成为了数据中心网络系统面对的最棘手的问题之一，其难点在于业务的变化使得无法准确评估出其出现的峰值、精确的时间。服务器和存储等设备实现虚拟化后，多个应用的叠加产生的突发流量就更加难以衡量和控制。所带来的直接影响就是造成网络拥塞，严重的甚至会导致业务中断。    要解决这个问题，首先需要分析哪里会产生拥塞？网络的拥塞只有两种情况，一种是多个端口向一个端口发送数据的情况，另一种就是高速端口向低速端口发送数据的情况。找出拥塞节点并增加其带宽，可以解决一部分问题，但是对于数据中心中复杂的业务模型和应用的变更而言并不适用，更加实际和行之有效的方法就是利用分布式缓存技术。所谓分布式缓存技术，主要是相对于传统设备的出端口缓存技术而言的。传统的网络设备，缓存都是部署在设备的出端口，该技术可以缓解网络中高速端口向低速端口发送数据时产生的拥塞，但是对于网络中存在的多个端口向一个端口发送数据的情况却是无能为力。分布式缓存通过对传统的出端口缓存机制进行改良，将端口缓存置于入端口，这样的实现方式可以灵活的根据入端口数量来动态的调整可用缓存的容量，可以很好的解决数据中心网络环境中突发流量在上述两种情况下带来的网络拥塞，提高业务连续性。    所以，在数据中心的网络部署时，为了应对网络核心处交互式流量的过载而产生的拥塞，需要在网络的核心位置部署分布式缓存机制的数据中心设备；在接入层可以通过缩小收敛比来减少服务器上行流量带来的冲击，并要求网络设备具备一定的缓存能力，来缓解下行流量对接入交换机的影响。
四 VEPA虚拟机感知网络    服务器虚拟化之后如何网络进行对接，如何在网络层实现对虚拟机的管理与控制？将是云计算环境下网络面临的新问题。针对此问题，HP与H3C于2009年向IEEE EVB(Edge Virtual Bridging)组织提交了VEPA(Virtual Ethernet Port Aggregator，虚拟以太网端口聚合器)方案，此方案作为802.1Qbg标准草案立项，目前已经到Draft 2.1版本(2012年1月)，VEPA方案的目标是要将虚拟机之间的交换从服务器内部移出到接入硬件交换机上，实现虚拟机之间的“硬交换”。采用这种方法，通常只需要对网卡驱动、VMM桥模块和外部交换机的软件做很小的改动，从而实现低成本方案目标，而且对当前网卡、交换机、现有以太网报文格式和标准影响最小。此方案具有性能高、控制力度强、配置管理简单等特点。    采用VEPA方案，虚拟机的流量都是通过物理接入层交换机完成，它的访问控制和报文下发策略也是基于物理接入层交换机，因此很好地避免了网络和服务器设备管理边界模糊的难题。VEPA标准协议VDP还能准确的感知虚拟机的工作状态，当虚拟机发生迁移时，VEPA协议会将与此相关的访问控制和报文下发等策略重新部署到新的接入交换机。    H3C S12500系列核心交换机    H3C S12500是杭州华三通信技术有限公司面向下一代云计算数据中心设计的核心交换产品，采用先进的CLOS多级多平面交换架构，可以提供持续的带宽升级能力。
图3：H3C S12500系列交换机    S12500是100G平台交换机，支持未来40GE和100GE以太网标准，整机可以提供最高576个万兆端口，提供高密度万兆接入能力；面对下一代数据中心突发流量，创新的采用了“分布式入口缓存”技术，可以实现数据200ms缓存，满足云数据中心、高性能计算等网络突发流量的要求；为了满足数据中心级网络高可靠、高可用、虚拟化的要求，S12500采用创新IRF2（第二代智能弹性架构）设计，将多台高端设备虚拟化为一台逻辑设备，同时支持独立的控制引擎、检测引擎、维护引擎，为系统提供强大的控制能力和50ms的高可靠保障。    S12500产品包括S12508、S12518两个型号，能够适应不同网络规模的端口密度和性能要求，为数据中心网络建设提供有力的设备保障。同时结合H3C系列路由器、交换机、安全、存储以及iMC智能管理平台为数据中心网络提供全系列的解决方案。总结    本文主要针对云计算业务环境给数据中心网络带来的变革进行了分析，实际上在云计算系统的实施过程中，给数据中心的影响不止局限在网络上，其给其它支撑系统也同样带来了严峻的挑战。但网络作为业务运行的关键基础，如果不提前考虑和规划未来的技术需求，网络反而会成为业务发展的掣肘，需要我们投入更多的精力去分析和解决面临的问题，为迎接云计算时代的到来做好充分的准备。