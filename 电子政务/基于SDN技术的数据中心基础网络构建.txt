基于SDN技术的数据中心基础网络构建
本文方案弥补了云计算在网络虚拟化方面的短板，使计算、存储和网络进一步整合，实现真正意义上资源完全自动化部署、实时资源调度和快速网络故障排除，并具有随时增加新业务的潜力，加快网络创新节奏，为云计算中心运营者降低维护成本、提高用户体验提供了新的选择。1 前言    随着终端计算处理能力的提高、网络传输能力的扩大，Web技术的出现和发展，网络所承载的信息急剧膨胀，互联网不再是单纯以通信为目的的网络，而是更多地朝着满足人们获取信息需求的方向发展，成为一个信息承载和分发的平台。由于人们对信息获取方式(有线、移动)、信息类型(数据、话音、视频)、信息质量、信息安全等呈现多元化的需求，所以互联网为了适应和满足各类需求不断地引入大量的控制协议。形成了一个庞大的控制平面。这些控制协议从设计上依附于特定的转发协议，而且从实现上看，控制平面与转发平面都运行在网络设备中，给网络功能的扩展和网络的管理带来了巨大的挑战。    随着云计算的兴起，利用虚拟化和面向服务技术，能够为智能轻便设备提供类型广泛的业务服务。在这种计算模式下，计算和存储能力向网络中心迁移，形成数据中心，大量的计算请求、信息请求依托网络向数据中心发送，网络成为数据中心和用户的纽带。传统的计算、存储一体的个人计算机转变成计算、存储功能分离的集群系统，网络不仅要实现不同接人方式的融合、不同信息类型的传输、不同等级服务质量的保证、不同安全方法的应用，而且要实现用户的透明接入和以应用为中心的网络适配，这就要求对网络的控制更加功能灵活，接口开放和性能强大，能够像软件系统一样模块化、可定制、易扩展。冯·诺依曼采用功能抽象模型，把计算机抽象为一系列功能模块，计算机由运算器、控制器、存储器、输入设备、输出设备等功能模块组成。冯·诺依曼模型的着眼点是计算机体系结构，计算系统经历了从封闭系统到水平扩展再到垂直分层的演化过程。当前的互联网也处在封闭系统的阶段，对其进行抽象、分化、垂直分层的工作，有利于互联网向高级灵活网络的演进。    软件定义网络(SDN)是一种新型的网络技术。其最本质的特征就是网络控制与转发分离，转发行为可编程。通过控制功能的迁移、对应用和网络的抽象、将转发平面与控制平面分离，能够把网络看成一个逻辑或虚拟实体，成为类似计算机的基础架构，将转发行为抽象，提供标准化的、开放的控制接口，控制平面可以运行在外部调用控制接口，并根据全局的网络视图，实现更加灵活的控制能力。所以网络的垂直分层，为实现软件定义网络提供了可能，更为网络与计算、存储等功能结合，形成网络、计算和存储融合的服务环境提供了可能。    公有云数据中心以资源出租为核心业务，因此资源的有效管理和交付是云计算数据中心运营者时刻关注的重点。数据中心规模化带来了资本的集约化，同时也带来了一系列规模问题。    ·大型网络的管理问题。大型数据中心中包括数千台物理交换机、数万台的虚拟交换机，一个简单的故障，如如何进行端到端的定位都变成了一件非常困难的任务。据统计。大型数据中心50％-80％的出错都是由于人的误操作导致，如何强化数据中心自主配置与管理是亟待解决的最现实需求。    ·服务器与物理资源绑定，带宽，机架等租赁业务开展受硬件资源限制，维护管理复杂。引入服务器虚拟化后，业务部署以虚拟机(VM)为单位，其部署的位置是可以浮动的，同时虚拟机也可以在运行时迁移，因此也超出4 096个VLAN ID范围的海量多租户需求。    ·资源利用率低，难以实现网络与虚拟机间的快速协同。现有网络无法支持虚拟私有云的客户订制化网络配置实时生效，不能实现多层网络间协同，难以按需调整带宽。    基于软件定义网络的多租户数据中心解决方案将软件定义网络技术运用到数据中心，弥补了云计算在网络虚拟化方面的短板，使计算、存储和网络进一步整合，实现真正意义上的资源完全自动化部署、实时资源调度和快速网络故障排除，并具有随时增加新业务的潜力，为云计算中心运营者降低维护成本，提高用户体验提供了新的选择。2 将软件定义网络引入数据中心    云计算的特点之一就是将资源进行集中分配调度，计算资源和网络资源由不同的平台提供，要求更有效的计算／网络／存储资源整合能力，关键是形成云计算数据中心统一的资源调度组。    虚拟化使物理设备转化为资源池，具有按需分配和互相隔离的特征，虚拟化是资源能够灵活分配调度的必要条件。服务器虚拟化和存储虚拟化都有了较成熟的解决方案。并且都有成熟的软件平台提供资源部署和调度。但是数据中心的业务是离不开网络的，每个租户都需要通过网络连接自己的虚拟机，并且不能与其他租户的网络互相干扰。因此，网络作为资源的一部分同样向着虚拟网络发展。数据中心的网络必须隔离成多个虚拟网络。分配给各个租户，使每个租户都感觉在独立使用网络，可以分配自己的IP地址，设置自己的网络安全策略。    按目前的网络技术，租户网络的隔离可以采用VLAN技术，安全策略可以在交换机上进行配置。但这种方式存在很大的问题，如VLAN的个数限制，VLAN ID的长度限制VLAN个数不能超过4 096个，因此租户数目受到限制。另外，虚拟机的申请、释放和迁移都具有动态性，这使得与虚拟机相关的网络配置也必须具有动态性，频繁修改网络配置使网络管理非常复杂。因此，从整个数据中心的管理层面讲，希望虚拟机、存储系统和网络能够无缝集成，虚拟机部署时自动化部署网络配置，虚拟机迁移时网络配置跟随迁移。进一步，理想的数据中心网络应能够根据网络拓扑优化网络流量，使网络容量得到高效率的利用。  图1 SDN基本原理 面对数据中心网络的需求，软件定义网络提供了解决方案，将网络资源虚拟化。使得计算调度可以摆脱网络的束缚。图1是SDN基本原理的说明，SDN采用数据抽象转发模型，把交换机的转发过程抽象为一系列“流表(flowtable)”。控制面设备为NOS(网络操作系统)，它通过OpeFlow或其他协议控制转发面的SDN转发设备。SDN关注的焦点不是交换机体系结构或ASIC实现的标准化，而是网络控制器。有了集中式的网络控制器，就有了全局网络视图或更多的网络状态信息，视野更开阔，信息更丰富。可以实现数据中心场景下原来分布式网络控制模式下难以实现的网络新功能。    从网络控制器的角度看，它对交换机转发行为的控制，具体体现为控制器可以直接读写交换机的转发表。控制器通过操纵流表，而不是操纵SDN转发设备上的功能模块来“指挥”交换机。也就是说，从控制器看交换机，看到的部件是流表，而不是硬件功能模块，SDN的控制器不关心流表硬件实现。这就是SDN采用数据抽象的原因。    SDN转发设备本身没有智能，它完全按照NOS下载的流表进行流量转发。流表包含匹配规则和行为，指示符合这种规则的数据流如何转发。另外，SDN转发设备能够将网络事件，如未匹配的数据分组、端口中断和激活等，转发给NOS，供NOS做决策。    SDN的引入，使数据中心网络具有了可编程性，使数据中心网络支持多租户、流量优化、虚拟机迁移等成为可能。3 以SDN技术构建数据中心基础网络    将SDN技术应用到数据中心网络中。使网络资源能够与计算资源和存储资源一起进行统一调度，并提供开放接口给上层应用，进一步提供新业务开发能力。    3．1 以SON技术构建数据中心系统架构    以SDN技术构建的数据中心系统架构如图2所示。    系统分为3部分。    (1)VDC Manager    即虚拟数据中心管理器，负责实现整个多租户数据中心业务逻辑，它同时与VM Manager和SDN NOS接口统一控制计算、存储和网络资源，保证计算资源和网络资源同步调度。VDC Manager内部保存每个租户虚拟机和网络配置信息的对应关系，给用户提供一个逻辑视图，使每个用户能够看到自己的虚拟网络，并按照自己的策略进行管理，同时又不会干扰其他租户的网络。用户对虚拟机和虚拟网络的操作被转化为对SDN NOS和VM Manager的调用。  图2 SDN技术构建数据中心系统架构    (2)SDN NOS    即SDN控制面实体，建立全网视图，负责全面管理网络资源。通过OpenFlow协议控制数据中心的SDN转发设备。SDN NOS软件部分包含NOS核心，即网络操作系统核心，为上层应用提供运行环境和系统服务。NOS之上可以运行各种应用模块。SDN NOS提供开放API给VDC Manager。    (3)VM Manager    即虚拟机管理器，负责管理计算资源和存储资源，上报虚拟机创建、迁移等事件，内部包含虚拟机迁移、高可用性(HA)、资源调度等模块。它提供接口给VDC Manager。 3．2 SDN技术带来的优势    由于SDN技术的引入，使数据中心网络成为开放的网络，并提供开放接口，为上层应用调度网络资源提供了可能，它为整个解决方案带来了如下优势。    (1)网络自动化部署、网络故障的自动探测和恢复。    VDC Manager将计算资源和网络资源进行绑定，当用户部署虚拟机时，VDC Manager能够自动获取虚拟机的位置，查询虚拟机相关网络特性，在其相连的交换机上部署网络特性。这样，无需人工干预即可部署整个虚拟网络。    控制面、转发面分别演进，转发面不感知任何业务逻辑，只是机械地按照流表中的指令集进行转发，从而实现数通设备转发面与控制面的解耦。使数据中心网络摆脱网络硬件的束缚。只关注对网络的功能需求，彻底解放软件的创造力。原有系统的功能升级在多个设备上分散进行，现有系统中在集中式的网络控制器一个点上运行即可。功能升级点减少。    由于SDN NOS能够实时探测网络拓扑的变化，当某两台SDN转发设备之间的链路中断时，或者某台交换机失效时，SDN NOS能够很快探测出来，为维护人员发生告警信息，同时还能够重新计算出新的路径，绕过失效的节点，使网络业务保持正常。    通过集中统一的调度管理实现业务的灵活部署，为数据中心多租户提供可靠保障，统一高效运维网络能够极大降低云计算数据中心的运维成本。    (2)支持虚拟机迁移    当虚拟机迁移时，VM Manager会通过接口通知VDCManager发生了迁移事件。VDC Manager调用SDN NOS的API，将虚拟机关联的网络特性同时迁移，保证虚拟机迁移完成时网络同步可用。整个过程也是自动化执行的。    (3)支持多租户    由于SDN具有可编程能力。SDN NOS可以加载应用模块，识别不同租户的网络流量，通过流表的控制，使数据流只能在同一租户的虚拟机间转发。突破VLAN 4 096的个数限制，支持大量相互隔离的租户网络。租户通过自服务门户分配虚拟数据中心，资源按需分配；租户资源隔离，独立分配IP、MAC地址和网络策略。    (4)网络流量优化    SDN NOS通过OpenFlow协议能够探测网络拓扑。感知底层网络拓扑变化，在控制面维护一个整网的拓扑视图。根据每个虚拟机所在的位置，SDN NOS就能够计算出每两个虚拟机之间的最佳路径，使流量按最佳路径转发。而且。SDN NOS还能够支持等价多路径转发、基于约束条件的最短路径转发以及感知网络、服务器负载的流量工程调度，实现广播抑制，通过支持ARP代答减少带宽浪费。SDN架构能灵活修改设备流表，改变数据报文的转发路径，可用于开发IDC节能减排应用。4 未来展望    SDN将网络的智能剥离出来，交给集中的网络操作系统，通过智能软件对硬件资源抽象，将资源聚合成能力池，使得网络更加软件化、敏捷化，为满足云计算数据中心动态、弹性、有效使用网络的应用需求，提供自动、安全、灵活有效调度资源的能力，结果可能将使得网络的创新节奏加快一个数量级。SDN的架构符合IT数十年来的发展大趋势：把性能和稳定性交给硬件，功能和多变性交给软件。同时SDN是一种IT技术对网络的渗透，结果必将是开启网络的IT化进程。    SDN已经在离计算最近、IT密度最高的地方——数据中心中引入，赋予了数据中心网络更灵活的能力，以降低网络开发维护成本。有利于推动设备侧／网络层新协议、新功能、新业务在网络上快速实现和部署。而离计算相对较远、计算稀疏的互联网网络中，同样需要提供可修改、可扩展、可按需求重构的能力，以支持设计出各种可能的未来互联网形态。开放网络设备和开放网络，将是未来网络体系结构研究中的有价值、有意义的重要研究方向。