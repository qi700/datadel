云计算中服务器虚拟化技术探讨(上)
探讨了服务器虚拟化对云计算的意义，服务器虚拟化的技术特点、功能要素、虚拟化技术选择需要考虑的因素及优缺点。前言    各种研究机构、组织、厂商对服务器虚拟化均有自己不同的定义，然而其核心思想是一致的，即它是一种方法，能够通过区分优先次序并能随时随地将服务器资源分配给最需要它们的工作负载，来简化管理和提高效率，从而减少为单个工作负载峰值而储备的资源。服务器虚拟化是一种对服务器计算资源的抽象化，它在物理服务器的基础上构建多个相互独立的虚拟服务器，从而将CPU、内存、vo等服务器物理资源转化为一组统一管理、可灵活调度、动态分配的逻辑资源。    不管云计算以IaaS，PaaS，SaaS的哪种业务形式出现，都需要基础的计算能力资源。在云计算的计算能力构建过程中，通过服务器虚拟化技术，将服务器硬件资源虚拟成一个整体的逻辑资源池，这个逻辑资源池能配置运行多个业务应用，而且能根据应用的实际需要动态地分配逻辑资源，这种按需分配的模式和动态资源调整的能力能最大幅度地提高服务器资源的利用率。虚拟化技术的这种特点契合了云计算的本质，因此虚拟化是云计算的重要技术要素。    云计算中不可避免地需要使用服务器虚拟化技术，本文就服务器虚拟化的技术要点、服务器虚拟化应具备的功能要素等方面进行探讨。1 云计算为什么需要服务器虚拟化    IT技术的发展可以简略地划分为3个时代。第一代是静态的IT，所有计算能力资源由系统独享;第二代是共享的IT，主要体现在计算能力的共享，但计算资源不能动态调整;第三代则是云计算，所有的信息和数据都在动态的架构上，不仅实现技术能力的共享，还可以实现计算资源的调整)。    计算资源包括服务器资源、存储资源、网络资源等，其中重点在于实现服务器资源的虚拟化。若要实现服务器的“按需服务”，就一定要让服务器变成动态的，而这都要看服务器在虚拟化方面的能力，虚拟化是动态的基础，只有在虚拟化的环境下，云计算才有可能。    利用服务器虚拟化技术，将现有服务器物理资源抽象成一个拥有巨大计算能力的“云”资源池，应用系统运行时可以动态调用这个“池”中的所有资源)这样，按照峰值设计服务器资源中浪费掉的那部分就被充分地利用起来了，服务器资源的利用率能提高到60%-80%，这与现有IT系统评价5%-10%的资源利用率形成巨大反差，我们仅需要原来服务器大约25%的资源即可满足信息系统运行需求，节省了约75%的服务器运营成本。    图1是一个典型的云计算平台逻辑层次图。在此架构下，由大量虚拟服务器所构成的虚拟化的硬件平台共同托起了全部软件层所提供的服务。在虚拟化与云计算共同构成的这样一个整体的架构中，虚拟化有效地分离了硬件与软件，而云计算则让人们将精力更加集中在软件所提供的服务上。    云计算必定是虚拟化的，虚拟化给云计算提供了坚定的基础。但是虚拟化的用处并不仅限于云计算，这只是它强大功能中的一部分。    虚拟化给云计算所带来的好处是多方面的，主要包括以下几点。    a)效率。将原本一台服务器的资源分配给了数台虚拟化的服务器，有效地利用了闲置资源，确保企业应用程序发挥出最高的可用性和性能。    b)隔离。虽然虚拟机可以共享一台计算机的物理资源.但它们彼此之间仍然是完全隔离的，就像它们是不同的物理计算机一样因此，在可用性和安全性方面，虚拟环境中运行的应用程序之所以远优于在传统的非虚拟化系统中运行的应用程序，隔离就是一个重要的原因。    c)可靠。虚拟服务器是独立于硬件进行工作的，通过改进灾难恢复解决方案提高了业务连续性，当一台服务器出现故障时可在最短时间内恢复且不影响整个集群的运作，在整个数据中心实现高可用性。    d)成本。降低了部署成本，只需要更少的服务器就可以实现需要更多服务器才能做到的事情，也问接降低了安全等其他方面的成本。    e)兼容。所有的虚拟服务器都与正常的Xg6系统相兼容，可部署多套不同的系统，将因兼容性造成问题的可能性降至最低。    f)便于管理提高了服务器/管理员比率，一个管理员可以轻松管理比以前更多的服务器而不会造成更大的负担。2 常见虚拟化层次    服务器虚拟化允许具有不同操作系统的多个虚拟机在同一物理机上独立并行运行。每个虚拟机都有自己的一套虚拟硬件(例如RAM ，CPU、网卡等)，可以在这些硬件中加载操作系统和应用程序。无论实际采用了什么物理硬件组件，操作系统都将它们视为一组一致、标准化的硬件。    虚拟化技术并非云计算时代首创，虚拟化的概念在20世纪60年代首次出现，利用它可以对属于稀有而昂贵资源的大型机硬件进行分区。随着时间的推移，小型服务器和PC可更经济地满足计算能力需求，因此到20世纪80年代，虚拟技术已不再广泛使用。到了20世纪90年代，计算能力需求的激增使得研究人员开始探索如何利用虚拟化技术解决与庞大的IT系统相关的一些问题，例如，利用率不足、管理成本不断攀升和易受攻击等、现在.虚拟化技术处于时代前沿、  图1云计算平台岁辑层次
按照虚拟化实现的要求，虚拟化技术应具备以下技术要点。    a)在一个物理系统中可以支持多个应用程序和操作系统。    b)可在扩展或扩张体系结构中将服务器整合到虚拟机中。    c)计算资源被视为以可控方式分配给虚拟机的统一资源池。    d)虚拟机与主机和其他虚拟机完全隔离，如果一个虚拟机崩溃，所有其他虚拟机不会受到影响。    s)虚拟机之间不会泄露数据，而且应用程序只能通过配置的网络连接进行通信。    f)完整的虚拟机环境保存为单个文件，便于进行备份、移动和复制。    g)为应用程序提供标准化的虚拟硬件，可保证兼容性。    h)整合多余硬件和提高服务器利用率。    目前服务器虚拟化中的实现层次类别可以分为硬件层虚拟化、逻辑层虚拟化、软件层虚拟化。    a)硬件层虚拟化。硬件层虚拟化指服务器硬件提供结构支持帮助创建虚拟机监视并允许客户机操作系统独立运行，不需要操作系统支持。可直接对硬件资源进行划分，任一分区内的操作系统和硬件故障不影响其他分区。    b)逻辑层虚拟化。逻辑虚拟化是指在系统硬件和操作系统之间以软件和固件的形式将硬件资源进行虚拟化。不需要操作系统支持，任一分区的操作系统故障不影响其他分区。    c)软件层虚拟化。软件虚拟化是指在主操作系统上运行一个虚拟层软件，可以安装多种客户操作系统，任何一个客户系统的故障不影响其他用户的操作系统，需要主操作系统支持。    目前云计算中一般采用廉价的x86服务器构建资源池，也有部分系统根据其需求采用中高档服务器构建资源池，而软件层虚拟化技术使用较少。    相对硬件虚拟模式而言，逻辑虚拟模式会占用一定比例的系统资源。目前大中型服务器采用硬件虚拟化;A1X和HP-UX上的虚拟效率在90%以上，虚拟化损耗约为5%;而x86架构一般采用逻辑虚拟化，虚拟效率则在80%左右，虚拟化损耗大约为20%。3 虚拟化技术探讨    在云计算的实现中，上述虚拟化技术类别均有涉及，服务器虚拟化实现技术主要是分区(包括硬分区或软分区，也称物理或逻辑分区)和底层硬件模拟(部分模拟或完全模拟)。    3.1分区    分区是小型机中广泛使用的一种虚拟化技术，通常由服务器的软件层和硬件层共同实现，为上层操作系统和应用提供相互隔离的运行环境。采用分区技术的服务器中，服务器的固件记录分区的配置信息，用以界定每个分区能够访问的GPU、内存等资源的范围和数量。同时，服务器底层软件可以通过对不同资源的激活和释放等操作，实现资源在不同分区之间的调度。分区技术起源于大型主机，目前小型机厂家的许多虚拟化产品，例如HP的near ，IBM的1Par都是基于或部分基于分区技术实现的。    3.2底层硬件模拟    底层硬件模拟是目前大多数虚拟化产品使用的虚拟化技术，它利用虚拟机监视器(VMM，也叫虚拟机管理程序)来模拟底层硬件的功能，为上层操作系统提供虚拟的运行环境。从操作系统的角度来看，运行在虚拟机上与运行在其对应的物理服务器上几乎没有区别。    采用VMM实现的服务器虚拟化通常分为2种类型。    3.2.1 Type I:裸金属架构    Type I虚拟化架构(见图2中逻辑层虚拟化部分)不需要在服务器上先安装操作系统，而是直接将VMM安装在服务器硬件设备中，本质上Type I架构中的VMM也可以认为是一个操作系统，只不过是非常轻量级的操作系统(实现核心功能)。  图2虚拟化技术层次    VMM实现从虚拟资源到物理资源的映射，当虚拟机中的操作系统通过特权指令访问关键系统资源时，VMM将接管其请求，并进行相应的模拟处理。为了使这种机制能够有效地工作，每条特权指令的执行都需要产生“自陷”以便VMM能够捕获该指令，从而使得VMM能够模拟执行相应的指令。VMM通过模拟特权指令的执行，并将处理结果返回给指定的客户虚拟系统的方式，实现了不同虚拟机的运行上下文保护与切换，从而能够虚拟出多个硬件系统，保证了各个客户虚拟系统的有效隔离。    然而，x86体系结构的处理器并不是完全支持虚拟化的，因为某些x86特权指令在低特权级上下文执行时，不能产生自陷，导致VMM无法直接捕获特权指令的执行。    目前，针对这一问题的解决方案主要有基于动态指令转换或硬件辅助的完全虚拟化技术和半虚拟化技术。    完全虚拟化是对真实物理服务器的完整模拟，在上层操作系统看来，虚拟机与物理平台没有区别。操作系统察觉不到是否运行在虚拟平台之上，也无须进行任何更改，因此完全虚拟化具有很好的兼容性，在服务器虚拟化中得到广泛应用。    从技术实现来说，完全虚拟化需要VMM能够处理虚拟机所有可能的行为。完全虚拟化的发展经历了基于软件辅助和基于硬件辅助2个阶段。