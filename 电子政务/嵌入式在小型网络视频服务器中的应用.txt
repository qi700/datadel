嵌入式在小型网络视频服务器中的应用
关键字： 网络视频 监控系统 嵌入式系统  视频监控系统是安全防范系统的重要组成部分，它是一种防范能力较强的综合系统，以其直观、方便、信息内容丰富而广泛应用于许多场合。近年来，随着计算机技术、图像处理技术以及网络传输技术的飞速发展，视频监控技术也有长足的发展，目前已经发展到第三代的嵌入式网络监控系统。1 视频监控系统的发展现状及趋势在数字视频和计算机网络等新技术的推动下。网络数字视频监控技术日趋成熟，并已经逐步深入到社会生活的各个领域，一跃成为现代多媒体技术及网络技术的一个重要研究方向。从第一代基于模拟摄像机的模拟监控系统，到第二代基于数字摄像机的数字监控系统，再到第三代基于网络摄像机的网络数字监控系统，监控系统已经经历了三个发展阶段。1．1模拟视频监控系统模拟监控系统发展较早，目前常称为第一代监控系统。模拟视频系统存在的问题：(1)只适用于较小的地理范围。(2)与信息系统无法交换数据。(3)监控仅限于监控中心．应用的灵活性较差。(4)不易扩展。1．2基于微机平台的数字视频监控(DVR)DVR是近几年迅速发展的第二代监控系统．采用微机和Windows平台，在计算机中安装视频压缩卡和相应的DVR软件，不同型号视频卡可连接1／2／4路视频，支持实时视频和音频，是第一代模拟监控系统升级实现数字化的可选方案，适合传统监控系统的改造，不适合新建的监控系统、又要求实现远程视频传输(超过1—2公里)的系统。DVR系统从监控点到监控中心为模拟方式传输．与第一代系统相似存在许多缺陷，要实现远距离视频传输需铺设(租用)光缆、在光缆两端安装视频光端机设备，系统建设成本高，不易维护、且维护费用较大。1．3基于嵌入式视频服务器的网络化视频监控随着Internet和宽带网络技术的日益发展．传统的以文字和图片为主的内容服务已不能满足用户的需求，具有视频和音频的多媒体内容服务即将成为主流，这是互联网技术发展的必然趋势。网络视频监控系统使用现有的网络系统，采用嵌入式的“网络视频服务器”，实现从监控点前端、监控中心、监控工作站的数字化处理，是监控系统发展的必然趋势。网络视频系统与上述第一、二代系统相比具有明显的优势：(1)用现有的网络资源，不需要为新建监控铺设光缆、增加设备，实现远程视频监控。(2)系统扩展能力强，只要有网络的地方增加监控点设备就可扩展新的监控点，维护费用低，网络维护由网络提供商维护，前端设备是即插即用、免维护系统。(3)系统功能强大、利用灵活、全数字化录像方便于保存和检索。(4)在网络中的每一台计算机，只要安装了客户端的软件．给予相应的权限就可成为监控工作站。嵌入式设备的监控系统的优点是，系统是专门设计的独立设备，不像插卡系统那样受通用计算机系统中其他软、硬件的影响，因此性能上更稳定，且便于安装、管理和维护。我们根据实际的需要，开发了一套基于嵌入式系统的智能视频监控设备。本文着重介绍其硬件实现。2 系统的硬件设计整个系统由图像采集模块、图像处理模块、USB HOST接口的存储模块、10/100M以太网接口等五部分组成，其主要设计思想是(见图一)：将CCD摄像头采集的模拟信号送入图像采集模块进行A/D 转换，然后在时序和控制信号的作用下，把图像数据送到AT91RM9200，AT91RM9200对采集来的图像进行实时处理和分析，判断图像中是否有动目标，并提取出动目标，再将当前图像中动目标的位置信息和最近被记录下的图像中动目标的位置信息进行相似度比较，决定是否记录当前图像。这样的方法能有效的避免长时间记录静止不变的图像，减少了存储介质的浪费，也减轻了资料检索的工作量。为了方便资料的存储与提取，给AT91RM9200的USB HOST接口接USB存储设备来存储图像数据，最后通过把图像数据通过因特网传输到用户终端。
图一 系统框图
2.1  图像采集模块系统使用的图像采集设备是CCD摄像头，成像器件：1／4 ＂SHARP CCD，有效像素：PAL:512x582、NTSC:512x492；水平清晰度：420TV LINE；扫描频率：PAL/NTSC: 50Hz/60Hz。由于CCD输出的是模拟信号，要经AD转换才能送给CPU进行处理，ADC芯片采用Philips的SAA7114，SAA7114有六路模拟输入，内置模拟源选择器可构成６×ＣＶＢＳ、２×Ｙ／Ｃ２×ＣＶＢＳ、１×Ｙ／Ｃ和４ ×ＣＶＢＳ；两路模拟预处理通道，内有抗混迭滤波器；ＣＶＢＳ或Ｙ／Ｃ通道含完全可编程静态增益控制或自动增益控制功能，对ＣＶＢＳ、Ｙ／Ｃ通道可进行自动钳位控制；能自动检测５０Ｈｚ／６０Ｈｚ场频，并可自动在ＰＡＬ和ＮＴＳＣ制式进行切换；能将ＰＡＬ、ＮＴＳＣ和ＳＥＣＡＭ信号解码及模数变换得到符合ＩＴＵ－６０１／ＩＴＵ－６５６的数字电视信号。该芯片是目前视频解码芯片中接收视频源的宽容性及视频解码图像质量最好的一种。其通过Ｉ２Ｃ接口，进行初始化设置。SAA7114的 A/D转换精度是9b，并行输出8b视频输出带为27 MHz。每一个时钟周期(1/27MHz)并行输出1个字节，除了输出数字象素外，SAA7114还输出时钟信号以同步。可以通过设置SAA7114的相关寄存器来控制SAA7114输出图像的尺寸。[3]同步FIFO采用TI公司的SN74ACT7881，大小为1024b×18，同步FIFO与SAA7114的接口速度为27MHz，宽度为8b。 FIFO与AT91RM9200的接口速度可以配置为27MHz，宽度为16b。当FIFO中快写满数据时，给AT91RM9200发出控制信号以使 AT91RM9200产生中断，取走FIFO中的数据。
图二  图像采集模块3.2图像处理模块AT91RM9200是图像处理模块的核心部件，主要完成系统初始化和后续的图像处理，系统采用ATMEL公司的 AT91RM9200。该芯片融合了ARM920T ARMThumb 处理器，工作于180 MHz时性能高达200 MIPS，存储器管理单元，16-K 字节的数据缓存，16-K字节的指令缓存， 支持SDRAM，静态存储器，Burst Flash，无缝连接的CompactFlash，SmartMedia及NAND Flash。存储控制器(MC) 管理ASB 总线并最多达4 个主机的访问控制。它通过一个总线判决器和一个地址译码器将4G字节的地址空间分区来访问内置的SRAM与ROM，内置外设及通过外部总线接口(EBI) 的外部存储器 。它还可通过一个异常中止状态与一个失调检波器来帮助应用程序调试。SAA7114的初始化接口采用AT91RM9200的两线接口（TWI），图1是AT91RM9200跟SAA7114的连接图。
图三  AT91RM9200与SAA7114的连接图 3.3 数据存储部分设计由于CCD摄取的图像数据很大，而系统的自带的存储器无法满足大量数据的存储要求，因此我们利用的RM9200自带的USB2.0主机端口来外接移动移动硬盘来存储图像数据。USB主机端口在主机应用中与USB连接。它处理开HCI协议(开主机控制器接口)及USB v2.0全速与低速协议。它还给ASB提供简单的读/ 写协议。USB 主机端口集成一个根集线器，并在下游端口集成收发器。它提供几个半双工高速串行通信端口，速率为12 Mbit/s。最多可连接127 个USB 器件( 打印机、照相机、鼠标、键盘、硬盘等)，而USB集线器可使用“ 分层星型”布局与USB 主机连接。USB主机端口控制器与开HCI规范完全兼容。3.4 网络传输部分设计图像数据由CCD摄像头采集后传回嵌入系统，系统数据保存在外带的移动硬盘中，而远程的客户端则通过Internet来访问和读取系统的图像信息。系统的以太网部分采用RM9200自带的的10/100自适应以太网接口。
图四  为以太网模块的硬件图图四为以太网模块的硬件图，当使用AT91RM9200的以太网接口，在片以太网卡进行数据的发送时，根据以太网协议IEEE802．3／l，完成网络逻辑层和物理层之间MAC的工作。运用DMA通道进行数据的发送，不影响AT91RM9200的Processor正常运行。[4]首先正确设置传送控制寄存器和传送地址寄存器的传送数据块字节数、数据块存储首地址等参数，随后依次从指定数据存储区地址取32b数据，送人内部发送缓冲器中，由MAC对数据进行封装发送，同时记录已传送字节数，直到数据块发送完毕。当发送完一组数据后，发出DMA中断请求，由AT91RM9200进行相应的处理。4   小结本文在充分用AT91RM9200本身的资源的基础上，实现一种小型网络视频服务器的硬件架构，不仅能轻而易举地避免了以往模拟监控系统需要专有布线网络的问题，轻松解决信号长距离传输问题,而且由于采用了嵌入式实时操作系统,大大提高了系统的抗干扰能力,有良好好的可扩展性和经济实用性.本文作者创新点：采用了嵌入式实时操作系统,大大提高了小型网络视频服务器的抗干扰能力,有良好好的可扩展性和经济实用。参考文献:[1] 徐力，孔岩 .  视频监控系统的现状和发展趋势, 信息技术与信息化,2005:60-61;[2] 孟万化，傅蓉心．基于Web视频监控系统的研究与应用[J]．微计算机信息，2005，28－45:111;[3] SAA7114说明手册[Z],2004;[4] AT91RM9200说明手册[Z],2002;