县级数据集中存储与异地备份解决方案
作者：沈向阳
市县信息化也逐渐关系和利用到了存储和异地备份的技术，看实例学习方案实施过程。
在信息化飞速发展的今天，无论是政府还是企业，对信息化的依赖性都越来越强，而现代的信息化基础架构建设是围绕着数据进行的，如何确保国土资源信息系统基础应用数据的安全性、业务的连续可靠性，已成考量信息系统建设最重要的技术参数之一。因此从应用层、数据层以及链路层多个方面考虑数据中心的设，并采用两台高性能服务器做热备，保证应用层不会宕机，使系统可以持续被访问和读写。数据层考虑到数据库的稳定性和对读写性能的要求，可采用两台小机做热备，以确保数据库的高可用性。从数据存储的稳定性和安全性考虑，还应将数据库中的数据集中存放在专业的磁盘阵列中，以确保数据存放的安全性未来还可以灵活的扩容并且能有效提高工作效率和减少管理成本。对小机和存储的连接，我们也应采用双链路标准，以保证链路层万无一失。为防止病毒侵入、误操作以及其他原因造成的数据丢失和损坏，我们还需要对自己的数据做备份，考虑到更高的安全级别，对和兄弟局之间互相做异地数据备份，在给数据增加一份更高的安全性的同时，还可以有效节约成本。下面从系统拓扑到每一层的实现逐个做出说明。
2. 解决方案
2.1拓扑图
(图一)
选用高稳定性小型机和扩展性小型机安装数据库程序，并安装小型机的热备软件，做到小型机的双机热备。
方案中作为主存储的中高端磁盘阵列柜，推荐采用端到端的全光纤结构的设备，具有FC光纤接口的同时，最好能再具备以太网接口，可以提供FC-SAN、IP-SAN甚至NAS等多种接入方式，并视自己的实际情况，灵活选择接入方式。
方案中采用的是冗余链路的架构，2台服务器做了热备后通过主干网和2台小型机连接在一起，而2台小型机通过光纤通道交换机连接至主存储，即FC SAN架构。每台服务器上配置双光纤通道卡，配合存储厂商自带的链路切换软件，实现链路的自动切换和负载均衡特性，不仅提高了可靠性，而且极大的提高了性能。
方案建议配置4Gb光纤磁盘，做RAID5后再预留一块做为热备盘使用。部分空间用来存储实时数据，部分空间用来存放备份数据。
对本地的数据进行备份，策略设置为每半小时做一次增量备份，每周做一次全备份，备份介质选择入门级的磁盘阵列，以避免磁带库的种种弊端。
考虑到更高级别的数据安全性，在本地做备份的同时，在兄弟局的磁盘阵列上划出部分空间来每周做一次全备份，采用专业的备份软件，将重要数据通过光纤网络备份至兄弟县的存储磁盘阵列中。
2.2方案的实现
本系统的连接方式由图一可以看出，我们将应用程序安装在高性能的服务器上面，然后服务器通过主干网络和小型机连接到一起，调用小型机里面数据库中的数据，小型机上面安装数据库程序，小型机通过光纤链路和存储服务器连接到一起，将实际产生的数据存放于存储设备中。
考虑到数据的安全性，将应用程序和数据库程序分离安装，应用服务器上只运行应用程序。若只用一台应用服务器，服务器宕机后虽然数据仍在，但会导致整个应用断掉，用户无法访问和读写，所以考虑用两台应用服务器互作热备，当有一台应用服务器宕机后，运行其上的应用程序会自动切换到另外一台服务器，保证业务能正常运行。应用服务器通过主干网和小型机连接在一起，链路可以采用原来的主干网或者采用以太网专用光纤链路进行连接。
考虑到数据的重要性，我们将系统所用的数据库安装于小型机上，小型机由于多层的硬件架构和专用的操作系统，可以保证运行的稳定性并能提供非常好的读写性能且不易被病毒所感染。应用层的热备虽然已经做到，但是万一数据库层面的小型机只有一个，若小型机宕机，也将无法提供数据读写，所以，我们在数据库层面也采用两个小型机互作热备。平时数据读写的时候，两台小型机中的数据读写同步，当有一台小型机宕机时，另一台仍然能正常支撑系统的运行。
应用服务器和数据库服务器都做到万无一失后，我们要考虑其数据和存储部分的连接。采用存储设备是因为存储设备的专业性使其可以提供较高的安全性和稳定性，所有的零件均为双份，做到冗余，保证设备不会因为单点故障而丢失数据，且所有的数据存储于存储中可以方便管理员进行管理和备份等操作。另外，存储阵列的硬盘是专业的存储专用硬盘，质量非一般服务器硬盘可以比拟，存储中的硬盘一般还会采用RAID的方式进行容错控制，当有一块盘换掉时，数据还可以自动计算出来。最后存储阵列的硬盘可以灵活扩容，方便未来数据增长后可以扩容。
不过，小型机通过光纤交换机和存储连接在一起，万一光纤线断掉或者光纤交换机坏掉，一样会影响整个系统数据的读写，鉴于此，我们引入了双链路的机制：
每台小型机配置两块4GB HBA(光纤通道卡)卡，另外配置两台8口的光纤交换机，此交换机为24口，初始激活8口，未来可以根据需要增加模块就可以升级为16口或者24口，且交换机为冗余设计比较稳定和安全。每台小型机分别接到两台光纤交换机上，两台光纤交换机分别接出两根光纤线，分别连接至存储的两个控制机头上，完全实现链路层的冗余，杜绝单点故障，在存储本身带有的专用链路切换软件的配合下，当出现线路断线或者交换机出现故障的情况，系统会自动将出现故障链路上运行的数据切换到健康的链路上，在没有问题的时候，双链路还可以起到负载均衡的作用。
2.3本地备份和异地备份的实现
通过采用种种技术手段，数据被保存在我们的存储阵列中，数据的安全性和稳定性都得到了保证，但是仍然不能避免数据出现人为操作的失误和自然灾害而损坏，诸如发生火灾、水灾等，使数据损坏和丢失。遇到这种情况的时候，如原始数据遭到人为的误删除，就需要去恢复成原始的数据，需要我们去做备份，做备份的目的就是为了能恢复数据。备份不同于做镜像，并不随着原始数据实时做改变，而是按照用户实际设置的策略按照时间点的方式，将原始数据读出做压缩后以特殊的加密格式保存在磁盘中，这样，当原始数据操作有误或者丢失时可以快速的做出反应，恢复出指定时间点的原始数据。
考虑安全性和带宽的稳定性等方面，提出在本地每半个小时做一次增量备份，另外兄弟县之间互作备份，每周将数据通过备份软件压缩后，再通过我们的专网，备份到对方的磁盘阵列中做一次全备份。
(图二)
本局两台小型机安装好备份软件客户端后，和本地的备份服务器以及兄弟局的备份服务器均做绑定，按照本地备份服务器的备份策略，客户端每半个小时将存储中的增量数据压缩后存储到本地新购入的入门级存储阵列中，不会占用到兄弟局之间的带宽，保证数据能得到及时、安全、高效的保存。
另外，考虑到安全性和经济性，我们采用异地备份的方式，将数据加密后备份到兄弟局的存储设备中，这样既有本地的快速备份和恢复，又有异地的高安全级别的备份，从多个方面实现了数据的集中存储管理以及各个级别的安全保护。
3.结论及展望
2005年以来，我局和兄弟县局使用这套方案实现异地备份，带来的效益十分明显!首先，解决了数据存放安全性的问题，将所有的数据从安全级别一般的服务器中迁移到具有5个9注的稳定性的专业存储设备中，降低了数据丢失的风险。利用数据集中存储还解决了资源共享问题，让空间的扩充和分配可以非常方便的实施。数据集中存储还释放了管理资源，让我们有更多的时间去解决应用层和网络层的问题。本地备份解决了系统误操作或者是病毒侵袭等原因造成的数据丢失，使数据得以快速的恢复。另外，考虑到更高级别的安全性，将数据备份一份到异地，避免了人为的或自然灾害造成的数据丢失。我们正在考虑在此基础上，建立归档和异地灾备以及服务器虚拟等解决方案，来构架一个更加安全和高效的国土资源信息应用系统，为我们的县区一级“金土工程”保驾护航。
注：所谓的几个9的稳定性是美国IDC专业统计公司统计得出的结论，5个9表示设备不间断运行一年可能出现的宕机时间不会超过5分钟，4个9表示设备不间断运行一年可能出现的宕机时间是以小时计算的。