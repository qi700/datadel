数据中心存储与容灾的技术架构设计
本文介绍了基于SAN+centera的数据中心存储与容灾的技术架构。分析了适应医院规模增长新建数据中心及容灾中心的需求。提出了一种适应医院长期发展的数据中心存储与容灾技术架构。    第四军医大学唐都医院是一所集医疗、教学、科研、预防、保健和康复为一体的大型现代化三级甲等医院。现开设床位1200张，年门急诊量达71万人次，年收容量近7万人次。目前总面积14万平方米的3栋病房大楼即将投入使用，医院的床位将扩展到3000余张。现有的数据中心建于2005年，机房面积仅有40平方米，无法满足将来系统升级扩容的需要，新建数据中心迫在眉睫。新数据中心机房面积为125平方米，距数据中心200余米。考虑到医院信息系统的可靠性和长远发展，拟将原数据中心建设为容灾备份中心。1 基于SAN+Centera的技术架构    唐都医院于2009年实施了PACS。随着医院业务的增长，其存储系统建设面临全新需求，主要包括PACS、RIS、HIS等核心应用系统数据的整合，提供可靠的一级在线数据管理。同时能够保存短期内需要缓存的PACS图像文件，并实现快速查询能力，以响应前端业务需要。此外，还要求容灾中心与数据中心的核心做异步复制，使医院信息中心具有灾难恢复能力，保护信息的完整与安全。    为解决上述两大需求，采用短期／长期分类，动态／静态结合的统一存储解决方案，即SAN存储系统结合EMC Centera归档系统，作为数据中心的全新存储模式(见图1)。  图1 一样容灾SAN与Centera归档组成的架构平台    在该架构中，部署了EMC CLARiiON C×4—480存储平台，实现一级在线数据存储，不仅能够提供高性能的在线文件访问，而且能保存短期内需要缓存的PACS图像文件。同时，在容灾中心部署了EMC CLA Rii0N C×4—1 20SAN存储平台，与数据中心的核心存储进行异步复制，使医院信息中心具有灾难恢复能力。    为了实现PACS系统的长期静态影像数据的高效存储和检索，采用EMC公司Centera数据归档系统作为二级静态数据归档系统，节省了一级存储的宝贵资源，远程数据容灾系统与Centera归档完全融合。Cente ra采用冗余设计，无单点故障，具有内容镜像、内容再生和地域复制功能，可确保系统出现故障时，始终都会有一份受到保护的内容拷贝，保证了数据的完整性。此外，采用EMC Networker集中数据备份管理平台，实现PACS系统影像数据、数据库数据、以及Centera归档影像数据的集中离线数据备份，保障了数据的安全可靠。    SAN+Centera的技术架构，不仅保障了医院核心系统数据的安全可靠，还将影像的浏览时间由原先的分钟级别提升到秒级，减少了系统访问的响应时间。2 基于EMC RecoverPoint的技术架构    受实际条件的限制，现有数据中心及容灾中心同处一间机房，不是真正意义上的异地容灾，且数据备份采用异步数据复制技术，RPO指标为分钟级，一旦生产系统在高峰时间发生故障，将会丢失相当数据，这对于医院和病人都是不能接受的。因此将新建数据中心，一是实现真正的异地容灾，二是优化原有备份恢复策略，较大改善RPO和RTO目标。新数据中心和容灾中心的架构将采用基于持续数据保护技术的一主一备数据中心架构(见图2)。  图2 采用EMC RecoverPoint技术的容灾方案拓扑结构
该架构使用了EMC RecoverPoint的持续数据保护功能，能同时实现块级数据和NAS文件系统的远程复制。可以确保当单个系统出现故障时，最大限度减少数据的丢失量(包括零丢失)，最快速度的恢复关键应用系统，提高数字化信息系统的整体服务级别。    由于主数据中心距离容灾数据中心不足300米，因此可采用单模光纤直连的方式连接两数据中心的SAN网络。主数据中心的主存储系统通过SAN持续将数据复制到容灾数据中心的容灾系统上，复制方式有同步或异步两种方式方式。当主数据中心的数据出现错误时，可以通过容灾存储上的容灾数据进行快速回滚，能够实现数据库等系统进行任意时间点的恢复：当容灾存储出现故障时，可以通过重新进行数据同步，实现两个数据中心的数据一致。从而确保医院数据的安全可靠存储。    在远端数据中心构建医院的核心数据库应用系统服务器，当生产站点发生大的自然灾难时，可以通过容灾中心的服务器访问备份存储上的数据，实现容灾的快速切换。当生产中心站点恢复后，可以通过数据反向复制将修改数据增量同步回生产中心，然后实现容灾恢复。    对于HIS、LIS、EMR、RIS、医保等医院核心业务系统数据库数据，其数据读写频率高，数据实时性及连续性业务要求高。对于这部分数据，采用实时同步方式进行持续数据保护，同时保留较长的日志时间。利用EMC RecoverPoint的日志前滚与回滚功能，实现长时间的数据恢复，消除逻辑操作错误带来的数据损失。    针对PACS系统的影像文件，由于数据量巨大，且每日数据增量大，不能使用传统的备份模式进行数据保护。因此，针对在线数据采用基于NAS的远程数据复制技术进行数据的在线保护，历史数据则通过数据归档解决方案进行数据保护。在信息中心机房或者远程容灾部署2套EMC统一存储设备，利用EMC的数据镜像软件Replicator，通过IP链路，将PACS系统的在线影像数据进行远程复制保护，当其中任何一台存储设备发生故障时，保证数据丢失量最少。同时，在链路正常的情况下，可以快速将应用系统切换至容灾存储，最大限度地降低由于存储系统故障造成的系统停机所带来的影响。    综上所述，该架构能够保护医院数据在通常如服务器失效、数据损坏、软件出错、病毒和终端用户差错等情形下不受损失。同时，利用持续数据保护技术，还使系统可以抵御突发灾难事件，使整个数据中心免于停顿，优于原先架构。3 讨论    数据中心的建设是一项十分复杂的工程，仅仅是将系统从一个机房迁移到另一个机房，就可能遭遇系统宕机、硬件损坏等不可预测的情况。因此，建设新的数据中心，改变原有系统架构必须十分审慎，必须经过充分论证和实际验证方可实施。不宜过度追求技术上的先进性，而导致系统过于复杂而无法顺利过渡。总之，数据中心的建设要根据医院的实际情况，立足现在，着眼未来。