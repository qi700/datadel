磁盘阵列的数据安全与数据修复分析
由于RAID5磁盘阵列具有很多优越的安全性能，因此得到了广泛的应用。但在实际工作过中，RAID5阵列还是会产生故障。本研究在分析RAID5磁盘阵列基础数据结构的基础上，具体分析了RAID5系统产生故障的原因，并就每个原因提出了有针对性的预防措施，最后作者介绍了磁盘阵列数据修复的实用方法。    由于磁盘阵列具有容量大、数据存取速度快、安全性高等特点，磁盘阵列技术得到了广泛的运用。尤其是采用RAID5技术的磁盘阵列，由于其采用了奇偶校验技术提供数据冗余信息，大幅提高了系统和数据的安全性，成为了人们首选的磁盘阵列技术。虽然RAID5模式的安全级别较高，但在实际运用中磁盘阵列上的数据还是会发生的损坏和丢失的情况。究其原因，这些隐患主要来自于RAID5系统运行和维护过程。为了使广大系统维护人员能加深对RAID5磁盘阵列的安全隐患的认识，本文在分析了RAID5磁盘阵列的数据结构的基础上，提出了做好磁盘阵列数据安全管理的意见和建议。
1、RAID5磁盘阵列的数据结构
RAID5的数据安全性较其他RAID系列的磁盘阵列要高很多，当阵列中的一块物理磁盘出现障时，允许在不停机的情况下对磁盘进行热插拔更换，保证应用系统的持续运行。RAID5的高安全可靠性主要来自两个技术要点，即冗余数据应用和奇偶校验算法。
冗余数据的生成有多种算法，RAID5采用的是奇偶校验算法。下面以4个磁盘组成的RAID5为例来说明利用奇偶校验算法生成冗余数据原理和过程，并介绍RAID5数据安全可靠性的原因。
如图1所示，假设在这个由四块磁盘做成的一个逻辑磁盘上12个连续存放的数据块，这些数据块以0，1，00 ，11命名。
图1 组成RAID5的4个磁盘上的12个数据块的排列
图中每块磁盘由上往分为4层，每层包括3个数据块及一个它们的数据奇偶校验块。数据奇偶校验块中的每个字节是同层中的3个数据块块中相同位置的3个字节的奇偶校验值。例如，这3个数据块其中相同位置的一个字节的分别为010001 10，01101110，01000110，那么校验数据块中的相应字节的值就为1 1010111。
通过运算我们可以发现，这四个数中任意3个的奇偶校验运算值等于第四个数，因此，当这4个数中的任意一个被破坏了，还可以利用求出其他3个数的奇偶校验运算值来恢复。同理，同一数据层的4个数据块之间、组成RAID5的4个物理硬盘之间都存在这种数值关系，当其中任意一个硬盘损坏后，都能通过对其他3个硬盘上的数据进行奇偶校验运算进行数据恢复。以上就是RAID5的常的数据结构基础，当组成RAID5的4块硬盘中有2块以上出现故障，则无法通过奇偶校验运算进行数据恢复。
2、RAID5系统产生故障的主要原因及预防措施
RAID5系统在运行和维护中存在着数据安全的隐患。我们首先要分析产生这些隐患的原因，再根据每项影响因素采取有针对性的预防和补救保护措施，具体分析如下：
2.1 组成RAID5的磁盘有具有相近的使用寿命
RAID5能够确保在任意一块物理磁盘故障的情况系统和数据的安全，但在实际工作中，组成RAID5的可能是一批型号、批次、使用期限、性能相同的磁盘，当其中一块出现故障，其他几块也可能接近使用寿命，因此在第一块磁盘故障后，在短时间内可能会有第二块，甚至第三块、第四块磁盘发生故障，在这种情况下，可能系统维护人员还没来的及处理好第一块磁盘带来的故障，整个RAID5阵列的数据就已经无法读取了。
预防措施之一是制定严格的管理制度，设立专人定时值班，对重要数据实施定期备份；二是做好两块以上磁盘同时产生故障时的数据恢复预案，这样一旦故障来临，也能有序从容地应对。
2.2 在维护时弄乱磁盘阵列中的磁盘顺序
构建RAID5时起码要3块以上的磁盘，有的甚至有几十块。
RAID5的中数据块和数据奇偶校验块是按系统设定的顺序存储的，且前后位置是固定不变的，因此磁盘顺序不能搞错。一旦磁盘顺序搞错，系统还会按原来的顺序读取磁盘上的数据，但由于更换后的磁盘上的数据已不是准确的数据，从而导致数据丢失。
系统维护人员在对阵列中的磁盘进行管理和维护时常会发生以上事故：当对磁盘进行卫生清理，将多个磁盘拔下，重新装回时可能会搞乱顺序；为了保护磁盘，在搬动磁盘阵列时拔下磁盘，再装回时也有可能搞混磁盘的顺序；在对磁盘阵列扩容而增加硬盘时，也容易弄乱磁盘顺序。
为了预防这些情况的发生，可以采取以下预防措施：首先是采用简单的方法，在型号或外观相似的磁盘上贴上标签，这样就能降低发生低级错误的概率；其次是一旦磁盘顺序被弄乱了，不能抱着侥幸的心理开机试试，最稳妥的办法是找专业的数据恢复人员或厂家的工程师来找出正确的磁盘顺序。
2.3 磁盘的意外掉电脱机
磁盘阵列中的磁盘可能插在同一条SCSI数据线上，也可能插在同一块接口背板上。为了保持系统不停机、不中断，在更换故障盘时一般采用热插拔。在这个过程中，常会引发其他磁盘掉电，造成整个磁盘阵列系统的瘫痪。虽然SCSI接口有线路有保护设计，支持磁盘热插拔，但在不断电的情况下，相邻的磁盘极有可能受磁盘插拔引起电流电压变化的干扰，也有可能因磁盘插拔轻微震导致周围的磁盘瞬间掉电，这两种情况都会引起磁盘意外脱机，RAID5系统在磁盘脱机时会产生错误操作，导致系统和磁盘上数据的永久性损坏。
为防止意外掉电情况的发生，在对第一块故障盘进行更换前，对RAID5阵列上的数据进行一次完全备份，然后再实施带电的磁盘更换操作，这样就能避免数据被损坏。
2.4 缺乏系统故障处理预案
在磁盘阵列的安装、设置、调试完成后，就开始安装应用系统和加载业务数据。为了保证系统和数据的稳定和安全，应该杜绝所有与应用系统无关的操作。由于这个过程过于紧凑，用户单位的技术人员缺少熟悉和实际操作磁盘阵列的机会和实践，在这种情况下，一旦出现故障，就不能及时采取正确的应对措施。
为防止这种情况的出现，在投入磁盘阵列应用前，需要给用户单位的技术人员充足的时间，给他们实际演练各类故障的处理，并让他们进行实际操作演练。还要做好故障处理预案，有备无患，等故障发生时能从容应对。
2.5 充分考虑厂商的售后技术服务能力
主要应从以下几个方面来考虑厂商的售后技术服务能力：
一是当磁盘和磁盘阵列已经过保或损害超出售后技术服务范围时，厂商能够提供的数据修复的应急方案，或能够提供的技术保障保证。二是由于厂商的技术服务人员流动性很大，除了初始安装调试的技术人员，其他厂商派来的技术人员有可能不熟悉系统的具体设置，因此要注意厂商对技术服务人员的管理是否规范，分析厂商技术人员对故障的处理方法能否恢复。
3、磁盘阵列的数据修复
当实施磁盘阵列的数据修复时，也是数据安全到了最危急的关头。一旦需要对RAID5阵列上的数据进行修复，那么可以肯定的是：阵列中有两块以上的磁盘发生了物理故障，磁盘上的数据已无法正常读取。磁盘阵列数据修复与单个磁盘的数据修复方法相似，唯一的区别是前者多了一项带奇偶校验运算的数据合并工作，这项工作结果的好坏是磁盘阵列数据修复的关键。另外如磁盘的硬件修理、数据合并后的逻辑驱动器上数据恢复等都和单磁盘的数据修复相同。
下面举例来说明磁盘阵列数据修复的过程：
假定阵列中出现了A和B两块故障磁盘(如图1)，其中A先产生故障，随后RAID5运行，直NB也产生故障在停止运行。此后，这两块故障盘的修复结果可能会有4种可能组合，每一种组合都会给RAID5数据修复带来不同的结果。这四种组合是：
①A和B都修复失败；②A修复成功B失败；③A失败B修复成功；④A、B都数修复成功。回顾RAID5的数据结构基础，我们可以分析出：第①种情况会带来最糟糕的数据合并结果，阵列中的数据基本难于修；第③种组合先数据修复结果最好，成功率很高。而第④种组合与第③种组合在实质上是相同的，修复效果也很好。第②种组合的修复结果略逊于组合② ，但好于组合①。
磁盘阵列具有较高的数据安全保障，但也存在着安全隐患，这种隐患来自多个方面，可能来自应用系的统管理，也可能来自对磁盘阵列的实际操作，也有可能来自故障处理或数据修复的操作过程中。磁盘阵列管理的实践经验表明，当阵列中两块以上的磁盘故产生故障时，最稳妥的解决方案是断电停止RAID5系统的运行。然后直接找专业的数据修复公司或磁盘阵列你的设备供应厂商，利用他们的技术力量来实施数据修复。事后补救虽然是尽可能挽救数据的一种方法，但不是治本之策，只有在大型应用系统实施前，做好数据和系统的安全保护预案，才能有备无患，高效、及时地应对可能发生的系统安全问题，其中也包括数据den存贮载体——磁盘阵列的安全问题。