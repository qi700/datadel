本地备份和异地容灾系统建设研究
阐述了一个本地备份和异地容灾系统的建设方案。通过本方案的实施,为目前学校的核心应用数据提供了在线实时备份,也为部分其它应用系统提供了数据备份服务;实现了校本部中心数据库、办公等重要数据到容灾中心的同步镜像,并为这些应用中的重要模块建立异地应用备份,当本地应用发生致命错误或不可预料的灾难时,通过容灾中心对应用的接管,保护核心应用系统的连续运行。    虽然新建设的集中网络存储平台在数据存储和管理方面取得了较大进步，但是学校在数据备份和容灾方面的建设还基本处于空白状态。第一，集中存储系统的数据保护仅有快照、克隆方式，只能进行逻辑性的数据保护。其中，中心数据库和邮件系统尽管实施了应用和数据库的热备，但其数据备份仍与其他应用系统一样，还都是采用传统的手工、离线备份方式，备份数据占用系统生产存储空间或转储到普通光盘。随着应用系统和数据量的迅速增长，这种简单、落后的数据备份方式，无论对于集中还是分散存储的数据都很难满足需要。备份数据与生产数据同处一个设备，可靠性差，资源浪费严重。没有专门的备份/恢复软件支持，备份数据的可用性和实际效率都很低。第二，学校的核心应用和关键数据没有任何容灾保护措施，一旦现有运行环境发生意外，重要数据的安全性和核心应用的连续性都很难保证，学校长期积累的信息资源会受到很大威胁。因此数据备份和容灾系统的建设已成为学校信息化建设过程中巫待解决的问题。本地数据备份和异地容灾系统，就是要为学校的核心数据提供较为完善的数据备份和恢复机制，保护学校核心数据的安全，提高数据资源的可用性。1 系统方案  图1本地备份与异地容灾系统拓扑图    方案在注重简单、经济和可靠性的同时，力求构建一个技术先进、性能较高的备份及容灾系统，为学校的重要应用和数据资源提供高效和安全的备份及故障恢复平台，提高校内应用系统的抗灾能力。系统方案充分利用了学校现有风络资源和设备能力，包括校本部与红庙校区互联的专用光纤线路及现有的存储系统。方案的主要内容就是构建基于虚拟带库技术的本地备份和基于存储数据复制技术的异地容灾。系统方案拓扑图如图1所示。2 本地备份    采用性能先进的软硬件技术在校本部中心机房搭建整体数据备份系统，为目前集中存储系统保存的学校核心应用数据提供真正意义的在线实时备份，同时也为部分分散存储的    应用系统提供数据备份服务，全面提升数据保护级别和数据备份/恢复能力。在应用系统发生故障时，可以快速、便捷地从本地备份进行数据恢复。    在校本部数据中心建设本地备份系统，采用备份软件加虚拟磁带库的方式构建集中备份系统平台。对于目前FC-SAN整合的关键业务数据，备份、恢复都通过SAN网络的LAN-FREE备份模式;对于分散在单个服务器上的数据采用LAN一BASE备份模式，尽量减少备份占用LAN网络的带宽。    （1）备份介质。    本方案选择具有可扩展性的在线处理方式的虚拟磁带库作为本地备份存储设备。虚拟带库用基于RAID保护的磁盘阵列代替无容错能力的磁带，结合了高速磁盘和磁带数据安全性;虚拟化的“机械手”和“磁带驱动器”，提高了备份的可靠性;也为最终要做磁带备份和归档的数据，提供了更可靠保障。是各方面能力较为均衡合理、性价比较高的选择。虚拟带库支持的重复数据删除技术，减少了冗余数据的存储，相同容量可以备份更多的数据，备份方式也能更多地采用完全备份，数据完整性和数据恢复能力也更强。    （2）备份软件。    配置一套备份软件，包含备份软件主模块、客户端、数据库代理、备份到虚拟带库支持等模块，实现对应用服务器的文件和数据库数据的自动备份和恢复功能。支持绝大多数常用开放平台和数据库;支持直接的跨平台浏览和恢复，能够通过图形界面在不同的备份平台(Windows, Linux和UNIX)上浏览文件索引，并直接恢复到统一的备份软件平台。为备份系统的各种局部性恢复需求提供操作简单、恢复快速的手工恢复能力。业务数据库需要恢复时能视损坏情况不同，按数据库/表空间/数据文件分别进行恢复;文件系统恢复利用软件浏览、启动恢复功能，自动加载存储媒体恢复指定文件。非数据库文件恢复可原路径或重定向路径、跨节点和跨平台。    (3)备份数据与策略分析。    根据应用系统的实际需求和备份经验，并从便于管理和恢复角度考虑，制定数据分组和存储介质池的对应策略，将数据分门别类放在不同的虚拟磁带组上，并设置不同的存取权限。建立数据库介质专门放置数据库信息;文件介质存放除数据库以外的文件;系统日志介质存放备份系统本身及配置等的备份，以快速恢复系统。根据备份数据的类型，设定不同的策略原则。数据备份策略设置与特定应用密切相关，在系统实施前需要进行更深入、详细的分析。3 异地容灾    综合考虑两个校区之间的光纤资源、校本部存储系统和红庙技区适合灾备的机房等现有条件；结合学校应用系统平台较为复杂等因素，确定异地容灾采用基于校本部和红庙校区两个磁盘存储系统之间镜像的数据保护方式。    (1)远程容灾链路。校本部与红庙校区可利用的链路资源为千兆裸光纤，距离小于30公里，可以满足远程同步复制对链路带宽、延迟和距离的要求。    (2)软硬件支持。本方案需要在红庙校区新建一个灾备磁盘存储系统，使用基于存储平台的远程复制软件，将主存储系统需要容灾的数据以同步或异步镜像的方式写入主、备两个存储阵列。灾备中心存储系统选择与主存储系统结构一致的FC-SAN结构，性能可以低于主存储系统，在作为灾备存储的同时也为该校区的其他应用提供集中存储服务。    (3)需要容灾备份的关键数据。根据应用系统数据对安全性和业务连续性的要求，将集中存储的数据中心、身份认证、办公以及计费系统数据定义为高安全级别，进行实时同步的远程数据传输;将邮件等的数据传输优先级别设置相对低一些，确保在同一时间优先发送这些关键的应用数据。    (4)核心应用异地备份。数据中心、身份认证系统、办公系统等作为学校信息系统中最重要和最基础的应用，一旦发生灾难应保证数据零丢失，系统一般应在半天之内恢复。为达到这一目标，除了上述同步复制的数据容灾措施外，还要在灾备中心建立关键应用系统的备份和相应的更新维护手段，以便在主系统崩溃时能迅速利用容灾数据实现应用的接管，保持应用的连续性。    (5)远程复制软件。远程复制软件应满足如下的性能要求:不依赖于服务器操作系统、应用程序、文件系统等，并可在LUN级别工作;内置保护机制可以在链路故障后以增量方式进行重新同步;保证数据实时复制的可靠性，复制数据严格按照源数据的写入顺序进行复制，与源数据严格保持一致;具有数据的回滚性，特别是对于数据库，在最新复制的数据不可用的情况下，远程复制软件支持数据回滚性，才能使数据的丢失量最小化;具有很好的故障自恢复功能，在网络故障、主机故障、应用系统等故障恢复正常后，灾备系统也自动恢复运行，保持数据的实时复制;系统日志和报警机制完善，软件自身故障也有便利的方式直接恢复，不需要重新配置。4 结语    通过本方案的实施，为目前集中存储系统保存的学校核心应用数据提供了真正意义的在线实时备份，同时也为部分分散存储的应用系统提供了数据备份服务，全面提升了数据保护级别和数据备份/恢复能力;实现了校本部中心数据库、办公等数据到容灾中心的同步镜像，并为这些应用系统中的重要模块建立了异地应用备份，当本地应用发生致命错误或不可预料的灾难时，通过容灾中心对应用的接管，保护了核心应用系统的连续运行。