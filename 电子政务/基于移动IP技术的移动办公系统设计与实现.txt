基于移动IP技术的移动办公系统设计与实现
为了解决移动用户随时随地远程接入和移动办公问题，解决传统TCP/IP协议不支持IP设备移动性问题，以及 解决与数据通信的安全问题等，采用了使用移动终端自代理和基于兵符智能密码钥匙的安全机制技术，设计实现了基于移动IP技术的移动办公系统，系统实现了移动终端的跨不同网段漫游、远程接入、移动办公以及企业分支机构互联等多种功能。    移动IP技术(Mobile IP)是移动节点(计算机/服务器/网段等)以固定的网络IP地址，实现跨越不同网段的漫游功能，并保证了基于网络IP的网络权限在漫游过程中不发生任何改变口。目前移动IP技术主要应用在无线领域，在有线领域几乎没有应用，本移动办公系统主要把移动IP技术应用在有线网络中，让企业在有线网络中应用移动IP技术，实现TCP/IP协议不支持IP设备的移动性，实现移动终端的跨不同网段漫游、远程接人、移动办公以及企业分支机构互联等多种网络应用。　　1.系统功能描述　　从系统的角度来看，移动办公系统应有以下几部分功能：　　1.1 移动办公系统的家乡代理　　移动办公系统的家乡代理有为每个移动终端提供注册、鉴权、通信、管理等的功能，负责在移动终端移动到外地网络后，能解析移动终端发送给家乡网络的数据包，同时将转发通信对端的数据包给该移动终端，并且负责通信数据加密和解密的功能。　　1.2 移动办公系统的移动终端　　移动办公系统的移动终端是真正实现移动办公的终端设备，移动用户可以将其接入Internet的任意位置，在从一条链路切换到另一条链路上时，仍然可以进行移动和漫游，并且只使用其家乡地址(IP始终保持不变)的终端，它是移动用户使用移动办公系统的窗口。同时，为了简化网络部署和在有限网络使用的特殊性，取消外地代理设备，需要移动终端实现自己代理功能。　　1.3 移动办公系统的管理　　移动办公系统的管理主要完成对移动办公系统的家乡代理的配置和管理功能；对移动用户的密钥分发、授权等管理；对移动办公系统的操作员进行管理，以及完成对移动办公系统管理等功能。　　通过对移动办公系统模型的分析，可以得出移动办公系统的系统总体功能分为系统管理模块、家乡代理模块和移动终端模块其模块和功能如图1所示。图1 系统功能模块图　　2.移动办公系统设计　　本系统的技术构架与移动IP体系、VPN技术是不同的，主要包括注册认证管理、隧道、安全密钥管理、多网段管理、移动终端自代理、加密解密等关键技术。因篇幅限制，下面仅给出移动办公系统的体系结构。　　根据移动办公系统的系统模型分析，系统总体功能分为系统管理模块、家乡代理模块和移动终端模块，在设计时对移动办公系统按照功能实体划分，其主要的功能实体有：MyNet服务器、移动终端、兵符、兵符软件和控制台软件，其系统结构如图2所示。图2 移动办公系统的系统结构　　其各个实体定义如下：　　(1)MyNet服务器：是与移动终端家乡链路相连的核心网络设备，为每个移动终端提供注册、鉴权、通信、管理等功能，是MyNet移动办公系统的核心组成部分，是移动办公系统的核心设备，即主要完成家乡代理模块。移动客户端与MyNet服务器之间的通信采用IP安全协议IPSec进行传输，移动办公系统系统以IPSec协议为基础，对RFC2406(IP Encapsulating Security Payload即ESP)和RFC2402(IP Authentica—tion Header即AH)加以改进，用IP封装安全净荷(ESP)来实现数据的加密以确保通信的机密性，用IP认证头(AH)对数据进行认证以确保数据的完整性，从而实现了隧道中数据的安全传输。移动客户端与My-Net服务器之间的动态密钥更新服务采用因特网密钥交换协议IKE(Internet Key Exchange)，有力的保证密钥安全。　　(2)兵符：主要存储用户认证信息和移动办公的相关信息等的智能安全硬件产品，采用高强度加密算法，要有效地保证用户的接入安全，即主要保存移动终端所需的参数，移动终端从兵符读取所需的参数。主要包括用户认证信息、MyNet服务器地址、移动终端的家乡地址，兵符是采用USB接口。　　(3)兵符软件：主要实现智能安全客户端软件，是移动用户使用移动办公系统的窗口。兵符软件通过兵符获得用户认证信息和移动办公的相关信息，接人MyNet服务器进行鉴权，然后通过高强度加密信道与家乡网络进行通信，即主要完成移动终端功能模块。　　(4)控制台软件：主要完成兵符的分发、授权以及MyNet服务器的系统管理等功能，即主要完成系统管理模块。　　3.移动办公系统实现　　3.1 移动办公系统的开发平台　　移动IP协议是TCP/IP协议族的增强型，因此移动办公系统的实现也应基于现有的TCP/IP协议。移动办公系统主要使用了TCP/IP协议栈，因此可以运行在TCP/IP网络上。TCP/IP协议集起源于UNIX，到目前为止，在所有的TCP/IP编程接口中，UNIX的Socket还是功能最强的。本文选用Linux作为MyNet服务器软件开发平台，对于兵符软件和控制台采用Windows平台。　　3.2 MyNet服务器的实现　　采用高强度工业控制机为平台，操作系统为裁减的Linux精简核心，以基于移动IP技术的移动办公系统设计方案为指导，实现高安全、高稳定、高速度、易管理。MyNet服务器开发基于Linux操作系统，采用C语言实现。C语言是一种结构化语言，它层次清晰，便于按模块化方式组织程序，易于调试和维护。C语言的编程能力和处理能力极强。MyNet服务器的主要完成对TCP/IP报文的接收和发送，其数据处理流程如图3所示。图3 移动办公的数据流图　　3.3 兵符的实现　　兵符只有经过移动办公系统的管理员分发、授权后才可以使用。兵符必须与兵符软件一起使用，否则兵符是不能使用的。兵符的授权信息是经过MyNet服务器运算，生成综合兵符硬件信息、用户身份信息、MyNet硬件信息、移动用户登录口令、随机信息等5类信息的信息摘要，除登录口令外，管理员或移动用户不可干预，保证了认证信息的机密性。为了实现移动终端的IP地址始终保持不变，需要移动终端获得一个固定的家乡IP地址，该家乡地址由移动办公系统的管理员授权给移动终端的，被保存在兵符中。移动终端需要向My—Net服务器注册，需要在兵符中写入MyNet服务器的IP地址。为了确保兵符中的数据安全，对写入的信息采用3DES加密算法进行加密，加密后写入兵符。为了确保系统的安全和可靠，兵符软件必须与兵符一起使用，否则兵符是不能被使用的。兵符用户可以设置用户密码，第一次使用时，会提示用户设置密码，密码可以为空(不推荐)。使用将其插到计算机的usB口上，只有把兵符插好后，才可以能正常启动兵符软件。当用户对兵符设置了密码后，重新启动兵符软件时，会提示用户输人密码，密码最多可以重复输入10次，10次不能正确输入密码，则兵符自动锁定。兵符锁定后，用户只能寻求系统管理去处理。系统管理对锁定的兵符进行重新分发和授权，用户就可以使用了。　　3.4 控制台软件的实现　　控制台软件运行在win2000，winxP及以上版本windows操作系统上。控制台软件采用visual c“开发，基于MFC开发架构。控制台软件的功能模块结构如图4所示。
图4 控制台的功能模块结构　　控制台的数据处理流程如图5所示，具体描述如下：图5 控制台数据流程图　　(1)设置MyNet服务器的IP地址；　　(2)系统管理输入用户和密码进行登录；　　(3)如果移动办公系统未配置，需要对系统参数进行配置，包括MyNet服务器的IP地址、家乡网络，以及需要支持的其他网段等信息；　　(4)需要配置移动用户的IP地址(移动终端的家乡网络地址)和移动用户的姓名；　　(5)配置信息配置完成后，管理员可以对兵符进行授权，把所有配置进行3DES加密后，写入兵符；　　(6)管理员可以对移动用户取消授权；　　(7)管理员可以对兵符进行重新授权或格式化清空授权信息；　　(8)管理员可以对在线移动用户进行统计和管理；　　(9)管理员可以对移动用户进行单个添加或批量添加，单个删除或批量删除，以及对移动用户进行查询等；　　(10)管理员可以添加管理员用户，也可以更改密码；　　(11)如果系统已经配置完成，则管理员可以进行修改配置或对移动用户进行增加、删除、查询、授权等维护或管理。　　4.结语　　基于移动IP技术的移动办公系统，为行业用户和企业用户提供了一种安全、易管理的组网解决方案，具有鲜明的优势和特点，使用本移动办公系统，无论在家里还是出差均可以随时随地，不受时间、空间、接入媒体限制，通过网络实现远程接入、移动办公，移动终端在移动过程中可以随时随地了解单位的情况；始终保持原局域网授权的IP地址固定不变，用它与其他终端通信。目前的系统只能支持IPv4网络，不支持IPv6网络，需要考虑从移动IPv4到移动IPv6的过渡策略。