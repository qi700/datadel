私有桌面云的应用与挑战
随着云计算技术的不断完善和推广使用，桌面云作为云计算的一种应用形态越来越受到关注。文章从桌面云的基本原理入手，通过对企业应用环境实地考察分析，设计出基于桌面云技术、适合企业实际情况的私有桌面云平台，为企业在数据安全、灵活接入管理、系统稳定性及运营成本等方面带来明显改进。　　伴随企业办公环境无纸化、数字化，IT管理部门已经成为现代化企业必不可少的部门。企业在IT管理方面投入的成本不断增加，同时面临一些传统IT构架下难以解决的问题。　　大型企业每年会招聘大量新员工，这需要购买相应数量的诸如台式机或笔记本硬件为他们提供良好的工作环境。研究表明，一个企业的IT硬件和软件更新周期通常为3~5年，这意味着大部分硬件是在可以使用的情况下，由于性能不能满足新的办公需要而被强行淘汰的。这直接导致企业硬件成本的大量浪费。　　被企业广泛应用的ERP系统、CRM系统会产生大量需要保密的数据，这些数据的存储和安全性给企业IT管理带来新挑战。分公司较多并且地域分散的企业，其销售和客户支持等职位，由于工作的特殊性需要员工在外地。他们没有固定的办公场所，但是这类员工同样需要有稳定的IT软硬件环境来支持工作，这就需要IT管理部门使用稳定且灵活的方式来满足需求。　　从运维的角度看，IT管理部门软硬件更新和维护的工作量与日俱增。软件升级需要用户客户端分别操作，无法统一进行不同客户端的升级；硬件扩展也需要花费大量时间进行系统和软件的重新安装。目前除了增加IT管理人员的数量和工作时间，IT管理部门迫切需要一种行之有效的办法来解决这一问题。　　企业需要更智能的的IT管理方式，来解决传统IT架构所面临的资源利用率低、业务连续性低、办公灵活性低、安全风险高、总体拥有成本(TCO，Total Cost of Ownership)高等问题。私有桌面云是一种全新的IT架构，这种IT架构将用户和硬件、硬件和系统等纷纷解耦合，使得每个模块都能够灵活高效地发挥各自的作用，并将用户桌面统一集中在数据中心管控，用户前端使用云终端接入系统，实现统一管控、安全可靠、绿色环保、降低TCO、改善使用与维护体验。　　1、桌面云的价值　　1.1 桌面云的定义　　桌面云是将传统的个人桌面统一集中存放在数据中心，通过网络交付桌面到用户。在数据中心侧桌面云将传统桌面的各个逻辑单元通过虚拟化技术“解耦合”，计算和存储各自独立，用户桌面的逻辑配置可以灵活地动态调整，并可以统一集中管控；用户侧通过智能终端(瘦客户机、零终端、PC机、笔记本、PAD、智能手机等)作为接入平台，利用用户UID通过网络获取个人桌面。形象一点，我们可以通过任何设备、在任何地点、任何时间访问在网络上属于我们个人的桌面系统。　　1.2 集中化管理　　在使用传统桌面的整体成本中，PC机硬件和用户分布广泛，而且用户在访问桌面环境时对位置无关性要求越来越高。在这种情况下，集中化的PC机管理极其困难，而且PC机桌面的标准化难度可谓“声名狼藉”，其中的原因就在于PC机硬件的多样化，再加上用户也需要修改桌面环境，管理难度进一步加大。　　在桌面云解决方案里，由于计算发生在数据中心，所有桌面的管理和配置都在数据中心进行，管理员可以在数据中心对所有桌面和应用进行统一配置和管理，例如系统升级、应用安装等。避免了由于终端分布造成的管理困难和成本高昂，尤其对于学校机房、教学中心等大规模的，有多变需求的应用场景(频繁更换操作系统)非常适合。由于传递的只是最终运行图像，所有的数据和计算都发生在数据中心，涉密数据和信息不需要通过网络传递，增加了安全性，另外这些数据也可以通过配置不允许下载到客户端，保证用户不会带走、传播涉密信息。　　1.3 提高安全性　　安全是IT工作中一个非常重要的要素，一方面各单位对自己有安全要求，另一方面政府对安全也有些强制要求，不得违反。如何确保PC机上的数据能够成功得到备份，如何在PC机故障或者文件丢失时能够对这些数据进行恢复，都是棘手的问题。即使数据成功地得到了备份，PC机的失窃风险仍然会威胁到重要数据的保密性。通过桌面云架构，企业不必担心用户的安全接入问题，所有客户端与数据中心之间的通讯都有多层安全措施来保护。如通过应用交付模块IT管理人员则可以：　　1)统一为用户分配应用，避免用户非法访问。2)不必知道用户在访问什么资源，因为所有用户访问的资源都是IT管理人员在应用交付控制模块上为其分配的。3)不必了解用户通过什么设备访问数据中心，不必担心用户的客户端设备会影响到数据中心的安全，因为用户只有使用符合安全要求的客户端设备才能访问数据中心的应用。4)不必了解用户占用多少资源，用户的可用资源都是由管理员分配并受系统控制。　　1.4 总体成本减少　　IT资产的成本包括多方面，初期购买成本是其中一小部分，其他还包括整个生命周期的管理、维护、能量消耗、硬件升级等方面的成本。传统IT架构的桌面更换、日常维护、Help Desk人员配置以及应用系统宕机大大增加了分布式PC模式的管理维护成本；一般PC的能耗在250W左右，生命周期在3~5年，PC作为一个整体，包括操作系统、应用和个性化设置，已越来越不能满足现今企业快速的业务变化需求。　　桌面云架构采用集中化桌面、简单的操作系统镜像和独立的应用虚拟化环境，IT人员可以在几秒钟内完成用户桌面的配置和启用，用户可以通过智能终端在各种网络上连接使用个人桌面。瘦终端的功耗平均仅25W，是PC的10%，也就说使用云终端可以节省90%的能耗费用，并且瘦终端的生命周期为5~10年，也是传统PC的2倍。以上所说的运维、能耗、硬件维保都是直接显性成本，桌面云在一些隐性成本上也有很大的节省，比如最令企业看重的数据安全问题。桌面云的架构(计算存储分离)是一种天然的安全架构，企业在数据安全上不用做额外的成本投入，这是传统PC桌面架构不具备的特点。根据专门从事信息技术研究和分析的Gartner公司的评估，云桌面的总体拥有成本相比传统桌面可以减少约40%。　　1.5 应用更环保　　虽然服务器的计算压力会带来一定程度的耗电量的上升，但是与客户端的大数量相比，可以忽略。由于瘦终端的耗电量约为传统PC的10%，所以一年的电费也会降低90%左右。而耗电的减少，也意味着碳排放的减少，适应了低碳时代的要求。　　2、普通桌面云在企业应用中遇到的挑战　　虚拟化用户桌面环境，是指将虚拟化的理念、技术应用于桌面环境或用户操作环境，建立一套可移植、可重构、按需定制的可视化用户使用环境和程序执行的自动配置环境，以适应异构软硬件环境和任务需求的变化，协调分布呈现的计算资源，最终建立任务执行的协同计算环境。　　因为传统IT构架带来的普遍性的困扰，为终端用户提供虚拟化的桌面环境已经成为一项有意义的工作。目前，几乎所有重要的硬件厂商和一些著名的大学都在此领域展开了研究工作，主要集中在如何应用虚拟化技术为终端用户提供资源访问的便利性、安全性以及高用户体验上。通过分析这些典型技术的特点，可以发现它们仍然存在如下一些难以解决的问题。　　2.1 外设兼容性　　在桌面虚拟化项目中对外设的支持是非常普遍的，绝大多数VDI(Virtual Desktop Infrastructure，虚拟桌面基础架构)项目中都会遇到用户对外设的需求，但有时也非常棘手。众所周知，外设是在云终端上接入，在后端做桌面识别，这就涉及到将具有电器特性的硬件设备通过网络传输到后端的桌面中，并且设备本身的驱动是在前端还是后端，都需要桌面云厂家考虑，加上国内外设的多样性和不标准性，要在桌面云中支持具有多样性复杂性的外设，需要厂家有独特的外设支持技术。　　2.2 视频体验　　桌面云的计算和存储全部在数据中心，终端只负责键盘鼠标的IO和显示的输出，此时云桌面的传输协议就显的尤为重要。普通办公桌面的传输没有什么问题，但是实际上用户可能有各种各样的业务需求，例如视频，这类业务在终端桌面就可能出现画面不流畅、终端画面出现马赛克，更别提播放三维动画，尤其随着Internet的发展，很多桌面虚拟化方案需要基于Internet部署，而基于Internet的传输效果更是大打折扣。这要求桌面云厂家在桌面传输协议上有独特的通道设计，通过不同的通道来处理不同的桌面显示，并且在带宽上能优化处理。　　2.3 3D应用　　虚拟化桌面固然有其诱人之处，但是目前主流的桌面虚拟化技术在3D图形设计方面很难满足客户的需求，这也使得传统虚拟化方案在制造行业、数字内容创作等行业遇到了难以逾越的瓶颈，再好的解决方案如果不能满足用户的实际需求也是空谈。　　3、针对企业应用的桌面云架构设计原则　　针对桌面云在企业应用中遇到的挑战，私有桌面云的设计思想从稳定性、易部署易管理性、安全性、外设兼容性、视频及3D工作站体验、售后服务性等诸多方面逐一部署。　　3.1 稳定性　　一个好的虚拟平台决定了整个虚拟桌面的稳定性，毕竟虚拟桌面都运行在虚拟后端上(FreeServer/VMware ESX/XenServer/Hyper-V)。如果考虑成本问题，也有着丰富的管理经验，可以选择FreeServer/XenServer/Hyper-V；如果想一劳永逸，选择VMwareESX是最明智的。这也是CITRIX在大型虚拟桌面部署环境中，50%~60%左右后端采用VMware ESX的主要原因。　　3.2 易部署、易管理性　　易部署性决定了一款产品在市场最终的立足点，比如，如果你的Windows安装比Linux/Unix更难，那Windows早就不存在了。当然，讨论易部署性也要看规模的大小和用户需求的复杂度，而这两点对产品而言是平等的。因为产品要向用户需求靠拢，而产品本身的复杂性会在很大程度上决定项目在部署上的成败。虚拟桌面可以帮助用户快速部署用户桌面以适应业务需求，如果部署太麻烦、太复杂，那反倒不如传统方式。一个统一的管理平台对一个企业IT管理来说是非常必要的。京华丰云FreeCloud平台将基础架构(服务器、网络、存储)、虚拟机主机、虚拟桌面和外设做统一的管理，并且对数据中心、集群和存储分级管理，能够让企业IT部门很容易部署和管理整个数据中心。　　3.3 安全性　　传统桌面的主要问题是数据安全，很多企业引入虚拟桌面的主要目的就是为了实现企业机密数据的高安全性，传统桌面滞留着太多企业业务核心数据，用户可以通过任何方式带出企业(网络、USB、打印等)。虽然安全措施层出不穷，禁止上网、软/硬方式禁用USB外设、文档加密、打印审核等，可这些方法只能应对普通的用户群体，大多防不了真正的内部窃取者。由于数据全部存放在数据中心集中管理、戒备完善，虚拟桌面可以实现用户端数据安全，让用户对数据按权限看得见、摸不着、带不走。而且在这种虚拟数据安全方式中，都有相关策略进行监控。　　京华丰云在桌面接入网关上设有独特的用户安全认证机制，所有的外设权限跟设备无关，而是与用户绑定，不用针对各个云终端做额外的权限控制，只需管控好用户的权限，而实际中管控用户的权限远比管控云终端的权限容易，使监管在保障安全的同时具备易操作性。　　3.4 外设兼容性　　不论是传统桌面还是虚拟桌面，桌面的目标是以用户为中心，配合用户的使用习惯，因此不能因为虚拟化，让用户感觉到虚拟桌面给他们带来了太大的差异，引起用户对虚拟桌面的抵触心理。普通的虚拟桌面对外部设备的兼容性往往会影响到用户体验，特别是在国内，外部设备的多样性、不标准性，很难让虚拟桌面实现很好的支持。我们无法要求所有外设厂商开发标准的外设，只能让虚拟桌面厂商针对国内市场对外设的需求改善自己产品的兼容性。虚拟桌面本身给用户展示的应该是一个完全的桌面，而不是一个桌面的边边角角，使用户真正体验虚拟桌面给自己带来的便捷。京华丰云的桌面云拥有独特的外设支持协议通道(如图1所示)，基于功能而言，和传统的物理PC没有差异。  　　3.5 视频及3D工作站体验　　针对云桌面的原理架构(后端计算前端显示)，如果视频完全在后端服务器上播放，再将播放的图像通过桌面云协议传输到云终端，势必造成视频的“卡顿”现象。想要让桌面云上的视频体验和PC机一样，从原理上设计对视频的处理需采用独立的通道和协议，见图2。  　　桌面传输协议在后端桌面上检测应用类型，视频采用独立的通道传输，变化频率不大的区域(例如播放器界面)采用无损压缩技术传输，视频区域采用流媒体传输技术，视频在后端编码压缩，在云终端上解码播放。这样处理桌面云中的视频体验就和PC体验一样了。当然，在视频播放的时候要考虑到视频的分辨率和带宽的匹配。　　那么如何在桌面云中落实3D应用呢？由于3D应用需要有硬件(显卡)支撑和高性能的处理能力，而瘦客户机的设计是简洁轻巧灵便，所以在瘦客户机上是无法实现3D应用的，并且传统的VDI交付技术也无法满足3D应用的高渲染质量要求。那么要满足3D应用的高性能要求和高用户体验，就需要桌面云厂家有新的桌面云交付模式。私有桌面云架构对普通办公桌面采用VDI交付模式，对3D图形应用采用桌面流交付模式，如图3所示。  　　桌面流交付模式在前端使用图形工作站，把VDI模式下的计算移到前端来处理，把存储留在数据中心(分散计算解决方案)，这样既保障了3D工作站对计算能力、数据安全的要求，又能够满足用户的高体验需求，如图4所示。  　　桌面流交付模式在后端把系统镜像和用户数据存储(包括Profile和办公数据)分离开来，前端使用图形工作站。当工作站启动的时候，通过网络加载系统镜像流，并且根据用户UID定位用户Profile和用户数据，系统镜像在本地(用户端)运行，用户数据通过网络交付到数据中心存储。　　4、结束语　　随着云服务在人们工作与生活中的推进，桌面虚拟化促成桌面云的集约性、安全性与便利性，使桌面云终端正逐渐成为未来终端管理和桌面系统建设的主流。同时，因为桌面虚拟化集中管理、虚拟化和随需交付使传统PC应用的很多管理难题、维护难题、安全难题，在这种全新的基础架构上自然得到解决。理论上桌面虚拟化可以实现IT对客户端的零维护，这意味着IT管理部门可以从繁琐的客户端配置、软件版本升级、病毒防护、系统修复等操作中解放出来，在为桌面用户提供充分灵活的操作空间的同时，提升IT部门的桌面管理水平，有利于管控企业内部核心数据，减少前台大量个人终端的功耗，进而降低系统总体成本。