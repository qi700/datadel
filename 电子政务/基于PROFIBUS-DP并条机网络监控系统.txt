基于PROFIBUS-DP并条机网络监控系统
并条是纺织过程中的重要工序。并条机自动控制系统主要是单机控制。旧机型多采用仪表加继电器的控制结构,系统的稳定性较差,人为主观因素大,成品率低,产品质量差,系统运行和维护的成本高。即使现在一些先进的并条机采用了性能高的PLC控制，但仍然难以实现设备与外界之间的信息交换。这就使单机自动化系统成为典型的“信息孤岛”，为了提高并条工艺的效益我们就必须利用先进的自动化技术和信息化技术进行车间的设备改造管理信息化改造。为此,我们采用Profibus-DP现场总线构造并条机控制系统网络,使系统具有开放性高、布线安装方便、运行和维护成本低的优点,同时提高了系统的智能化和自动化程度,使整个系统的控制水平得到了大大的提高。2 系统要求某纺织集团有限公司要求在对其并条车间的34台并条机技术改造，不仅增加了各机台的自调匀整功能，而且实现车间的生产调度全集中监控。中央控制室的主计算机上运行的监控软件可以显示整个车间的生产工艺图，动态显示所有设备，仪表的状态及参数等生产流程的监控。对重要参数的进行趋势图跟踪，系统报警等。通过该系统也可以进行现场的设备的控制及对有关的参数进行修改，从而实现企业生产过程地集中调度。3 系统设计与实现根据上述要求在选择控制网络的结构时，着重研究了目前流行的DCS和FCS的优、缺点，从实现的可能性、性能价格比、维护的方便程度、系统扩容性等众多方面考查，最后选定FCS，以Profibus为基础，用SIEMENS的S7-200系列PLC和WINCC组态软件组成分布式监控网络。3.1 Profibus-DP现场总线技术Profibus是由SIEMENS公司推出的一种开放式现场总线标准，1989年成为德国标准DIN19245，1996年成为欧洲标准EN50170，1999年12月被接受为国际标准IEC61158的一部分[1]。用于工厂自动化系统三级网络中的底层，即车间级监控和现场设备层数据通信与控制;使用于分散的、具有通讯接口的现场受控设备对底层设备有较高的数据集成和远程诊断、故障报警及数字化要求的系统。 Profibus遵循ISO/OSI模型，其通信模型由三层构成:物理层、数据链路层和应用层。PROFIBUS提供了3种协议类型:PROFIBUS-FMS、PROFIBUS-DP、PROFIBUS-PA。另外，对于西门子PLC系统，PROFIBUS提供了两种优化了的通信方式:S7通信和S5兼容通信[2]。其中PROFIBUS-DP是一种高速、经济的设备级网络，主要用于现场控制器与分散I/O之间的通信，使用物理层，数据链接层和用户接口，用于现场层的高速数据传送。主站周期地读取从站地输入信息并周期地向从站发送输出信息。总线循环时间必须要比主站程序循环时间短。此外，PROFIBUS-DP还提供智能化现场设备所需的非周期性通信以进行组态、诊断和报警处理及复杂设备在运行中参数的确定。3.2 系统网络结构笔者设计的系统网络结构如图1所示。网络采用Profibus-DP网络单主站系统,以配置了CP5613卡的工控机作为上位机实现对系统的监控管理;以CP5613卡作为主站，决定总线的传输速率并分配每个从站网络地址;以34个分布在各个工作现场S7-200PLC (CPU224)作为从站,负责现场的信息采集并向主站发送有关信号,以及具体执行控制命令。S7-200PLC利用EM277 PROFIBUS－DP模块的DP端口同CP5613卡通过屏蔽双绞线相连,构成整个PROFIBUS－DP现场总线网络。另外一个S7-200 PLC作为控制网络中的一个节点(即DP从站)控制一台并条机,它的运行状态并不影响网络及其它节点的运行。而且也用它自带的RS-485接口与TP170相连，以完成对现场设备的控制。TP170与S7-200 PLC采用PPI通信方式，不参与PROFIBUS－DP总线网络。
图1 系统网络结构图3.3 系统网络监控设计本控制系统的S7 200PLC编程采用西门子公司的STEP7 MicroWIN4.0软件包，上位机作为控制系统的人机交互接口，安装有西门子公司的SIMATIC WINCC 6.0组态软件，作为中央监控计算机实现对本系统的状态监控、参数设定和报警显示、记录等，并能提供完整的数据统计和各种分析图表。STEP7 MicroWIN4.0软件运行于WINDOWS环境下，界面友好，编程方便，在线调试直观。组态软件WINCC通过CP5613卡和EM277通信模块实现到S7-200PLC的 Profibus-DP连接。(１) 组态软件性能WINCC软件分项目、画面、窗口和目标四级管理;项目数无限制，每个项目最多可有1000个画面;每个画面最多可包括:100个窗口，256个动态目标，256个可控目标，16个历史操作图，16个当前趋势图，16个报警窗口;支持标记、处方、面板、符号等监控特性;支持9种报警类型;自定义软件扫描周期，本系统设置最短为50ms。(２) WINCC与S7-200之间的Profibus-DP连接笔者设计得Profibus-DP通信是一主多从的通信方式，WINCC是上位机监控软件，使用WINCC的上位机只能作为主站，所以上位机只能是一台。一般情况通过西门子公司提供的网络集成CP5613卡，在PROFIBUS-DP网络方式下最多只能直接连接8个S7-200PLC，因为这时监控软件WINCC只能通过OPC通道与OPC Sever交换数据，而一个OPC Sever只能带8个S7-200PLC。但监控系统共有34套PLC，对于这个问题笔者的解决办法是:通过标准的DP协议进行组建网络，这时要在原来的配置基础上再增加DP-5613 V6.2软件，另外在PC站组态时选择“Application”而不是“OPC Sever”。这样通过下面的介绍的方法就可实现WINCC与S7-200PLC之间的连接。(３) 把EM277的GSD文件(siem089.gsd)安装到STEP 7-Micro/WIN中在STEP 7中，点击选项“Options”——“Install New GSD”安装GSD文件。EM277安装后，可以在硬件目录“Profibus DP”——“Addition Field Devices”——“SIMATIC”可找到EM277。(４) 配置网卡在项目中插入一个PC STATION，在第一行插入APPLICATUION，在第四行插入CP5613(此处以CP5613作为DP主站)，并建立Profibus网络，在网上添加EM277作为DP从站。过程如图2所示，配置通信接口区为8字的输入区，8字的输出区，如图3所示。双击图2中EM277，配置EM277的地址偏移量为5000。
图2 建立Profibus网络
图3 配置通信接口区
(５) 编译存盘后，配置PC STATION点击“Start Station Configuration”进入组态画面。点击“Add”，添加“Application”。这里要说明的是如果添加的是“OPC Sever”监控软件就通过OPC通道与OPC Sever交换数据，而一个OPC Sever只能带8个S7-200PLC。因此这一步非常重要。另外设置网卡模式与硬件组态一样，也是在第四行添加网卡CP5613。(６) PC站的下载在控制面板中打开“Set PG/PC Interface”设置S7 ONLINE指向“PC Internal”，访问CP_L2_1指向“CP5613(Profibus)”。然后通过点击PC STATION的“STATION NAME”改变PC STATION的站名与在STEP7中组态的PC站名称相同。将组态下载到PC STATION中，并确认状态。(７) 在STEP 7-Micro/WIN中设置DP从站的地址偏移量，如图4所示。
图4 DP从站地址偏移量设置其中:VW 5000 -> QW0(Receiver buffer);IW0 ->V5008 (Sender buffer)。(８) WINCC侧的组态。打开WINCC在“tag manage ment”中添加Profibus-DP协议，如图5所示:
图5 组态WINCC(9) 在DP协议下，添加新的连接，设置连接DP从站地址。(10) 配置系统参数。选择CP5412(A2)board 1，在右键菜单中选择“system parameters”设置系统参数，如图6所示:
图6 设置系统参数 (11) 添加变量Tag，连接输入地址，如图7所示:
图7 添加变量Tag这样，就完成了WINCC与S7-224PLC之间的连接Profibus-DP连接。3.4 系统网络监控实现基于Profibus DP组成网络，通过WINCC进行系统组态实现车间并条机的网络监控系统，可以对生产过程中的棉条的喂入速度、输出速度、自调匀整率和棉条的条干历史趋势图进行显示。并对主电机、伺服电机、换筒电机、风机，以及运行各种故障进行报警。由于监视屏上的流程图是根据生产流程而画出的，可以使操作人员一目了然，给维护人员也带来了方便。该监控系统主要可实现以下功能:(1) 远程控制功能:通过在上位机上的简操作，可以实现对每台机的重要参数进行修改。(2) 实时监控:实时显示车间各台并条机运行状态，同时能实时显示生产产量状况。(3) 实时数据采集与数据分析功能:上位机实时地进行现场数据采集，并经算法处理把结果显示在监控见面。尤其能实时显示每台并条机左右眼输出棉条的条干分析趋势图。(4) 报表生成功能:能自动生成事件报表和产量报表，方便用户查看数据。(5) 打印功能:能对每台并条机输出棉条的条干曲线、事件报表和产量报表等用户所关心的数据和信息进行打印。 (6) 故障报警功能:能立即显示并条机当前产生的故障，同时在事件报表中能查询历史故障信息。(7) 紧急应急处理，如果有机台发生严重危险故障时，且来不及到车间去处理，可以在监控画面操作急停按钮停止系统工作以保证重要设备及人身安全。本系统设计的部分监控界面如图8所示。
图8 并条机网络监控系统　　4 结束语
总之，本系统用Profibus-DP网络技术实现了分布式监控系统，大大降低了现场信号连接的工作量和费用，提高了信号传输精度和灵活性，降低了系统成本，给安装、调试和设备维护带来了方便。随着现代信息技术、计算机技术和自动化控制技术的不断发展，相信基于PROFIBUS-DP的现场总线技术不仅会为本系统中生产效益的提高做出贡献，更会为多工厂实现生产调度全集中监控和整个企业的全集成自动化带来更广阔的前景。