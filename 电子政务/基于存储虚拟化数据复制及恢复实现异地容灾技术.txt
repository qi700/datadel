基于存储虚拟化数据复制及恢复实现异地容灾技术
原标题：基于存储虚拟化数据复制及恢复实现异地容灾技术在吐哈油田的应用 随着信息化建设发展，吐哈油田勘探、开发、综合等各类数据资产的安全日趋重要，本文从现状分析入手，针对现有系统容灾需求，从众多容灾技术中选择了基于存储虚拟化数据复制及恢复技术，详细对比了两款基于虚拟存储技术进行容灾建设的产品，提出了产品选择参考意见。通过容灾系统建设，提升了吐哈油田公司数据资产安全性。 1 吐哈油田信息系统数据存储现状及异地容灾需求分析
随着吐哈油田公司的发展以及信息化持续建设，吐哈油田公司的核心业务越来越依赖于信息系统的可靠运行，信息系统中的关键业务数据已经成为公司最为重要的资产，数据大小目前已达到80TB海量数据。信息系统核心数据分为两部分：一部分位于哈密勘探开发研究院机房，存放公司勘探、开发专业类数据及应用；另一部分位于哈密信息产业处机房，存放公司各类综合管理系统数据及应用。现有信息系统数据存储存在以下缺点：一是每套存储设备独立运行，独立管理。一旦数据上线运行后，存储设备磁盘空间无法实现灵活的动态管理，形成存储孤岛，调配困难，管理难度大。二是核心数据都只实现了本地数据的备份，备份数据与现有系统和数据存放在同一机房内，一旦发生不可预测的灾难（如地震、火灾、洪水）或者人为灾难时，将造成数据丢失。因此，为了保障公司数据安全，优化信息资源利用率，保证业务的连续性，吐哈油田公司迫切需要现有的异构存储环境进行存储整合，使新的存储设备和原有的存储设备形成一个统一完整的存储池，实现服务器的集中访问、数据资源的集中存储和处理、存储设备的集中管理和维护。在此基础之上，建设统一的异地容灾架构，以满足长期的数据存储需求。
在容灾系统建设中，需要考虑的因素很多，如：备份恢复数据类型，数据量大小，异地之间距离，异地数据传输方式，灾难发生后所要求的恢复速度，资金的投入以及异地容灾中心的管理等。因此容灾系统的建设需要同吐哈油田业务所要求的RTO（能够容忍停机时间是多少）、RPO（能够容灾丢多少数据）、NRO（网络恢复能力）相结合考虑。通过与信息系统业务主管部门及运维管理人员针对异地容灾需求进行交流沟通得出，业务数据最低容灾级别需要满足国务院《信息系统灾难恢复规范》中第三级标准设计，其中6套系统参照第五级标准设计。需要容灾的数据量为55Tb，考虑数据递增量，容灾中心存储空间建设为80TB，地点选择在300公里以外的鄯善网络核心机房。
2 异地容灾建设方法选择
目前，异地容灾系统建设主要有以下几种容灾方法：
① 基于传统备份软件+远程存储介质的备份及恢复；
② 基于传统磁盘阵列的数据复制及恢复；
③ 基于传统的网关方式的数据复制及恢复；
④ 基于数据库的复制及恢复；
⑤ 基于存储虚拟化的数据复制及恢复。
在选择容灾建设方式时要充分考虑现状、容灾要求以及投资，如果信息系统存储设备复杂多样、操作系统的复杂、对容灾级别要求较高，在资金允许的情况下，目前最好的解决办法就是选择基于存储虚拟化的数据复制及恢复。目前存储虚拟化技术得到快速发展，逐渐被用户接受。吐哈油田数据中心异地容灾系统建设采用了该方法。
3 基于存储虚拟化的数据复制及恢复技术进行异地容灾建设
目前虚拟存储主流厂家有IBM SVC、HDS USP VM、NetApp、Storeage svm，根据吐哈油田的容灾需求及现状，重点研究对比了IBM、HDS两种容灾方案。
方案一：IBM SVC虚拟化灾备复制的架构设计如下：
虚拟化容灾方案如下：
（1）哈密两个核心机房以交换机新购+利旧的方式进行SAN网络的优化整合，研究院新购2台IBM B80 SAN交换机替换全部SAN交换机，拆除3个SAN结构，重新构建SAN结构。信息产业处方面，利用现有的两台IBM B32交换机接入所有的服务器和存储；
（2）部署SVC控制器，进行各自的SAN存储虚拟化整合，分别把研究院和信息产业处的存储设备信息孤岛分别集中起来，虚拟成两个存储池，由虚拟控制器统一管理，优化使用；
（3）建设容灾中心存储系统，存储阵列配置一台DS5300阵列。部署两台关键业务服务器，达到应用级容灾；
（4）购置3台FC-IP路由器，两地三中心的FC-IP路由设备通过一条千兆IP链路相连，形成鄯哈高速存储网络链路。启用SVC的异步复制功能，将两个生产中心数据复制到容灾中心存储设备，实现异地容灾。方案二：HDS虚拟化灾备复制的架构设计如下：
虚拟化容灾方案如下：
（1）在哈密研究院、信息产业处各布置一套HDS USP VM存储系统，充分利用现有交换机将现有的、相互独立的SAN存储网络连接到新的存储系统，实施7套异构磁盘阵列的虚拟化，虚拟成两个存储池，实现存储环境的整合和统一。
（2）在鄯善灾备中心布置一套HDS USP VM存储系统，与哈密研究院、信息产业处的存储系统配合完成远程数据复制；布置两台服务器与存储系统直连，购置两台应用服务器兼做数据验证管理服务器使用。
（3）在两地三中心各布置一台 FC-IP路由设备进行协议转换。每台FC-IP路由设备的FC端口分别直接连到本地HDS USP VM存储系统。两地的FC-IP路由设备通过一条千兆IP链路相连，采用存储系统的远程数据复制功能，实现哈密研究院、信息产业处到鄯善灾备中心数据复制容灾。
以上两种方案均能实现所有存放在存储设备上的数据统一复制容灾。从对现有生产环境改造程度、系统运行稳定可靠性、性价比以及后期扩充投资对比可以看出，如果生产系统环境简单，现有数据量不大及增量小的情况可以考虑IBM SVC，如果本身生产环境复杂，存在超大数据块，对系统性能要求高，则HDS USP VM产品更优。针对吐哈油田的实际情况，方案二更适合，但鉴于项目经费的限制，最终选择了方案一。
2010年12月至2011年03月进行了容灾系统建设实施，第一步对生产环境两个机房的存储设备SAN架构整合，第二步进行存储设备虚拟化整合实施，第三步进行容灾链路调试，数据复制，完成了55TB数据的远程容灾，经过两次系统演练，达到了异地容灾系统建设的目标，目前已正式投入稳定运行。
4 应用效果
在虚拟化整合存储设备后，油田数据实现了基于存储设备级异步复制方式容灾到鄯善，建立了统一的鄯善←→哈密信息数据异地容灾架构，吐哈油田重要信息系统数据均得到异地存储备份。在灾难发生后，实现了应用容灾的系统直接即可启用灾备中心应用，只实现了数据容灾的系统，需重新搭好应用服务器，然后将容灾中心的生产数据快速恢复到应用系统中，即可恢复信息系统应用。这样能够确保做好信息系统和数据的快速恢复工作，油田数据资产不丢失，系统安全进一步加强。